(function(a){if(typeof a.fn.each2=="undefined"){a.fn.extend({each2:function(g){var d=a([0]),f=-1,b=this.length;while(++f<b&&(d.context=d[0]=this[f])&&g.call(d[0],f,d)!==false){}return this}})}})(jQueryFix);(function(C,l){var I,L,w,c,a,o,n,u,v,I={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(M){M=M.which?M.which:M;switch(M){case I.LEFT:case I.RIGHT:case I.UP:case I.DOWN:return true}return false},isControl:function(N){var M=N.which;switch(M){case I.SHIFT:case I.CTRL:case I.ALT:return true}if(N.metaKey){return true}return false},isFunctionKey:function(M){M=M.which?M.which:M;return M>=112&&M<=123}},A="<div class='select2-measure-scrollbar'></div>";u=C(document);a=(function(){var M=1;return function(){return M++}}());function p(O,P){var N=0,M=P.length;for(;N<M;N=N+1){if(s(O,P[N])){return N}}return -1}function K(){var M=C(A);M.appendTo("body");var N={width:M.width()-M[0].clientWidth,height:M.height()-M[0].clientHeight};M.remove();return N}function s(N,M){if(N===M){return true}if(N===l||M===l){return false}if(N===null||M===null){return false}if(N.constructor===String){return N+""===M+""}if(M.constructor===String){return M+""===N+""}return false}function h(N,P){var Q,O,M;if(N===null||N.length<1){return[]}Q=N.split(P);for(O=0,M=Q.length;O<M;O=O+1){Q[O]=C.trim(Q[O])}return Q}function g(M){return M.outerWidth(false)-M.width()}function E(N){var M="keyup-change-value";N.on("keydown",function(){if(C.data(N,M)===l){C.data(N,M,N.val())}});N.on("keyup",function(){var O=C.data(N,M);if(O!==l&&N.val()!==O){C.removeData(N,M);N.trigger("keyup-change")}})}u.on("mousemove",function(M){n={x:M.pageX,y:M.pageY}});function H(M){M.on("mousemove",function(O){var N=n;if(N===l||N.x!==O.pageX||N.y!==O.pageY){C(O.target).trigger("mousemove-filtered",O)}})}function j(P,N,M){M=M||l;var O;return function(){var Q=arguments;window.clearTimeout(O);O=window.setTimeout(function(){N.apply(M,Q)},P)}}function q(O){var M=false,N;return function(){if(M===false){N=O();M=true}return N}}function k(M,O){var N=j(M,function(P){O.trigger("scroll-debounced",P)});O.on("scroll",function(P){if(p(P.target,O.get())>=0){N(P)}})}function G(M){if(M[0]===document.activeElement){return}window.setTimeout(function(){var O=M[0],P=M.val().length,N;M.focus();if(M.is(":visible")&&O===document.activeElement){if(O.setSelectionRange){O.setSelectionRange(P,P)}else{if(O.createTextRange){N=O.createTextRange();N.collapse(false);N.select()}}}},0)}function d(M){M=C(M)[0];var P=0;var N=0;if("selectionStart" in M){P=M.selectionStart;N=M.selectionEnd-P}else{if("selection" in document){M.focus();var O=document.selection.createRange();N=document.selection.createRange().text.length;O.moveStart("character",-M.value.length);P=O.text.length-N}}return{offset:P,length:N}}function z(M){M.preventDefault();M.stopPropagation()}function b(M){M.preventDefault();M.stopImmediatePropagation()}function m(N){if(!o){var M=N[0].currentStyle||window.getComputedStyle(N[0],null);o=C(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:M.fontSize,fontFamily:M.fontFamily,fontStyle:M.fontStyle,fontWeight:M.fontWeight,letterSpacing:M.letterSpacing,textTransform:M.textTransform,whiteSpace:"nowrap"});o.attr("class","select2-sizer");C("body").append(o)}o.text(N.val());return o.width()}function i(N,R,M){var P,Q=[],O;P=N.attr("class");if(P){P=""+P;C(P.split(" ")).each2(function(){if(this.indexOf("select2-")===0){Q.push(this)}})}P=R.attr("class");if(P){P=""+P;C(P.split(" ")).each2(function(){if(this.indexOf("select2-")!==0){O=M(this);if(O){Q.push(this)}}})}N.attr("class",Q.join(" "))}function t(R,Q,O,M){var P=R.toUpperCase().indexOf(Q.toUpperCase()),N=Q.length;if(P<0){O.push(M(R));return}O.push(M(R.substring(0,P)));O.push("<span class='select2-match'>");O.push(M(R.substring(P,P+N)));O.push("</span>");O.push(M(R.substring(P+N,R.length)))}function D(O){var R,N=0,P=null,S=O.quietMillis||100,Q=O.url,M=this;return function(T){window.clearTimeout(R);R=window.setTimeout(function(){N+=1;var W=N,X=O.data,V=Q,Z=O.transport||C.fn.select2.ajaxDefaults.transport,U={type:O.type||"GET",cache:O.cache||false,jsonpCallback:O.jsonpCallback||l,dataType:O.dataType||"json"},Y=C.extend({},C.fn.select2.ajaxDefaults.params,U);X=X?X.call(M,T.term,T.page,T.context):null;V=(typeof V==="function")?V.call(M,T.term,T.page,T.context):V;if(null!==P){P.abort()}if(O.params){if(C.isFunction(O.params)){C.extend(Y,O.params.call(M))}else{C.extend(Y,O.params)}}C.extend(Y,{url:V,dataType:O.dataType,data:X,success:function(ab){if(W<N){return}var aa=O.results(ab,T.page);T.callback(aa)}});P=Z.call(M,Y)},S)}}function F(N){var Q=N,P,O,R=function(S){return""+S.text};if(C.isArray(Q)){O=Q;Q={results:O}}if(C.isFunction(Q)===false){O=Q;Q=function(){return O}}var M=Q();if(M.text){R=M.text;if(!C.isFunction(R)){P=M.text;R=function(S){return S[P]}}}return function(U){var T=U.term,S={results:[]},V;if(T===""){U.callback(Q());return}V=function(X,Z){var Y,W;X=X[0];if(X.children){Y={};for(W in X){if(X.hasOwnProperty(W)){Y[W]=X[W]}}Y.children=[];C(X.children).each2(function(aa,ab){V(ab,Y.children)});if(Y.children.length||U.matcher(T,R(Y),X)){Z.push(Y)}}else{if(U.matcher(T,R(X),X)){Z.push(X)}}};C(Q().results).each2(function(X,W){V(W,S.results)});U.callback(S)}}function y(N){var M=C.isFunction(N);return function(Q){var P=Q.term,O={results:[]};C(M?N():N).each(function(){var R=this.text!==l,S=R?this.text:this;if(P===""||Q.matcher(P,S)){O.results.push(R?this:{id:this,text:this})}});Q.callback(O)}}function x(M,N){if(C.isFunction(M)){return true}if(!M){return false}throw new Error("formatterName must be a function or a falsy value")}function B(M){return C.isFunction(M)?M():M}function r(M){var N=0;C.each(M,function(O,P){if(P.children){N+=r(P.children)}else{N++}});return N}function f(U,V,S,M){var N=U,W=false,P,T,Q,O,R;if(!M.createSearchChoice||!M.tokenSeparators||M.tokenSeparators.length<1){return l}while(true){T=-1;for(Q=0,O=M.tokenSeparators.length;Q<O;Q++){R=M.tokenSeparators[Q];T=U.indexOf(R);if(T>=0){break}}if(T<0){break}P=U.substring(0,T);U=U.substring(T+R.length);if(P.length>0){P=M.createSearchChoice(P,V);if(P!==l&&P!==null&&M.id(P)!==l&&M.id(P)!==null){W=false;for(Q=0,O=V.length;Q<O;Q++){if(s(M.id(P),M.id(V[Q]))){W=true;break}}if(!W){S(P)}}}}if(N!==U){return U}}function J(M,N){var O=function(){};O.prototype=new M;O.prototype.constructor=O;O.prototype.parent=M.prototype;O.prototype=C.extend(O.prototype,N);return O}L=J(Object,{bind:function(N){var M=this;return function(){N.apply(M,arguments)}},init:function(Q){var O,N,R=".select2-results",P,M;this.opts=Q=this.prepareOpts(Q);this.id=Q.id;if(Q.element.data("select2")!==l&&Q.element.data("select2")!==null){this.destroy()}this.container=this.createContainer();this.containerId="s2id_"+(Q.element.attr("id")||"autogen"+a());this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1");this.container.attr("id",this.containerId);this.body=q(function(){return Q.element.closest("body")});i(this.container,this.opts.element,this.opts.adaptContainerCssClass);this.container.css(B(Q.containerCss));this.container.addClass(B(Q.containerCssClass));this.elementTabIndex=this.opts.element.attr("tabindex");this.opts.element.data("select2",this).attr("tabindex","-1").before(this.container);this.container.data("select2",this);this.dropdown=this.container.find(".select2-drop");this.dropdown.addClass(B(Q.dropdownCssClass));this.dropdown.data("select2",this);this.results=O=this.container.find(R);this.search=N=this.container.find("input.select2-input");this.resultsPage=0;this.context=null;this.initContainer();H(this.results);this.dropdown.on("mousemove-filtered touchstart touchmove touchend",R,this.bind(this.highlightUnderEvent));k(80,this.results);this.dropdown.on("scroll-debounced",R,this.bind(this.loadMoreIfNeeded));C(this.container).on("change",".select2-input",function(S){S.stopPropagation()});C(this.dropdown).on("change",".select2-input",function(S){S.stopPropagation()});if(C.fn.mousewheel){O.mousewheel(function(W,X,U,T){var V=O.scrollTop(),S;if(T>0&&V-T<=0){O.scrollTop(0);z(W)}else{if(T<0&&O.get(0).scrollHeight-O.scrollTop()+T<=O.height()){O.scrollTop(O.get(0).scrollHeight-O.height());z(W)}}})}E(N);N.on("keyup-change input paste",this.bind(this.updateResults));N.on("focus",function(){N.addClass("select2-focused")});N.on("blur",function(){N.removeClass("select2-focused")});this.dropdown.on("mouseup",R,this.bind(function(S){if(C(S.target).closest(".select2-result-selectable").length>0){this.highlightUnderEvent(S);this.selectHighlighted(S)}}));this.dropdown.on("click mouseup mousedown",function(S){S.stopPropagation()});if(C.isFunction(this.opts.initSelection)){this.initSelection();this.monitorSource()}if(Q.maximumInputLength!==null){this.search.attr("maxlength",Q.maximumInputLength)}var P=Q.element.prop("disabled");if(P===l){P=false}this.enable(!P);var M=Q.element.prop("readonly");if(M===l){M=false}this.readonly(M);v=v||K();this.autofocus=Q.element.prop("autofocus");Q.element.prop("autofocus",false);if(this.autofocus){this.focus()}},destroy:function(){var M=this.opts.element.data("select2");if(this.propertyObserver){delete this.propertyObserver;this.propertyObserver=null}if(M!==l){M.container.remove();M.dropdown.remove();M.opts.element.removeClass("select2-offscreen").removeData("select2").off(".select2").attr({tabindex:this.elementTabIndex}).prop("autofocus",this.autofocus||false).show()}},optionToData:function(M){if(M.is("option")){return{id:M.prop("value"),text:M.text(),element:M.get(),css:M.attr("class"),disabled:M.prop("disabled"),locked:s(M.attr("locked"),"locked")}}else{if(M.is("optgroup")){return{text:M.attr("label"),children:[],element:M.get(),css:M.attr("class")}}}},prepareOpts:function(R){var P,N,M,Q,O=this;P=R.element;if(P.get(0).tagName.toLowerCase()==="select"){this.select=N=R.element}if(N){C.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in R){throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}})}R=C.extend({},{populateResults:function(T,V,Y){var X,W,S,U,Z=this.opts.id;X=function(ag,aa,af){var ah,ac,am,aj,ad,al,ab,ak,ai,ae;ag=R.sortResults(ag,aa,Y);for(ah=0,ac=ag.length;ah<ac;ah=ah+1){am=ag[ah];ad=(am.disabled===true);aj=(!ad)&&(Z(am)!==l);al=am.children&&am.children.length>0;ab=C("<li></li>");ab.addClass("select2-results-dept-"+af);ab.addClass("select2-result");ab.addClass(aj?"select2-result-selectable":"select2-result-unselectable");if(ad){ab.addClass("select2-disabled")}if(al){ab.addClass("select2-result-with-children")}ab.addClass(O.opts.formatResultCssClass(am));ak=C(document.createElement("div"));ak.addClass("select2-result-label");ae=R.formatResult(am,ak,Y,O.opts.escapeMarkup);if(ae!==l){ak.html(ae)}ab.append(ak);if(al){ai=C("<ul></ul>");ai.addClass("select2-result-sub");X(am.children,ai,af+1);ab.append(ai)}ab.data("select2-data",am);aa.append(ab)}};X(V,T,0)}},C.fn.select2.defaults,R);if(typeof(R.id)!=="function"){M=R.id;R.id=function(S){return S[M]}}if(C.isArray(R.element.data("select2Tags"))){if("tags" in R){throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+R.element.attr("id")}R.tags=R.element.data("select2Tags")}if(N){R.query=this.bind(function(V){var U={results:[],more:false},T=V.term,S,X,W;W=function(Y,aa){var Z;if(Y.is("option")){if(V.matcher(T,Y.text(),Y)){aa.push(O.optionToData(Y))}}else{if(Y.is("optgroup")){Z=O.optionToData(Y);Y.children().each2(function(ab,ac){W(ac,Z.children)});if(Z.children.length>0){aa.push(Z)}}}};S=P.children();if(this.getPlaceholder()!==l&&S.length>0){X=S[0];if(C(X).text()===""){S=S.not(X)}}S.each2(function(Y,Z){W(Z,U.results)});V.callback(U)});R.id=function(S){return S.id};R.formatResultCssClass=function(S){return S.css}}else{if(!("query" in R)){if("ajax" in R){Q=R.element.data("ajax-url");if(Q&&Q.length>0){R.ajax.url=Q}R.query=D.call(R.element,R.ajax)}else{if("data" in R){R.query=F(R.data)}else{if("tags" in R){R.query=y(R.tags);if(R.createSearchChoice===l){R.createSearchChoice=function(S){return{id:S,text:S}}}if(R.initSelection===l){R.initSelection=function(S,U){var T=[];C(h(S.val(),R.separator)).each(function(){var X=this,W=this,V=R.tags;if(C.isFunction(V)){V=V()}C(V).each(function(){if(s(this.id,X)){W=this.text;return false}});T.push({id:X,text:W})});U(T)}}}}}}}if(typeof(R.query)!=="function"){throw"query function not defined for Select2 "+R.element.attr("id")}return R},monitorSource:function(){var M=this.opts.element,N;M.on("change.select2",this.bind(function(O){if(this.opts.element.data("select2-change-triggered")!==true){this.initSelection()}}));N=this.bind(function(){var Q,P,O=this;var R=M.prop("disabled");if(R===l){R=false}this.enable(!R);var P=M.prop("readonly");if(P===l){P=false}this.readonly(P);i(this.container,this.opts.element,this.opts.adaptContainerCssClass);this.container.addClass(B(this.opts.containerCssClass));i(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass);this.dropdown.addClass(B(this.opts.dropdownCssClass))});M.on("propertychange.select2 DOMAttrModified.select2",N);if(this.mutationCallback===l){this.mutationCallback=function(O){O.forEach(N)}}if(typeof WebKitMutationObserver!=="undefined"){if(this.propertyObserver){delete this.propertyObserver;this.propertyObserver=null}this.propertyObserver=new WebKitMutationObserver(this.mutationCallback);this.propertyObserver.observe(M.get(0),{attributes:true,subtree:false})}},triggerSelect:function(N){var M=C.Event("select2-selecting",{val:this.id(N),object:N});this.opts.element.trigger(M);return !M.isDefaultPrevented()},triggerChange:function(M){M=M||{};M=C.extend({},M,{type:"change",val:this.val()});this.opts.element.data("select2-change-triggered",true);this.opts.element.trigger(M);this.opts.element.data("select2-change-triggered",false);this.opts.element.click();if(this.opts.blurOnChange){this.opts.element.blur()}},isInterfaceEnabled:function(){return this.enabledInterface===true},enableInterface:function(){var M=this._enabled&&!this._readonly,N=!M;if(M===this.enabledInterface){return false}this.container.toggleClass("select2-container-disabled",N);this.close();this.enabledInterface=M;return true},enable:function(M){if(M===l){M=true}if(this._enabled===M){return false}this._enabled=M;this.opts.element.prop("disabled",!M);this.enableInterface();return true},readonly:function(M){if(M===l){M=false}if(this._readonly===M){return false}this._readonly=M;this.opts.element.prop("readonly",M);this.enableInterface();return true},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var O=this.dropdown,Q=this.container.offset(),X=this.container.outerHeight(false),Y=this.container.outerWidth(false),U=O.outerHeight(false),N=C(window).scrollLeft()+C(window).width(),ab=C(window).scrollTop()+C(window).height(),P=Q.top+X,Z=Q.left,M=P+U<=ab,S=(Q.top-U)>=this.body().scrollTop(),V=O.outerWidth(false),ad=Z+V<=N,ac=O.hasClass("select2-drop-above"),R,aa,T,W;if(this.opts.dropdownAutoWidth){W=C(".select2-results",O)[0];O.addClass("select2-drop-auto-width");O.css("width","");V=O.outerWidth(false)+(W.scrollHeight===W.clientHeight?0:v.width);V>Y?Y=V:V=Y;ad=Z+V<=N}else{this.container.removeClass("select2-drop-auto-width")}if(this.body().css("position")!=="static"){R=this.body().offset();P-=R.top;Z-=R.left}if(ac){aa=true;if(!S&&M){aa=false}}else{aa=false;if(!M&&S){aa=true}}if(!ad){Z=Q.left+Y-V}if(aa){P=Q.top-U;this.container.addClass("select2-drop-above");O.addClass("select2-drop-above")}else{this.container.removeClass("select2-drop-above");O.removeClass("select2-drop-above")}T=C.extend({top:P,left:Z,width:Y},B(this.opts.dropdownCss));O.css(T)},shouldOpen:function(){var M;if(this.opened()){return false}if(this._enabled===false||this._readonly===true){return false}M=C.Event("select2-opening");this.opts.element.trigger(M);return !M.isDefaultPrevented()},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above")},open:function(){if(!this.shouldOpen()){return false}this.opening();return true},opening:function(){var S=this.containerId,M="scroll."+S,Q="resize."+S,P="orientationchange."+S,N;this.container.addClass("select2-dropdown-open").addClass("select2-container-active");this.clearDropdownAlignmentPreference();if(this.dropdown[0]!==this.body().children().last()[0]){this.dropdown.detach().appendTo(this.body())}N=C("#select2-drop-mask");if(N.length==0){N=C(document.createElement("div"));N.attr("id","select2-drop-mask").attr("class","select2-drop-mask");N.hide();N.appendTo(this.body());N.on("mousedown touchstart",function(U){var V=C("#select2-drop"),T;if(V.length>0){T=V.data("select2");if(T.opts.selectOnBlur){T.selectHighlighted({noFocus:true})}T.close();U.preventDefault();U.stopPropagation()}})}if(this.dropdown.prev()[0]!==N[0]){this.dropdown.before(N)}C("#select2-drop").removeAttr("id");this.dropdown.attr("id","select2-drop");N.css(O());N.show();this.dropdown.show();this.positionDropdown();this.dropdown.addClass("select2-drop-active");this.ensureHighlightVisible();var R=this;this.container.parents().add(window).each(function(){C(this).on(Q+" "+M+" "+P,function(T){C("#select2-drop-mask").css(O());R.positionDropdown()})});function O(){return{width:Math.max(document.documentElement.scrollWidth,C(window).width()),height:Math.max(document.documentElement.scrollHeight,C(window).height())}}},close:function(){if(!this.opened()){return}var P=this.containerId,M="scroll."+P,O="resize."+P,N="orientationchange."+P;this.container.parents().add(window).each(function(){C(this).off(M).off(O).off(N)});this.clearDropdownAlignmentPreference();C("#select2-drop-mask").hide();this.dropdown.removeAttr("id");this.dropdown.hide();this.container.removeClass("select2-dropdown-open");this.results.empty();this.clearSearch();this.search.removeClass("select2-active");this.opts.element.trigger(C.Event("select2-close"))},clearSearch:function(){},getMaximumSelectionSize:function(){return B(this.opts.maximumSelectionSize)},ensureHighlightVisible:function(){var P=this.results,O,M,T,S,Q,R,N;M=this.highlight();if(M<0){return}if(M==0){P.scrollTop(0);return}O=this.findHighlightableChoices().find(".select2-result-label");T=C(O[M]);S=T.offset().top+T.outerHeight(true);if(M===O.length-1){N=P.find("li.select2-more-results");if(N.length>0){S=N.offset().top+N.outerHeight(true)}}Q=P.offset().top+P.outerHeight(true);if(S>Q){P.scrollTop(P.scrollTop()+(S-Q))}R=T.offset().top-P.offset().top;if(R<0&&T.css("display")!="none"){P.scrollTop(P.scrollTop()+R)}},findHighlightableChoices:function(){return this.results.find(".select2-result-selectable:not(.select2-selected):not(.select2-disabled)")},moveHighlight:function(P){var O=this.findHighlightableChoices(),N=this.highlight();while(N>-1&&N<O.length){N+=P;var M=C(O[N]);if(M.hasClass("select2-result-selectable")&&!M.hasClass("select2-disabled")&&!M.hasClass("select2-selected")){this.highlight(N);break}}},highlight:function(N){var P=this.findHighlightableChoices(),M,O;if(arguments.length===0){return p(P.filter(".select2-highlighted")[0],P.get())}if(N>=P.length){N=P.length-1}if(N<0){N=0}this.results.find(".select2-highlighted").removeClass("select2-highlighted");M=C(P[N]);M.addClass("select2-highlighted");this.ensureHighlightVisible();O=M.data("select2-data");if(O){this.opts.element.trigger({type:"select2-highlight",val:this.id(O),choice:O})}},countSelectableResults:function(){return this.findHighlightableChoices().length},highlightUnderEvent:function(N){var M=C(N.target).closest(".select2-result-selectable");if(M.length>0&&!M.is(".select2-highlighted")){var O=this.findHighlightableChoices();this.highlight(O.index(M))}else{if(M.length==0){this.results.find(".select2-highlighted").removeClass("select2-highlighted")}}},loadMoreIfNeeded:function(){var Q=this.results,P=Q.find("li.select2-more-results"),T,S=-1,R=this.resultsPage+1,M=this,O=this.search.val(),N=this.context;if(P.length===0){return}T=P.offset().top-Q.offset().top-Q.height();if(T<=this.opts.loadMorePadding){P.addClass("select2-active");this.opts.query({element:this.opts.element,term:O,page:R,context:N,matcher:this.opts.matcher,callback:this.bind(function(U){if(!M.opened()){return}M.opts.populateResults.call(this,Q,U.results,{term:O,page:R,context:N});M.postprocessResults(U,false,false);if(U.more===true){P.detach().appendTo(Q).text(M.opts.formatLoadMore(R+1));window.setTimeout(function(){M.loadMoreIfNeeded()},10)}else{P.remove()}M.positionDropdown();M.resultsPage=R;M.context=U.context})})}},tokenize:function(){},updateResults:function(U){var X=this.search,S=this.results,M=this.opts,R,W=this,V,Q=X.val(),O=C.data(this.container,"select2-last-term");if(U!==true&&O&&s(Q,O)){return}C.data(this.container,"select2-last-term",Q);if(U!==true&&(this.showSearchInput===false||!this.opened())){return}function T(){S.scrollTop(0);X.removeClass("select2-active");W.positionDropdown()}function N(Y){S.html(Y);T()}var P=this.getMaximumSelectionSize();if(P>=1){R=this.data();if(C.isArray(R)&&R.length>=P&&x(M.formatSelectionTooBig,"formatSelectionTooBig")){N("<li class='select2-selection-limit'>"+M.formatSelectionTooBig(P)+"</li>");return}}if(X.val().length<M.minimumInputLength){if(x(M.formatInputTooShort,"formatInputTooShort")){N("<li class='select2-no-results'>"+M.formatInputTooShort(X.val(),M.minimumInputLength)+"</li>")}else{N("")}if(U){this.showSearch(true)}return}if(M.maximumInputLength&&X.val().length>M.maximumInputLength){if(x(M.formatInputTooLong,"formatInputTooLong")){N("<li class='select2-no-results'>"+M.formatInputTooLong(X.val(),M.maximumInputLength)+"</li>")}else{N("")}return}if(M.formatSearching&&this.findHighlightableChoices().length===0){N("<li class='select2-searching'>"+M.formatSearching()+"</li>")}X.addClass("select2-active");V=this.tokenize();if(V!=l&&V!=null){X.val(V)}this.resultsPage=1;M.query({element:M.element,term:X.val(),page:this.resultsPage,context:null,matcher:M.matcher,callback:this.bind(function(Z){var Y;if(!this.opened()){this.search.removeClass("select2-active");return}this.context=(Z.context===l)?null:Z.context;if(this.opts.createSearchChoice&&X.val()!==""){Y=this.opts.createSearchChoice.call(null,X.val(),Z.results);if(Y!==l&&Y!==null&&W.id(Y)!==l&&W.id(Y)!==null){if(C(Z.results).filter(function(){return s(W.id(this),W.id(Y))}).length===0){Z.results.unshift(Y)}}}if(Z.results.length===0&&x(M.formatNoMatches,"formatNoMatches")){N("<li class='select2-no-results'>"+M.formatNoMatches(X.val())+"</li>");return}S.empty();W.opts.populateResults.call(this,S,Z.results,{term:X.val(),page:this.resultsPage,context:null});if(Z.more===true&&x(M.formatLoadMore,"formatLoadMore")){S.append("<li class='select2-more-results'>"+W.opts.escapeMarkup(M.formatLoadMore(this.resultsPage))+"</li>");window.setTimeout(function(){W.loadMoreIfNeeded()},10)}this.postprocessResults(Z,U);T();this.opts.element.trigger({type:"select2-loaded",data:Z})})})},cancel:function(){this.close()},blur:function(){if(this.opts.selectOnBlur){this.selectHighlighted({noFocus:true})}this.close();this.container.removeClass("select2-container-active");if(this.search[0]===document.activeElement){this.search.blur()}this.clearSearch();this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){G(this.search)},selectHighlighted:function(N){var M=this.highlight(),O=this.results.find(".select2-highlighted"),P=O.closest(".select2-result").data("select2-data");if(P){this.highlight(M);this.onSelect(P,N)}},getPlaceholder:function(){return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder},initContainerWidth:function(){function N(){var R,P,S,Q,O;if(this.opts.width==="off"){return null}else{if(this.opts.width==="element"){return this.opts.element.outerWidth(false)===0?"auto":this.opts.element.outerWidth(false)+"px"}else{if(this.opts.width==="copy"||this.opts.width==="resolve"){R=this.opts.element.attr("style");if(R!==l){P=R.split(";");for(Q=0,O=P.length;Q<O;Q=Q+1){S=P[Q].replace(/\s/g,"").match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i);if(S!==null&&S.length>=1){return S[1]}}}R=this.opts.element.css("width");if(R&&R.length>0){return R}if(this.opts.width==="resolve"){return(this.opts.element.outerWidth(false)===0?"auto":this.opts.element.outerWidth(false)+"px")}return null}else{if(C.isFunction(this.opts.width)){return this.opts.width()}else{return this.opts.width}}}}}var M=N.call(this);if(M!==null){this.container.css("width",M)}}});w=J(L,{createContainer:function(){var M=C(document.createElement("div")).attr({"class":"select2-container"}).html(["<a href='javascript:void(0)' onclick='return false;' class='select2-choice' tabindex='-1'>","   <span>&nbsp;</span><abbr class='select2-search-choice-close'></abbr>","   <div><b></b></div>","</a>","<input class='select2-focusser select2-offscreen' type='text'/>","<div class='select2-drop select2-display-none'>","   <div class='select2-search'>","       <input type='text' autocomplete='off' autocorrect='off' autocapitilize='off' spellcheck='false' class='select2-input'/>","   </div>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return M},enableInterface:function(){if(this.parent.enableInterface.apply(this,arguments)){this.focusser.prop("disabled",!this.isInterfaceEnabled())}},opening:function(){var N,M;this.parent.opening.apply(this,arguments);if(this.showSearchInput!==false){this.search.val(this.focusser.val())}this.search.focus();N=this.search.get(0);if(N.createTextRange){M=N.createTextRange();M.collapse(false);M.select()}this.focusser.prop("disabled",true).val("");this.updateResults(true);this.opts.element.trigger(C.Event("select2-open"))},close:function(){if(!this.opened()){return}this.parent.close.apply(this,arguments);this.focusser.removeAttr("disabled");this.focusser.focus()},focus:function(){if(this.opened()){this.close()}else{this.focusser.removeAttr("disabled");this.focusser.focus()}},isFocused:function(){return this.container.hasClass("select2-container-active")},cancel:function(){this.parent.cancel.apply(this,arguments);this.focusser.removeAttr("disabled");this.focusser.focus()},initContainer:function(){var N,M=this.container,O=this.dropdown;this.showSearch(false);this.selection=N=M.find(".select2-choice");this.focusser=M.find(".select2-focusser");this.focusser.attr("id","s2id_autogen"+a());C("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.focusser.attr("id"));this.focusser.attr("tabindex",this.elementTabIndex);this.search.on("keydown",this.bind(function(P){if(!this.isInterfaceEnabled()){return}if(P.which===I.PAGE_UP||P.which===I.PAGE_DOWN){z(P);return}switch(P.which){case I.UP:case I.DOWN:this.moveHighlight((P.which===I.UP)?-1:1);z(P);return;case I.ENTER:this.selectHighlighted();z(P);return;case I.TAB:this.selectHighlighted({noFocus:true});return;case I.ESC:this.cancel(P);z(P);return}}));this.search.on("blur",this.bind(function(P){if(document.activeElement===this.body().get(0)){window.setTimeout(this.bind(function(){this.search.focus()}),0)}}));this.focusser.on("keydown",this.bind(function(P){if(!this.isInterfaceEnabled()){return}if(P.which===I.TAB||I.isControl(P)||I.isFunctionKey(P)||P.which===I.ESC){return}if(this.opts.openOnEnter===false&&P.which===I.ENTER){z(P);return}if(P.which==I.DOWN||P.which==I.UP||(P.which==I.ENTER&&this.opts.openOnEnter)){this.open();z(P);return}if(P.which==I.DELETE||P.which==I.BACKSPACE){if(this.opts.allowClear){this.clear()}z(P);return}}));E(this.focusser);this.focusser.on("keyup-change input",this.bind(function(P){P.stopPropagation();if(this.opened()){return}this.open()}));N.on("mousedown","abbr",this.bind(function(P){if(!this.isInterfaceEnabled()){return}this.clear();b(P);this.close();this.selection.focus()}));N.on("mousedown",this.bind(function(P){if(!this.container.hasClass("select2-container-active")){this.opts.element.trigger(C.Event("select2-focus"))}if(this.opened()){this.close()}else{if(this.isInterfaceEnabled()){this.open()}}z(P)}));O.on("mousedown",this.bind(function(){this.search.focus()}));N.on("focus",this.bind(function(P){z(P)}));this.focusser.on("focus",this.bind(function(){if(!this.container.hasClass("select2-container-active")){this.opts.element.trigger(C.Event("select2-focus"))}this.container.addClass("select2-container-active")})).on("blur",this.bind(function(){if(!this.opened()){this.container.removeClass("select2-container-active");this.opts.element.trigger(C.Event("select2-blur"))}}));this.search.on("focus",this.bind(function(){if(!this.container.hasClass("select2-container-active")){this.opts.element.trigger(C.Event("select2-focus"))}this.container.addClass("select2-container-active")}));this.initContainerWidth();this.opts.element.addClass("select2-offscreen");this.setPlaceholder()},clear:function(M){var N=this.selection.data("select2-data");if(N){this.opts.element.val("");this.selection.find("span").empty();this.selection.removeData("select2-data");this.setPlaceholder();if(M!==false){this.opts.element.trigger({type:"select2-removed",val:this.id(N),choice:N});this.triggerChange({removed:N})}}},initSelection:function(){var N;if(this.opts.element.val()===""&&this.opts.element.text()===""){this.updateSelection([]);this.close();this.setPlaceholder()}else{var M=this;this.opts.initSelection.call(null,this.opts.element,function(O){if(O!==l&&O!==null){M.updateSelection(O);M.close();M.setPlaceholder()}})}},prepareOpts:function(){var N=this.parent.prepareOpts.apply(this,arguments),M=this;if(N.element.get(0).tagName.toLowerCase()==="select"){N.initSelection=function(O,Q){var P=O.find(":selected");Q(M.optionToData(P))}}else{if("data" in N){N.initSelection=N.initSelection||function(P,R){var Q=P.val();var O=null;N.query({matcher:function(S,V,T){var U=s(Q,N.id(T));if(U){O=T}return U},callback:!C.isFunction(R)?C.noop:function(){R(O)}})}}}return N},getPlaceholder:function(){if(this.select){if(this.select.find("option").first().text()!==""){return l}}return this.parent.getPlaceholder.apply(this,arguments)},setPlaceholder:function(){var M=this.getPlaceholder();if(this.opts.element.val()===""&&M!==l){if(this.select&&this.select.find("option:first").text()!==""){return}this.selection.find("span").html(this.opts.escapeMarkup(M));this.selection.addClass("select2-default");this.container.removeClass("select2-allowclear")}},postprocessResults:function(R,N,Q){var P=0,M=this,S=true;this.findHighlightableChoices().each2(function(T,U){if(s(M.id(U.data("select2-data")),M.opts.element.val())){P=T;return false}});if(Q!==false){this.highlight(P)}if(N===true&&this.showSearchInput===false){var O=this.opts.minimumResultsForSearch;if(O>=0){this.showSearch(r(R.results)>=O)}}},showSearch:function(M){this.showSearchInput=M;this.dropdown.find(".select2-search").toggleClass("select2-search-hidden",!M);this.dropdown.find(".select2-search").toggleClass("select2-offscreen",!M);C(this.dropdown,this.container).toggleClass("select2-with-searchbox",M)},onSelect:function(O,N){if(!this.triggerSelect(O)){return}var M=this.opts.element.val(),P=this.data();this.opts.element.val(this.id(O));this.updateSelection(O);this.opts.element.trigger({type:"select2-selected",val:this.id(O),choice:O});this.close();if(!N||!N.noFocus){this.selection.focus()}if(!s(M,this.id(O))){this.triggerChange({added:O,removed:P})}},updateSelection:function(O){var M=this.selection.find("span"),N;this.selection.data("select2-data",O);M.empty();N=this.opts.formatSelection(O,M);if(N!==l){M.append(this.opts.escapeMarkup(N))}this.selection.removeClass("select2-default");if(this.opts.allowClear&&this.getPlaceholder()!==l){this.container.addClass("select2-allowclear")}},val:function(){var Q,N=false,O=null,M=this,P=this.data();if(arguments.length===0){return this.opts.element.val()}Q=arguments[0];if(arguments.length>1){N=arguments[1]}if(this.select){this.select.val(Q).find(":selected").each2(function(R,S){O=M.optionToData(S);return false});this.updateSelection(O);this.setPlaceholder();if(N){this.triggerChange({added:O,removed:P})}}else{if(this.opts.initSelection===l){throw new Error("cannot call val() if initSelection() is not defined")}if(!Q&&Q!==0){this.clear(N);return}this.opts.element.val(Q);this.opts.initSelection(this.opts.element,function(R){M.opts.element.val(!R?"":M.id(R));M.updateSelection(R);M.setPlaceholder();if(N){M.triggerChange({added:R,removed:P})}})}},clearSearch:function(){this.search.val("");this.focusser.val("")},data:function(O,M){var N;if(arguments.length===0){N=this.selection.data("select2-data");if(N==l){N=null}return N}else{if(!O||O===""){this.clear(M)}else{N=this.data();this.opts.element.val(!O?"":this.id(O));this.updateSelection(O);if(M){this.triggerChange({added:O,removed:N})}}}}});c=J(L,{createContainer:function(){var M=C(document.createElement("div")).attr({"class":"select2-container select2-container-multi"}).html(["    <ul class='select2-choices'>","  <li class='select2-search-field'>","    <input type='text' autocomplete='off' autocorrect='off' autocapitilize='off' spellcheck='false' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi select2-display-none'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return M},prepareOpts:function(){var N=this.parent.prepareOpts.apply(this,arguments),M=this;if(N.element.get(0).tagName.toLowerCase()==="select"){N.initSelection=function(O,Q){var P=[];O.find(":selected").each2(function(R,S){P.push(M.optionToData(S))});Q(P)}}else{if("data" in N){N.initSelection=N.initSelection||function(O,R){var P=h(O.val(),N.separator);var Q=[];N.query({matcher:function(S,V,T){var U=C.grep(P,function(W){return s(W,N.id(T))}).length;if(U){Q.push(T)}return U},callback:!C.isFunction(R)?C.noop:function(){var S=[];for(var V=0;V<P.length;V++){var W=P[V];for(var U=0;U<Q.length;U++){var T=Q[U];if(s(W,N.id(T))){S.push(T);Q.splice(U,1);break}}}R(S)}})}}}return N},selectChoice:function(M){var N=this.container.find(".select2-search-choice-focus");if(N.length&&M&&M[0]==N[0]){}else{if(N.length){this.opts.element.trigger("choice-deselected",N)}N.removeClass("select2-search-choice-focus");if(M&&M.length){this.close();M.addClass("select2-search-choice-focus");this.opts.element.trigger("choice-selected",M)}}},initContainer:function(){var M=".select2-choices",N;this.searchContainer=this.container.find(".select2-search-field");this.selection=N=this.container.find(M);var O=this;this.selection.on("mousedown",".select2-search-choice",function(P){O.search[0].focus();O.selectChoice(C(this))});this.search.attr("id","s2id_autogen"+a());C("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.search.attr("id"));this.search.on("input paste",this.bind(function(){if(!this.isInterfaceEnabled()){return}if(!this.opened()){this.open()}}));this.search.attr("tabindex",this.elementTabIndex);this.keydowns=0;this.search.on("keydown",this.bind(function(T){if(!this.isInterfaceEnabled()){return}++this.keydowns;var R=N.find(".select2-search-choice-focus");var S=R.prev(".select2-search-choice:not(.select2-locked)");var Q=R.next(".select2-search-choice:not(.select2-locked)");var U=d(this.search);if(R.length&&(T.which==I.LEFT||T.which==I.RIGHT||T.which==I.BACKSPACE||T.which==I.DELETE||T.which==I.ENTER)){var P=R;if(T.which==I.LEFT&&S.length){P=S}else{if(T.which==I.RIGHT){P=Q.length?Q:null}else{if(T.which===I.BACKSPACE){this.unselect(R.first());this.search.width(10);P=S.length?S:Q}else{if(T.which==I.DELETE){this.unselect(R.first());this.search.width(10);P=Q.length?Q:null}else{if(T.which==I.ENTER){P=null}}}}}this.selectChoice(P);z(T);if(!P||!P.length){this.open()}return}else{if(((T.which===I.BACKSPACE&&this.keydowns==1)||T.which==I.LEFT)&&(U.offset==0&&!U.length)){this.selectChoice(N.find(".select2-search-choice:not(.select2-locked)").last());z(T);return}else{this.selectChoice(null)}}if(this.opened()){switch(T.which){case I.UP:case I.DOWN:this.moveHighlight((T.which===I.UP)?-1:1);z(T);return;case I.ENTER:this.selectHighlighted();z(T);return;case I.TAB:this.selectHighlighted({noFocus:true});return;case I.ESC:this.cancel(T);z(T);return}}if(T.which===I.TAB||I.isControl(T)||I.isFunctionKey(T)||T.which===I.BACKSPACE||T.which===I.ESC){return}if(T.which===I.ENTER){if(this.opts.openOnEnter===false){return}else{if(T.altKey||T.ctrlKey||T.shiftKey||T.metaKey){return}}}this.open();if(T.which===I.PAGE_UP||T.which===I.PAGE_DOWN){z(T)}if(T.which===I.ENTER){z(T)}}));this.search.on("keyup",this.bind(function(P){this.keydowns=0;this.resizeSearch()}));this.search.on("blur",this.bind(function(P){this.container.removeClass("select2-container-active");this.search.removeClass("select2-focused");this.selectChoice(null);if(!this.opened()){this.clearSearch()}P.stopImmediatePropagation();this.opts.element.trigger(C.Event("select2-blur"))}));this.container.on("mousedown",M,this.bind(function(P){if(!this.isInterfaceEnabled()){return}if(C(P.target).closest(".select2-search-choice").length>0){return}this.selectChoice(null);this.clearPlaceholder();if(!this.container.hasClass("select2-container-active")){this.opts.element.trigger(C.Event("select2-focus"))}this.open();this.focusSearch();P.preventDefault()}));this.container.on("focus",M,this.bind(function(){if(!this.isInterfaceEnabled()){return}if(!this.container.hasClass("select2-container-active")){this.opts.element.trigger(C.Event("select2-focus"))}this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active");this.clearPlaceholder()}));this.initContainerWidth();this.opts.element.addClass("select2-offscreen");this.clearSearch()},enableInterface:function(){if(this.parent.enableInterface.apply(this,arguments)){this.search.prop("disabled",!this.isInterfaceEnabled())}},initSelection:function(){var N;if(this.opts.element.val()===""&&this.opts.element.text()===""){this.updateSelection([]);this.close();this.clearSearch()}if(this.select||this.opts.element.val()!==""){var M=this;this.opts.initSelection.call(null,this.opts.element,function(O){if(O!==l&&O!==null){M.updateSelection(O);M.close();M.clearSearch()}})}},clearSearch:function(){var N=this.getPlaceholder(),M=this.getMaxSearchWidth();if(N!==l&&this.getVal().length===0&&this.search.hasClass("select2-focused")===false){this.search.val(N).addClass("select2-default");this.search.width(M>0?M:this.container.css("width"))}else{this.search.val("").width(10)}},clearPlaceholder:function(){if(this.search.hasClass("select2-default")){this.search.val("").removeClass("select2-default")}},opening:function(){this.clearPlaceholder();this.resizeSearch();this.parent.opening.apply(this,arguments);this.focusSearch();this.updateResults(true);this.search.focus();this.opts.element.trigger(C.Event("select2-open"))},close:function(){if(!this.opened()){return}this.parent.close.apply(this,arguments)},focus:function(){this.close();this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(P){var O=[],N=[],M=this;C(P).each(function(){if(p(M.id(this),O)<0){O.push(M.id(this));N.push(this)}});P=N;this.selection.find(".select2-search-choice").remove();C(P).each(function(){M.addSelectedChoice(this)});M.postprocessResults()},tokenize:function(){var M=this.search.val();M=this.opts.tokenizer(M,this.data(),this.bind(this.onSelect),this.opts);if(M!=null&&M!=l){this.search.val(M);if(M.length>0){this.open()}}},onSelect:function(N,M){if(!this.triggerSelect(N)){return}this.addSelectedChoice(N);this.opts.element.trigger({type:"selected",val:this.id(N),choice:N});if(this.select||!this.opts.closeOnSelect){this.postprocessResults()}if(this.opts.closeOnSelect){this.close();this.search.width(10)}else{if(this.countSelectableResults()>0){this.search.width(10);this.resizeSearch();if(this.getMaximumSelectionSize()>0&&this.val().length>=this.getMaximumSelectionSize()){this.updateResults(true)}this.positionDropdown()}else{this.close();this.search.width(10)}}this.triggerChange({added:N});if(!M||!M.noFocus){this.focusSearch()}},cancel:function(){this.close();this.focusSearch()},addSelectedChoice:function(P){var N=!P.locked,T=C("<li class='select2-search-choice'>    <div></div>    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a></li>"),S=C("<li class='select2-search-choice select2-locked'><div></div></li>");var M=N?T:S,R=this.id(P),Q=this.getVal(),O;O=this.opts.formatSelection(P,M.find("div"));if(O!=l){M.find("div").replaceWith("<div title='"+this.opts.escapeMarkup(O)+"'>"+this.opts.escapeMarkup(O)+"</div>")}if(N){M.find(".select2-search-choice-close").on("mousedown",z).on("click dblclick",this.bind(function(U){if(!this.isInterfaceEnabled()){return}C(U.target).closest(".select2-search-choice").fadeOut("fast",this.bind(function(){this.unselect(C(U.target));this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");this.close();this.focusSearch()})).dequeue();z(U)})).on("focus",this.bind(function(){if(!this.isInterfaceEnabled()){return}this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active")}))}M.data("select2-data",P);M.insertBefore(this.searchContainer);Q.push(R);this.setVal(Q)},unselect:function(N){var P=this.getVal(),O,M;N=N.closest(".select2-search-choice");if(N.length===0){throw"Invalid argument: "+N+". Must be .select2-search-choice"}O=N.data("select2-data");if(!O){return}M=p(this.id(O),P);if(M>=0){P.splice(M,1);this.setVal(P);if(this.select){this.postprocessResults()}}N.remove();this.opts.element.trigger({type:"removed",val:this.id(O),choice:O});this.triggerChange({removed:O})},postprocessResults:function(Q,N,P){var R=this.getVal(),S=this.results.find(".select2-result"),O=this.results.find(".select2-result-with-children"),M=this;S.each2(function(U,T){var V=M.id(T.data("select2-data"));if(p(V,R)>=0){T.addClass("select2-selected");T.find(".select2-result-selectable").addClass("select2-selected")}});O.each2(function(U,T){if(!T.is(".select2-result-selectable")&&T.find(".select2-result-selectable:not(.select2-selected)").length===0){T.addClass("select2-selected")}});if(this.highlight()==-1&&P!==false){M.highlight(0)}if(!this.opts.createSearchChoice&&!S.filter(".select2-result:not(.select2-selected)").length>0){this.results.append("<li class='select2-no-results'>"+M.opts.formatNoMatches(M.search.val())+"</li>")}},getMaxSearchWidth:function(){return this.selection.width()-g(this.search)},resizeSearch:function(){var R,P,O,M,N,Q=g(this.search);R=m(this.search)+10;P=this.search.offset().left;O=this.selection.width();M=this.selection.offset().left;N=O-(P-M)-Q;if(N<R){N=O-Q}if(N<40){N=O-Q}if(N<=0){N=R}this.search.width(N)},getVal:function(){var M;if(this.select){M=this.select.val();return M===null?[]:M}else{M=this.opts.element.val();return h(M,this.opts.separator)}},setVal:function(N){var M;if(this.select){this.select.val(N)}else{M=[];C(N).each(function(){if(p(this,M)<0){M.push(this)}});this.opts.element.val(M.length===0?"":M.join(this.opts.separator))}},buildChangeDetails:function(M,P){var P=P.slice(0),M=M.slice(0);for(var O=0;O<P.length;O++){for(var N=0;N<M.length;N++){if(s(this.opts.id(P[O]),this.opts.id(M[N]))){P.splice(O,1);O--;M.splice(N,1);N--}}}return{added:P,removed:M}},val:function(Q,N){var P,M=this,O;if(arguments.length===0){return this.getVal()}P=this.data();if(!P.length){P=[]}if(!Q&&Q!==0){this.opts.element.val("");this.updateSelection([]);this.clearSearch();if(N){this.triggerChange({added:this.data(),removed:P})}return}this.setVal(Q);if(this.select){this.opts.initSelection(this.select,this.bind(this.updateSelection));if(N){this.triggerChange(this.buildChangeDetails(P,this.data()))}}else{if(this.opts.initSelection===l){throw new Error("val() cannot be called if initSelection() is not defined")}this.opts.initSelection(this.opts.element,function(S){var R=C(S).map(M.id);M.setVal(R);M.updateSelection(S);M.clearSearch();if(N){M.triggerChange(this.buildChangeDetails(P,this.data()))}})}this.clearSearch()},onSortStart:function(){if(this.select){throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.")}this.search.width(0);this.searchContainer.hide()},onSortEnd:function(){var N=[],M=this;this.searchContainer.show();this.searchContainer.appendTo(this.searchContainer.parent());this.resizeSearch();this.selection.find(".select2-search-choice").each(function(){N.push(M.opts.id(C(this).data("select2-data")))});this.setVal(N);this.triggerChange()},data:function(O,P){var N=this,Q,M;if(arguments.length===0){return this.selection.find(".select2-search-choice").map(function(){return C(this).data("select2-data")}).get()}else{M=this.data();if(!O){O=[]}Q=C.map(O,function(R){return N.opts.id(R)});this.setVal(Q);this.updateSelection(O);this.clearSearch();if(P){this.triggerChange(this.buildChangeDetails(M,this.data()))}}}});C.fn.select2=function(){var P=Array.prototype.slice.call(arguments,0),Q,O,R,N,M=["val","destroy","opened","open","close","focus","isFocused","container","onSortStart","onSortEnd","enable","readonly","positionDropdown","data"],S=["val","opened","isFocused","container","data"];this.each(function(){if(P.length===0||typeof(P[0])==="object"){Q=P.length===0?{}:C.extend({},P[0]);Q.element=C(this);if(Q.element.get(0).tagName.toLowerCase()==="select"){N=Q.element.prop("multiple")}else{N=Q.multiple||false;if("tags" in Q){Q.multiple=N=true}}O=N?new c():new w();O.init(Q)}else{if(typeof(P[0])==="string"){if(p(P[0],M)<0){throw"Unknown method: "+P[0]}R=l;O=C(this).data("select2");if(O===l){return}if(P[0]==="container"){R=O.container}else{R=O[P[0]].apply(O,P.slice(1))}if(p(P[0],S)>=0){return false}}else{throw"Invalid arguments to select2 plugin: "+P}}});return(R===l)?this:R};C.fn.select2.defaults={width:"copy",loadMorePadding:0,closeOnSelect:true,openOnEnter:true,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(N,O,Q,M){var P=[];t(N.text,Q.term,P,M);return P.join("")},formatSelection:function(N,M){return N?N.text:l},sortResults:function(N,M,O){return N},formatResultCssClass:function(M){return l},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(M,N){var O=N-M.length;return"Please enter "+O+" more character"+(O==1?"":"s")},formatInputTooLong:function(N,M){var O=N.length-M;return"Please delete "+O+" character"+(O==1?"":"s")},formatSelectionTooBig:function(M){return"You can only select "+M+" item"+(M==1?"":"s")},formatLoadMore:function(M){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(M){return M.id},matcher:function(M,N){return(""+N).toUpperCase().indexOf((""+M).toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:f,escapeMarkup:function(M){var N={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return String(M).replace(/[&<>"'\/\\]/g,function(O){return N[O]})},blurOnChange:false,selectOnBlur:false,adaptContainerCssClass:function(M){return M},adaptDropdownCssClass:function(M){return null}};C.fn.select2.ajaxDefaults={transport:C.ajax,params:{type:"GET",cache:false,dataType:"json"}}}(jQueryFix));(function(c){function f(a,i,h){return a.addEventListener?a.addEventListener(i,h,!1):a.attachEvent?a.attachEvent("on"+i,h):void 0}function d(a,i){var h,j;for(h=0,j=a.length;j>h;h++){if(a[h]===i){return !0}}return !1}function g(a,i){var h;a.createTextRange?(h=a.createTextRange(),h.move("character",i),h.select()):a.selectionStart&&(a.focus(),a.setSelectionRange(i,i))}function b(a,i){try{return a.type=i,!0}catch(h){return !1}}c.Placeholders={Utils:{addEventListener:f,inArray:d,moveCaret:g,changeType:b}}})(this),function(av){function aK(){}function ax(){try{return document.activeElement}catch(a){}}function aB(d,g){var f,h,b=!!g&&d.value!==g,c=d.value===d.getAttribute(M);return(b||c)&&"true"===d.getAttribute(aa)?(d.removeAttribute(aa),d.value=d.value.replace(d.getAttribute(M),""),d.className=d.className.replace(Y,""),h=d.getAttribute(ao),parseInt(h,10)>=0&&(d.setAttribute("maxLength",h),d.removeAttribute(ao)),f=d.getAttribute(ak),f&&(d.type=f),!0):!1}function aO(a){var c,b,d=a.getAttribute(M);return""===a.value&&d?(a.setAttribute(aa,"true"),a.value=d,a.className+=" "+af,b=a.getAttribute(ao),b||(a.setAttribute(ao,a.maxLength),a.removeAttribute("maxLength")),c=a.getAttribute(ak),c?a.type="text":"password"===a.type&&ad.changeType(a,"text")&&a.setAttribute(ak,"password"),!0):!1}function au(m,h){var b,d,j,k,g,f,c;if(m&&m.getAttribute(M)){h(m)}else{for(j=m?m.getElementsByTagName("input"):aJ,k=m?m.getElementsByTagName("textarea"):aH,b=j?j.length:0,d=k?k.length:0,c=0,f=b+d;f>c;c++){g=b>c?j[c]:k[c-b],h(g)}}}function aG(a){au(a,aB)}function aD(a){au(a,aO)}function aA(a){return function(){aN&&a.value===a.getAttribute(M)&&"true"===a.getAttribute(aa)?ad.moveCaret(a,0):aB(a)}}function aM(a){return function(){aO(a)}}function aw(a){return function(b){return an=a.value,"true"===a.getAttribute(aa)&&an===a.getAttribute(M)&&ad.inArray(al,b.keyCode)?(b.preventDefault&&b.preventDefault(),!1):void 0}}function aL(a){return function(){aB(a,an),""===a.value&&(a.blur(),ad.moveCaret(a,0))}}function at(a){return function(){a===ax()&&a.value===a.getAttribute(M)&&"true"===a.getAttribute(aa)&&ad.moveCaret(a,0)}}function aI(a){return function(){aG(a)}}function az(a){a.form&&(W=a.form,"string"==typeof W&&(W=document.getElementById(W)),W.getAttribute(O)||(ad.addEventListener(W,"submit",aI(W)),W.setAttribute(O,"true"))),ad.addEventListener(a,"focus",aA(a)),ad.addEventListener(a,"blur",aM(a)),aN&&(ad.addEventListener(a,"keydown",aw(a)),ad.addEventListener(a,"keyup",aL(a)),ad.addEventListener(a,"click",at(a))),a.setAttribute(aF,"true"),a.setAttribute(M,aq),(aN||a!==ax())&&aO(a)}var aJ,aH,aN,aC,an,ap,aj,aq,ac,W,X,ab,ar,am=["text","search","url","tel","email","password","number","textarea"],al=[27,33,34,35,36,37,38,39,40,8,46],aE="#ccc",af="placeholdersjs",Y=RegExp("(?:^|\\s)"+af+"(?!\\S)"),M="data-placeholder-value",aa="data-placeholder-active",ak="data-placeholder-type",O="data-placeholder-submit",aF="data-placeholder-bound",ay="data-placeholder-focus",Z="data-placeholder-live",ao="data-placeholder-maxlength",ai=document.createElement("input"),ah=document.getElementsByTagName("head")[0],ag=document.documentElement,ae=av.Placeholders,ad=ae.Utils;if(ae.nativeSupport=void 0!==ai.placeholder,!ae.nativeSupport){for(aJ=document.getElementsByTagName("input"),aH=document.getElementsByTagName("textarea"),aN="false"===ag.getAttribute(ay),aC="false"!==ag.getAttribute(Z),ap=document.createElement("style"),ap.type="text/css",aj=document.createTextNode("."+af+" { color:"+aE+"; }"),ap.styleSheet?ap.styleSheet.cssText=aj.nodeValue:ap.appendChild(aj),ah.insertBefore(ap,ah.firstChild),ar=0,ab=aJ.length+aH.length;ab>ar;ar++){X=aJ.length>ar?aJ[ar]:aH[ar-aJ.length],aq=X.attributes.placeholder,aq&&(aq=aq.nodeValue,aq&&ad.inArray(am,X.type)&&az(X))}ac=setInterval(function(){for(ar=0,ab=aJ.length+aH.length;ab>ar;ar++){X=aJ.length>ar?aJ[ar]:aH[ar-aJ.length],aq=X.attributes.placeholder,aq?(aq=aq.nodeValue,aq&&ad.inArray(am,X.type)&&(X.getAttribute(aF)||az(X),(aq!==X.getAttribute(M)||"password"===X.type&&!X.getAttribute(ak))&&("password"===X.type&&!X.getAttribute(ak)&&ad.changeType(X,"text")&&X.setAttribute(ak,"password"),X.value===X.getAttribute(M)&&(X.value=aq),X.setAttribute(M,aq)))):X.getAttribute(aa)&&(aB(X),X.removeAttribute(M))}aC||clearInterval(ac)},100)}ad.addEventListener(av,"beforeunload",function(){ae.disable()}),ae.disable=ae.nativeSupport?aK:aG,ae.enable=ae.nativeSupport?aK:aD}(this),function(a){var c=a.fn.val,b=a.fn.prop;Placeholders.nativeSupport||(a.fn.val=function(d){var f=c.apply(this,arguments),g=this.eq(0).data("placeholder-value");return void 0===d&&this.eq(0).data("placeholder-active")&&f===g?"":f},a.fn.prop=function(d,f){return void 0===f&&this.eq(0).data("placeholder-active")&&"value"===d?"":b.apply(this,arguments)})}(jQueryFix);
/*!
ICanHaz.js version 0.10.2 -- by @HenrikJoreteg
More info at: http://icanhazjs.com
*/
(function(){var a=function(){var b=Object.prototype.toString;Array.isArray=Array.isArray||function(l){return b.call(l)=="[object Array]"};var k=String.prototype.trim,c;if(k){c=function(l){return l==null?"":k.call(l)}}else{var d,i;if((/\S/).test("\xA0")){d=/^[\s\xA0]+/;i=/[\s\xA0]+$/}else{d=/^\s+/;i=/\s+$/}c=function(l){return l==null?"":l.toString().replace(d,"").replace(i,"")}}var h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function j(l){return String(l).replace(/&(?!\w+;)|[<>"']/g,function(m){return h[m]||m})}var g={};var f=function(){};f.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":true},context:{},render:function(o,n,m,p){if(!p){this.context=n;this.buffer=[]}if(!this.includes("",o)){if(p){return o}else{this.send(o);return}}o=this.render_pragmas(o);var l=this.render_section(o,n,m);if(l===false){l=this.render_tags(o,n,m,p)}if(p){return l}else{this.sendLines(l)}},send:function(l){if(l!==""){this.buffer.push(l)}},sendLines:function(n){if(n){var l=n.split("\n");for(var m=0;m<l.length;m++){this.send(l[m])}}},render_pragmas:function(l){if(!this.includes("%",l)){return l}var n=this;var m=this.getCachedRegex("render_pragmas",function(p,o){return new RegExp(p+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+o,"g")});return l.replace(m,function(q,o,p){if(!n.pragmas_implemented[o]){throw ({message:"This implementation of mustache doesn't understand the '"+o+"' pragma"})}n.pragmas[o]={};if(p){var r=p.split("=");n.pragmas[o][r[0]]=r[1]}return""})},render_partial:function(l,n,m){l=c(l);if(!m||m[l]===undefined){throw ({message:"unknown_partial '"+l+"'"})}if(!n||typeof n[l]!="object"){return this.render(m[l],n,m,true)}return this.render(m[l],n[l],m,true)},render_section:function(n,m,l){if(!this.includes("#",n)&&!this.includes("^",n)){return false}var p=this;var o=this.getCachedRegex("render_section",function(r,q){return new RegExp("^([\\s\\S]*?)"+r+"(\\^|\\#)\\s*(.+)\\s*"+q+"\n*([\\s\\S]*?)"+r+"\\/\\s*\\3\\s*"+q+"\\s*([\\s\\S]*)$","g")});return n.replace(o,function(t,x,w,s,u,r){var z=x?p.render_tags(x,m,l,true):"",v=r?p.render(r,m,l,true):"",q,y=p.find(s,m);if(w==="^"){if(!y||Array.isArray(y)&&y.length===0){q=p.render(u,m,l,true)}else{q=""}}else{if(w==="#"){if(Array.isArray(y)){q=p.map(y,function(A){return p.render(u,p.create_context(A),l,true)}).join("")}else{if(p.is_object(y)){q=p.render(u,p.create_context(y),l,true)}else{if(typeof y=="function"){q=y.call(m,u,function(A){return p.render(A,m,l,true)})}else{if(y){q=p.render(u,m,l,true)}else{q=""}}}}}}return z+q+v})},render_tags:function(t,l,n,p){var o=this;var s=function(){return o.getCachedRegex("render_tags",function(w,v){return new RegExp(w+"(=|!|>|&|\\{|%)?([^#\\^]+?)\\1?"+v+"+","g")})};var q=s();var r=function(x,v,w){switch(v){case"!":return"";case"=":o.set_delimiters(w);q=s();return"";case">":return o.render_partial(w,l,n);case"{":case"&":return o.find(w,l);default:return j(o.find(w,l))}};var u=t.split("\n");for(var m=0;m<u.length;m++){u[m]=u[m].replace(q,r,this);if(!p){this.send(u[m])}}if(p){return u.join("\n")}},set_delimiters:function(m){var l=m.split(" ");this.otag=this.escape_regex(l[0]);this.ctag=this.escape_regex(l[1])},escape_regex:function(m){if(!arguments.callee.sRE){var l=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+l.join("|\\")+")","g")}return m.replace(arguments.callee.sRE,"\\$1")},find:function(n,o){n=c(n);function m(q){return q===false||q===0||q}var p;if(n.match(/([a-z_]+)\./ig)){var l=this.walk_context(n,o);if(m(l)){p=l}}else{if(m(o[n])){p=o[n]}else{if(m(this.context[n])){p=this.context[n]}}}if(typeof p=="function"){return p.apply(o)}if(p!==undefined){return p}return""},walk_context:function(l,m){var p=l.split(".");var o=(m[p[0]]!=undefined)?m:this.context;var n=o[p.shift()];while(n!=undefined&&p.length>0){o=n;n=n[p.shift()]}if(typeof n=="function"){return n.apply(o)}return n},includes:function(m,l){return l.indexOf(this.otag+m)!=-1},create_context:function(m){if(this.is_object(m)){return m}else{var n=".";if(this.pragmas["IMPLICIT-ITERATOR"]){n=this.pragmas["IMPLICIT-ITERATOR"].iterator}var l={};l[n]=m;return l}},is_object:function(l){return l&&typeof l=="object"},map:function(q,o){if(typeof q.map=="function"){return q.map(o)}else{var p=[];var m=q.length;for(var n=0;n<m;n++){p.push(o(q[n]))}return p}},getCachedRegex:function(m,p){var o=g[this.otag];if(!o){o=g[this.otag]={}}var l=o[this.ctag];if(!l){l=o[this.ctag]={}}var n=l[m];if(!n){n=l[m]=p(this.otag,this.ctag)}return n}};return({name:"mustache.js",version:"0.4.0",to_html:function(n,l,m,p){var o=new f();if(p){o.send=p}o.render(n,l||{},m);if(!p){return o.buffer.join("\n")}}})}();
/*!
  ICanHaz.js -- by @HenrikJoreteg
*/
(function(){function b(f){if("".trim){return f.trim()}else{return f.replace(/^\s+/,"").replace(/\s+$/,"")}}var c=this;var d={VERSION:"0.10.2",templates:{},$:(typeof window!=="undefined")?window.jQueryFix||window.Zepto||null:null,addTemplate:function(f,h){if(typeof f==="object"){for(var g in f){this.addTemplate(g,f[g])}return}if(d[f]){console.error("Invalid name: "+f+".")}else{if(d.templates[f]){console.error('Template "'+f+'  " exists')}else{d.templates[f]=h;d[f]=function(k,j){k=k||{};var i=a.to_html(d.templates[f],k,d.templates);return(d.$&&!j)?d.$(b(i)):i}}}},clearAll:function(){for(var f in d.templates){delete d[f]}d.templates={}},refresh:function(){d.clearAll();d.grabTemplates()},grabTemplates:function(m){var k,g,f=(m||document).getElementsByTagName("script"),h,j=[];for(k=0,g=f.length;k<g;k++){h=f[k];if(h&&h.innerHTML&&h.id&&(h.type==="text/html"||h.type==="text/x-icanhaz")){d.addTemplate(h.id,b(h.innerHTML));j.unshift(h)}}for(k=0,g=j.length;k<g;k++){j[k].parentNode.removeChild(j[k])}}};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=d}exports.ich=d}else{c.ich=d}if(typeof document!=="undefined"){if(d.$){d.$(function(){d.grabTemplates()})}else{document.addEventListener("DOMContentLoaded",function(){d.grabTemplates()},true)}}})()})();
/*!
 * jQuery Validation Plugin v1.12.0
 *
 * http://jqueryvalidation.org/
 *
 * Copyright (c) 2014 Jörn Zaefferer
 * Released under the MIT license
 */
(function(b){b.extend(b.fn,{validate:function(c){if(!this.length){if(c&&c.debug&&window.console){console.warn("Nothing selected, can't validate, returning nothing.")}return}var d=b.data(this[0],"validator");if(d){return d}this.attr("novalidate","novalidate");d=new b.validator(c,this[0]);b.data(this[0],"validator",d);if(d.settings.onsubmit){this.validateDelegate(":submit","click",function(f){if(d.settings.submitHandler){d.submitButton=f.target}if(b(f.target).hasClass("cancel")){d.cancelSubmit=true}if(b(f.target).attr("formnovalidate")!==undefined){d.cancelSubmit=true}});this.submit(function(f){if(d.settings.debug){f.preventDefault()}function g(){var h;if(d.settings.submitHandler){if(d.submitButton){h=b("<input type='hidden'/>").attr("name",d.submitButton.name).val(b(d.submitButton).val()).appendTo(d.currentForm)}d.settings.submitHandler.call(d,d.currentForm,f);if(d.submitButton){h.remove()}return false}return true}if(d.cancelSubmit){d.cancelSubmit=false;return g()}if(d.form()){if(d.pendingRequest){d.formSubmitted=true;return false}return g()}else{d.focusInvalid();return false}})}return d},valid:function(){var d,c;if(b(this[0]).is("form")){d=this.validate().form()}else{d=true;c=b(this[0].form).validate();this.each(function(){d=c.element(this)&&d})}return d},removeAttrs:function(f){var c={},d=this;b.each(f.split(/\s/),function(g,h){c[h]=d.attr(h);d.removeAttr(h)});return c},rules:function(g,c){var i=this[0],f,k,l,h,d,j;if(g){f=b.data(i.form,"validator").settings;k=f.rules;l=b.validator.staticRules(i);switch(g){case"add":b.extend(l,b.validator.normalizeRule(c));delete l.messages;k[i.name]=l;if(c.messages){f.messages[i.name]=b.extend(f.messages[i.name],c.messages)}break;case"remove":if(!c){delete k[i.name];return l}j={};b.each(c.split(/\s/),function(m,n){j[n]=l[n];delete l[n];if(n==="required"){b(i).removeAttr("aria-required")}});return j}}h=b.validator.normalizeRules(b.extend({},b.validator.classRules(i),b.validator.attributeRules(i),b.validator.dataRules(i),b.validator.staticRules(i)),i);if(h.required){d=h.required;delete h.required;h=b.extend({required:d},h);b(i).attr("aria-required","true")}if(h.remote){d=h.remote;delete h.remote;h=b.extend(h,{remote:d})}return h}});b.extend(b.expr[":"],{blank:function(c){return !b.trim(""+b(c).val())},filled:function(c){return !!b.trim(""+b(c).val())},unchecked:function(c){return !b(c).prop("checked")}});b.validator=function(c,d){this.settings=b.extend(true,{},b.validator.defaults,c);this.currentForm=d;this.init()};b.validator.format=function(c,d){if(arguments.length===1){return function(){var f=b.makeArray(arguments);f.unshift(c);return b.validator.format.apply(this,f)}}if(arguments.length>2&&d.constructor!==Array){d=b.makeArray(arguments).slice(1)}if(d.constructor!==Array){d=[d]}b.each(d,function(f,g){c=c.replace(new RegExp("\\{"+f+"\\}","g"),function(){return g})});return c};b.extend(b.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:b([]),errorLabelContainer:b([]),onsubmit:true,ignore:":hidden",ignoreTitle:false,onfocusin:function(c){this.lastActive=c;if(this.settings.focusCleanup&&!this.blockFocusCleanup){if(this.settings.unhighlight){this.settings.unhighlight.call(this,c,this.settings.errorClass,this.settings.validClass)}this.addWrapper(this.errorsFor(c)).hide()}},onfocusout:function(c){if(!this.checkable(c)&&(c.name in this.submitted||!this.optional(c))){this.element(c)}},onkeyup:function(c,d){if(d.which===9&&this.elementValue(c)===""){return}else{if(c.name in this.submitted||c===this.lastElement){this.element(c)}}},onclick:function(c){if(c.name in this.submitted){this.element(c)}else{if(c.parentNode.name in this.submitted){this.element(c.parentNode)}}},highlight:function(f,c,d){if(f.type==="radio"){this.findByName(f.name).addClass(c).removeClass(d)}else{b(f).addClass(c).removeClass(d)}},unhighlight:function(f,c,d){if(f.type==="radio"){this.findByName(f.name).removeClass(c).addClass(d)}else{b(f).removeClass(c).addClass(d)}}},setDefaults:function(c){b.extend(b.validator.defaults,c)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:b.validator.format("Please enter no more than {0} characters."),minlength:b.validator.format("Please enter at least {0} characters."),rangelength:b.validator.format("Please enter a value between {0} and {1} characters long."),range:b.validator.format("Please enter a value between {0} and {1}."),max:b.validator.format("Please enter a value less than or equal to {0}."),min:b.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){this.labelContainer=b(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||b(this.currentForm);this.containers=b(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var c=(this.groups={}),f;b.each(this.settings.groups,function(g,h){if(typeof h==="string"){h=h.split(/\s/)}b.each(h,function(j,i){c[i]=g})});f=this.settings.rules;b.each(f,function(g,h){f[g]=b.validator.normalizeRule(h)});function d(j){var h=b.data(this[0].form,"validator"),g="on"+j.type.replace(/^validate/,""),i=h.settings;if(i[g]&&!this.is(i.ignore)){i[g].call(h,this[0],j)}}b(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'] ","focusin focusout keyup",d).validateDelegate("[type='radio'], [type='checkbox'], select, option","click",d);if(this.settings.invalidHandler){b(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)}b(this.currentForm).find("[required], [data-rule-required], .required").attr("aria-required","true")},form:function(){this.checkForm();b.extend(this.submitted,this.errorMap);this.invalid=b.extend({},this.errorMap);if(!this.valid()){b(this.currentForm).triggerHandler("invalid-form",[this])}this.showErrors();return this.valid()},checkForm:function(){this.prepareForm();for(var c=0,d=(this.currentElements=this.elements());d[c];c++){this.check(d[c])}return this.valid()},element:function(f){var g=this.clean(f),d=this.validationTargetFor(g),c=true;this.lastElement=d;if(d===undefined){delete this.invalid[g.name]}else{this.prepareElement(d);this.currentElements=b(d);c=this.check(d)!==false;if(c){delete this.invalid[d.name]}else{this.invalid[d.name]=true}}b(f).attr("aria-invalid",!c);if(!this.numberOfInvalids()){this.toHide=this.toHide.add(this.containers)}this.showErrors();return c},showErrors:function(d){if(d){b.extend(this.errorMap,d);this.errorList=[];for(var c in d){this.errorList.push({message:d[c],element:this.findByName(c)[0]})}this.successList=b.grep(this.successList,function(f){return !(f.name in d)})}if(this.settings.showErrors){this.settings.showErrors.call(this,this.errorMap,this.errorList)}else{this.defaultShowErrors()}},resetForm:function(){if(b.fn.resetForm){b(this.currentForm).resetForm()}this.submitted={};this.lastElement=null;this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass).removeData("previousValue").removeAttr("aria-invalid")},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(f){var d=0,c;for(c in f){d++}return d},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return this.size()===0},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid){try{b(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(c){}}},findLastActive:function(){var c=this.lastActive;return c&&b.grep(this.errorList,function(d){return d.element.name===c.name}).length===1&&c},elements:function(){var d=this,c={};return b(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){if(!this.name&&d.settings.debug&&window.console){console.error("%o has no name assigned",this)}if(this.name in c||!d.objectLength(b(this).rules())){return false}c[this.name]=true;return true})},clean:function(c){return b(c)[0]},errors:function(){var c=this.settings.errorClass.split(" ").join(".");return b(this.settings.errorElement+"."+c,this.errorContext)},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=b([]);this.toHide=b([]);this.currentElements=b([])},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers)},prepareElement:function(c){this.reset();this.toHide=this.errorsFor(c)},elementValue:function(d){var g,c=b(d),f=c.attr("type");if(f==="radio"||f==="checkbox"){return b("input[name='"+c.attr("name")+"']:checked").val()}g=c.val();if(typeof g==="string"){return g.replace(/\r/g,"")}return g},check:function(f){f=this.validationTargetFor(this.clean(f));var j=b(f).rules(),h=b.map(j,function(o,m){return m}).length,k=false,d=this.elementValue(f),l,c,i;for(c in j){i={method:c,parameters:j[c]};try{l=b.validator.methods[c].call(this,d,f,i.parameters);if(l==="dependency-mismatch"&&h===1){k=true;continue}k=false;if(l==="pending"){this.toHide=this.toHide.not(this.errorsFor(f));return}if(!l){this.formatAndAdd(f,i);return false}}catch(g){if(this.settings.debug&&window.console){console.log("Exception occurred when checking element "+f.id+", check the '"+i.method+"' method.",g)}throw g}}if(k){return}if(this.objectLength(j)){this.successList.push(f)}return true},customDataMessage:function(c,d){return b(c).data("msg"+d[0].toUpperCase()+d.substring(1).toLowerCase())||b(c).data("msg")},customMessage:function(d,f){var c=this.settings.messages[d];return c&&(c.constructor===String?c:c[f])},findDefined:function(){for(var c=0;c<arguments.length;c++){if(arguments[c]!==undefined){return arguments[c]}}return undefined},defaultMessage:function(c,d){return this.findDefined(this.customMessage(c.name,d),this.customDataMessage(c,d),!this.settings.ignoreTitle&&c.title||undefined,b.validator.messages[d],"<strong>Warning: No message defined for "+c.name+"</strong>")},formatAndAdd:function(d,g){var f=this.defaultMessage(d,g.method),c=/\$?\{(\d+)\}/g;if(typeof f==="function"){f=f.call(this,g.parameters,d)}else{if(c.test(f)){f=b.validator.format(f.replace(c,"{$1}"),g.parameters)}}this.errorList.push({message:f,element:d,method:g.method});this.errorMap[d.name]=f;this.submitted[d.name]=f},addWrapper:function(c){if(this.settings.wrapper){c=c.add(c.parent(this.settings.wrapper))}return c},defaultShowErrors:function(){var d,f,c;for(d=0;this.errorList[d];d++){c=this.errorList[d];if(this.settings.highlight){this.settings.highlight.call(this,c.element,this.settings.errorClass,this.settings.validClass)}this.showLabel(c.element,c.message)}if(this.errorList.length){this.toShow=this.toShow.add(this.containers)}if(this.settings.success){for(d=0;this.successList[d];d++){this.showLabel(this.successList[d])}}if(this.settings.unhighlight){for(d=0,f=this.validElements();f[d];d++){this.settings.unhighlight.call(this,f[d],this.settings.errorClass,this.settings.validClass)}}this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return b(this.errorList).map(function(){return this.element})},showLabel:function(d,f){var c=this.errorsFor(d);if(c.length){c.removeClass(this.settings.validClass).addClass(this.settings.errorClass);c.html(f)}else{c=b("<"+this.settings.errorElement+">").attr("for",this.idOrName(d)).addClass(this.settings.errorClass).html(f||"");if(this.settings.wrapper){c=c.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()}if(!this.labelContainer.append(c).length){if(this.settings.errorPlacement){this.settings.errorPlacement(c,b(d))}else{c.insertAfter(d)}}}if(!f&&this.settings.success){c.text("");if(typeof this.settings.success==="string"){c.addClass(this.settings.success)}else{this.settings.success(c,d)}}this.toShow=this.toShow.add(c)},errorsFor:function(d){var c=this.idOrName(d);return this.errors().filter(function(){return b(this).attr("for")===c})},idOrName:function(c){return this.groups[c.name]||(this.checkable(c)?c.name:c.id||c.name)},validationTargetFor:function(c){if(this.checkable(c)){c=this.findByName(c.name).not(this.settings.ignore)[0]}return c},checkable:function(c){return(/radio|checkbox/i).test(c.type)},findByName:function(c){return b(this.currentForm).find("[name='"+c+"']")},getLength:function(d,c){switch(c.nodeName.toLowerCase()){case"select":return b("option:selected",c).length;case"input":if(this.checkable(c)){return this.findByName(c.name).filter(":checked").length}}return d.length},depend:function(d,c){return this.dependTypes[typeof d]?this.dependTypes[typeof d](d,c):true},dependTypes:{"boolean":function(c){return c},string:function(d,c){return !!b(d,c.form).length},"function":function(d,c){return d(c)}},optional:function(c){var d=this.elementValue(c);return !b.validator.methods.required.call(this,d,c)&&"dependency-mismatch"},startRequest:function(c){if(!this.pending[c.name]){this.pendingRequest++;this.pending[c.name]=true}},stopRequest:function(c,d){this.pendingRequest--;if(this.pendingRequest<0){this.pendingRequest=0}delete this.pending[c.name];if(d&&this.pendingRequest===0&&this.formSubmitted&&this.form()){b(this.currentForm).submit();this.formSubmitted=false}else{if(!d&&this.pendingRequest===0&&this.formSubmitted){b(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=false}}},previousValue:function(c){return b.data(c,"previousValue")||b.data(c,"previousValue",{old:null,valid:true,message:this.defaultMessage(c,"remote")})}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},number:{number:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(c,d){if(c.constructor===String){this.classRuleSettings[c]=d}else{b.extend(this.classRuleSettings,c)}},classRules:function(d){var f={},c=b(d).attr("class");if(c){b.each(c.split(" "),function(){if(this in b.validator.classRuleSettings){b.extend(f,b.validator.classRuleSettings[this])}})}return f},attributeRules:function(d){var h={},c=b(d),f=d.getAttribute("type"),i,g;for(i in b.validator.methods){if(i==="required"){g=d.getAttribute(i);if(g===""){g=true}g=!!g}else{g=c.attr(i)}if(/min|max/.test(i)&&(f===null||/number|range|text/.test(f))){g=Number(g)}if(g||g===0){h[i]=g}else{if(f===i&&f!=="range"){h[i]=true}}}if(h.maxlength&&/-1|2147483647|524288/.test(h.maxlength)){delete h.maxlength}return h},dataRules:function(d){var h,f,g={},c=b(d);for(h in b.validator.methods){f=c.data("rule"+h[0].toUpperCase()+h.substring(1).toLowerCase());if(f!==undefined){g[h]=f}}return g},staticRules:function(d){var f={},c=b.data(d.form,"validator");if(c.settings.rules){f=b.validator.normalizeRule(c.settings.rules[d.name])||{}}return f},normalizeRules:function(d,c){b.each(d,function(h,g){if(g===false){delete d[h];return}if(g.param||g.depends){var f=true;switch(typeof g.depends){case"string":f=!!b(g.depends,c.form).length;break;case"function":f=g.depends.call(c,c);break}if(f){d[h]=g.param!==undefined?g.param:true}else{delete d[h]}}});b.each(d,function(f,g){d[f]=b.isFunction(g)?g(c):g});b.each(["minlength","maxlength"],function(){if(d[this]){d[this]=Number(d[this])}});b.each(["rangelength","range"],function(){var f;if(d[this]){if(b.isArray(d[this])){d[this]=[Number(d[this][0]),Number(d[this][1])]}else{if(typeof d[this]==="string"){f=d[this].split(/[\s,]+/);d[this]=[Number(f[0]),Number(f[1])]}}}});if(b.validator.autoCreateRanges){if(d.min&&d.max){d.range=[d.min,d.max];delete d.min;delete d.max}if(d.minlength&&d.maxlength){d.rangelength=[d.minlength,d.maxlength];delete d.minlength;delete d.maxlength}}return d},normalizeRule:function(d){if(typeof d==="string"){var c={};b.each(d.split(/\s/),function(){c[this]=true});d=c}return d},addMethod:function(c,f,d){b.validator.methods[c]=f;b.validator.messages[c]=d!==undefined?d:b.validator.messages[c];if(f.length<3){b.validator.addClassRules(c,b.validator.normalizeRule(c))}},methods:{required:function(d,c,g){if(!this.depend(g,c)){return"dependency-mismatch"}if(c.nodeName.toLowerCase()==="select"){var f=b(c).val();return f&&f.length>0}if(this.checkable(c)){return this.getLength(d,c)>0}return b.trim(d).length>0},email:function(d,c){return this.optional(c)||/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(d)},url:function(d,c){return this.optional(c)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(d)},date:function(d,c){return this.optional(c)||!/Invalid|NaN/.test(new Date(d).toString())},dateISO:function(d,c){return this.optional(c)||/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(d)},number:function(d,c){return this.optional(c)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(d)},digits:function(d,c){return this.optional(c)||/^\d+$/.test(d)},creditcard:function(h,d){if(this.optional(d)){return"dependency-mismatch"}if(/[^0-9 \-]+/.test(h)){return false}var i=0,g=0,c=false,j,f;h=h.replace(/\D/g,"");if(h.length<13||h.length>19){return false}for(j=h.length-1;j>=0;j--){f=h.charAt(j);g=parseInt(f,10);if(c){if((g*=2)>9){g-=9}}i+=g;c=!c}return(i%10)===0},minlength:function(f,c,g){var d=b.isArray(f)?f.length:this.getLength(b.trim(f),c);return this.optional(c)||d>=g},maxlength:function(f,c,g){var d=b.isArray(f)?f.length:this.getLength(b.trim(f),c);return this.optional(c)||d<=g},rangelength:function(f,c,g){var d=b.isArray(f)?f.length:this.getLength(b.trim(f),c);return this.optional(c)||(d>=g[0]&&d<=g[1])},min:function(d,c,f){return this.optional(c)||d>=f},max:function(d,c,f){return this.optional(c)||d<=f},range:function(d,c,f){return this.optional(c)||(d>=f[0]&&d<=f[1])},equalTo:function(d,c,g){var f=b(g);if(this.settings.onfocusout){f.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){b(c).valid()})}return d===f.val()},remote:function(h,d,i){if(this.optional(d)){return"dependency-mismatch"}var f=this.previousValue(d),c,g;if(!this.settings.messages[d.name]){this.settings.messages[d.name]={}}f.originalMessage=this.settings.messages[d.name].remote;this.settings.messages[d.name].remote=f.message;i=typeof i==="string"&&{url:i}||i;if(f.old===h){return f.valid}f.old=h;c=this;this.startRequest(d);g={};g[d.name]=h;b.ajax(b.extend(true,{url:i,mode:"abort",port:"validate"+d.name,dataType:"json",data:g,context:c.currentForm,success:function(k){var m=k===true||k==="true",n,l,j;c.settings.messages[d.name].remote=f.originalMessage;if(m){j=c.formSubmitted;c.prepareElement(d);c.formSubmitted=j;c.successList.push(d);delete c.invalid[d.name];c.showErrors()}else{n={};l=k||c.defaultMessage(d,"remote");n[d.name]=f.message=b.isFunction(l)?l(h):l;c.invalid[d.name]=true;c.showErrors(n)}f.valid=m;c.stopRequest(d,m)}},i));return"pending"}}});b.format=function a(){throw"$.format has been deprecated. Please use $.validator.format instead."}}(jQueryFix));(function(c){var a={},b;if(c.ajaxPrefilter){c.ajaxPrefilter(function(g,f,h){var d=g.port;if(g.mode==="abort"){if(a[d]){a[d].abort()}a[d]=h}})}else{b=c.ajax;c.ajax=function(f){var g=("mode" in f?f:c.ajaxSettings).mode,d=("port" in f?f:c.ajaxSettings).port;if(g==="abort"){if(a[d]){a[d].abort()}a[d]=b.apply(this,arguments);return a[d]}return b.apply(this,arguments)}}}(jQueryFix));(function(a){a.extend(a.fn,{validateDelegate:function(d,c,b){return this.bind(c,function(f){var g=a(f.target);if(g.is(d)){return b.apply(g,arguments)}})}})}(jQueryFix));(function(g){var d,a=window.rnwWidget||{},c;a.widgets=a.widgets||{};a.widgets.instances=a.widgets.instances||{};a.modules=a.modules||{};function i(j,k){j=j.toString();while(j.length<k){j="0"+j}return j}Date.prototype.toISO8601DateString=function(){return[this.getFullYear(),i(this.getMonth()+1,2),i(this.getDate(),2)].join("-")};function b(j){var k=j,l;while(k.length>2){l=k.slice(0,9);k=parseInt(l,10)%97+k.slice(l.length)}return parseInt(k,10)%97}c={EG:27,AL:28,DZ:24,AD:24,AO:25,AZ:28,BH:22,BE:16,BJ:28,BA:20,BR:29,VG:24,BG:22,BF:27,BI:16,CR:21,CI:28,DK:18,DE:22,DO:28,EE:20,FO:18,FI:18,FR:27,GA:27,GE:22,GI:23,GR:27,GL:18,GT:28,IR:26,IE:22,IS:26,IL:23,IT:27,JO:30,CM:27,CV:25,KZ:20,QA:29,CG:27,XK:20,HR:21,KW:30,LV:21,LB:28,LI:21,LT:20,LU:20,MG:27,ML:28,MT:31,MR:27,MU:30,MK:19,MD:24,MC:27,ME:22,MZ:25,NL:18,NO:15,AT:20,TL:23,PK:24,PS:29,PL:28,PT:25,RO:24,SM:27,ST:25,SA:24,SE:24,CH:21,SN:28,RS:22,SC:31,SK:24,SI:19,ES:24,CZ:24,TN:24,TR:26,UA:29,HU:28,AE:23,GB:22,CY:28,CF:27};Array.prototype.remove=function(l){var j=[],k;for(k=0;k<this.length;k++){if(this[k]!==l){j.push(this[k])}}return j};function f(j,k){this.initialize(j,k)}g.extend(f.prototype,{initialize:function(j,k){this.widget=j;this.fieldName=k;this.isSetting=false},hasField:function(){return this.widget.form.find('[name="'+this.fieldName+'"]').length>0},get:function(){return this.widget.epik.retrieveValueFromField(this.fieldName)},set:function(j){if(!this.isSetting){this.isSetting=true;this.oldValue=this.get();this.beforeUpdate(j);this.internalSet(j);this.afterUpdate(j);this.isSetting=false}},internalSet:function(j){this.widget.epik.updateValueOfField(this.fieldName,j)},beforeUpdate:function(j){},afterUpdate:function(j){},});function h(j,k){var l=function(m,n){this.initialize(m,n)};g.extend(l.prototype,k||f.prototype,j);return l}a.utils=a.utils||{registerWidget:function(k,j){a.widgets[k]=a.widgets[k]||{};a.widgets[k].initializer=j},registerModule:function(j,k){a.modules[j]=k},applyModules:function(l,k){for(var j in a.modules){l.modules[j]=l.modules[j]||{};a.modules[j].initialize(l,k)}},checkTlsVersion:function(j){g.ajax({url:"https://www.howsmyssl.com/a/check",type:"GET",cache:false,crossDomain:true,success:function(k){if(k.tls_version){if(k.tls_version!="TLS 1.2"&&k.tls_version!="TLS 1.1"){j.modules.overlay["not-compatible-error"].open()}}}})},normalizeMSISDN:function(j){j=j.replace(/\s/g,"");if(j.substr(0,3)==="+41"){return j}else{if(j.match(/^0[1-9]/)){j=j.substr(1,j.length)}else{if(j.substr(0,4)==="0041"){j=j.substr(4,j.length)}}}return"+41"+j},getCreditCardType:function(k,l){var j=null;k=k.replace(/[ -]+/g,"");if(k.match(/^(4)/g)){j="vis"}else{if(k.match(/^((5[0-5])|(2[2-7]))/g)){j="eca"}else{if(k.match(/^3[4|7]/g)){j="amx"}else{if(k.match(/^36/g)){j="din"}else{if(k.match(/^35/g)){j="jcb"}}}}}return(l===undefined||l.indexOf(j)>=0?j:null)},normalizeIban:function(j){return j?j.replace(/[-\s]/g,"").toUpperCase():""},getIbanChecksum:function(k){var l=k.slice(4)+k.slice(0,2)+"00",j=l.replace(/[A-Z]/g,function(n){return n.charCodeAt(0)-55});return 98-b(j)},isValidIban:function(j){var m=a.utils.normalizeIban(j),l=a.utils.getIbanChecksum(m),k=c[m.slice(0,2)];return k!==undefined&&m.length===k&&parseInt(m.slice(2,4))===l},legacyConfiguration:function(j){if(window.ddsWidgetConfig===undefined){return}if(typeof(window.ddsWidgetConfig.ddsWidgetLoaded)==="function"){j.widget.on(a.constants.events.WIDGET_LOADED,window.ddsWidgetConfig.ddsWidgetLoaded)}if(window.ddsWidgetConfig.ddsStoredParameters instanceof Object){j.storedParameters=g.extend({},window.ddsWidgetConfig.ddsStoredParameters,j.storedParameters)}if(window.ddsWidgetConfig.css!==undefined){if(g.isArray(window.ddsWidgetConfig.css)){j.css.concat(window.ddsWidgetConfig.css)}else{j.css.push(window.ddsWidgetConfig.css)}}},getUrlParam:function(j){if(d===undefined){var m=location.search.substr(1).split("&");d={};for(var k=0;k<m.length;k++){var l=m[k].split("=");d[l[0]]=decodeURIComponent(l[1])}}return(j===undefined?d:d[j])},fieldHandlerByName:function(k,j){return{isMatch:function(l,m){if(typeof(m)==="string"){return m===k}else{return k.test(m)}},handler:h(j),}},fieldHandlerBySelector:function(j,k){return{isMatch:function(l,n){var m=l.jGet('[name="'+n+'"],[data-name="'+n+'"]').first();return m.is(j)},handler:h(k),}},defaultFieldHandler:function(j,k){return new f(j,k)},bugsnagNotify:function(){if(this.bugsnagClient){this.bugsnagClient.notify.apply(this.bugsnagClient,arguments)}},evaluateCondition:function(l){var j,k;if(a.utils.conditionVariables[l.variable]!==undefined){j=a.utils.conditionVariables[l.variable];k=a.utils.conditionOperators[l.operator];return k(j,l.reference)}return false},conditionVariables:{ieversion:(function(){if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){return new Number(RegExp.$1)}})(),},conditionOperators:{lt:function(k,j){return k<j},lte:function(k,j){return k<=j},gt:function(k,j){return k>j},gte:function(k,j){return k>=j},eq:function(k,j){return k==j},},cronHelper:{INTERVAL_YEARLY:"yearly",INTERVAL_SEMESTRAL:"semestral",INTERVAL_QUARTERLY:"quarterly",INTERVAL_MONTHLY:"monthly",INTERVAL_WEEKLY:"weekly",INTERVAL_UNKNOWN:"unknown",MAPPING_MODE_LAST_OF:"last-of",MAPPING_MODE_FIRST_OF:"first-of",MAPPING_MODE_JIT:"jit",intervalToExpression:function(j,k){if(k===this.MAPPING_MODE_LAST_OF){return this._intervalToExpressionLastOf(j)}else{if(k===this.MAPPING_MODE_FIRST_OF){return this._intervalToExpressionFirstOf(j)}else{if(k===this.MAPPING_MODE_JIT){return this._intervalToExpressionJit(j)}}}},expressionToInterval:function(k){var j;if((j=k.match(/[^\s]+\s+[^\s]+\s+([^\s]+\s+[^\s]+\s+[^\s]+)/))){k=j[1]}return this._parseExpression(k)},_parseExpression:function(m){var l,k,j;if((l=m.match(/([^\s]+)\s+([^\s]+)\s+([^\s]+)/))){if(l[1].match(/^\d+|L|\*$/)){if(l[3].match(/^\d+$/)){return this.INTERVAL_WEEKLY}else{if(l[2]==="*"){return this.INTERVAL_MONTHLY}else{if(l[2].match(/^\d+$/)){return this.INTERVAL_YEARLY}else{if((k=l[2].match(/^(?:\*|\d+)\/(\d+)$/))){if(k[1]==3){return this.INTERVAL_QUARTERLY}if(k[1]==6){return this.INTERVAL_SEMESTRAL}}else{j=l[2].split(",").length;if(j==4){return this.INTERVAL_QUARTERLY}if(j==2){return this.INTERVAL_SEMESTRAL}}}}}}}return this.INTERVAL_UNKNOWN},_getMonthList:function(n,l){var m=n-1,j=[],k;for(k=0;k<12;k+=l){j.push(((m+k)%12)+1)}return j.join(",")},_intervalToExpressionLastOf:function(j){switch(j){case this.INTERVAL_WEEKLY:return"* * 5";case this.INTERVAL_MONTHLY:return"L * *";case this.INTERVAL_QUARTERLY:return"L */3 *";case this.INTERVAL_SEMESTRAL:return"L */6 *";case this.INTERVAL_YEARLY:return"L 12 *";default:return j}},_intervalToExpressionFirstOf:function(j){switch(j){case this.INTERVAL_WEEKLY:return"* * 1";case this.INTERVAL_MONTHLY:return"1 * *";case this.INTERVAL_QUARTERLY:return"1 1/3 *";case this.INTERVAL_SEMESTRAL:return"1 1/6 *";case this.INTERVAL_YEARLY:return"1 1 *";default:return j}},_intervalToExpressionJit:function(l){var k,j,m,n;if(window.moment!==undefined&&window.moment.tz!==undefined){k=moment.tz(new Date(),"Europe/Berlin");j=k.format("D");m=k.format("M");n=k.format("d")}else{k=new Date();j=k.getDate();m=k.getMonth()+1;n=k.getDay()}switch(l){case this.INTERVAL_WEEKLY:return["*","*",n].join(" ");case this.INTERVAL_MONTHLY:return[j,"*","*"].join(" ");case this.INTERVAL_QUARTERLY:months=this._getMonthList(m,3);return[j,months,"*"].join(" ");case this.INTERVAL_SEMESTRAL:months=this._getMonthList(m,6);return[j,months,"*"].join(" ");case this.INTERVAL_YEARLY:return[j,m,"*"].join(" ");default:return l}},},};a.constants=a.constants||{events:{WIDGET_LOADED:"rnw-widget-loaded",PAGE_LOADED:"rnw-widget-page-loaded",AMOUNT_CHANGED:"rnw-widget-amount-changed",COVER_TRANSACTION_FEE_VALUES_CHANGED:"rnw-widget-cover-transaction-fee-values-changed",PAYMENT_METHOD_CHANGED:"rnw-widget-payment-method-changed",DONATION_TYPE_CHANGED:"rnw-widget-donation-type-changed",PURPOSE_CHANGED:"rnw-widget-purpose-changed",INTERVAL_CHANGED:"rnw-widget-interval-changed",CUSTOMER_FORM_PREFILLED:"rnw-customer-form-prefilled",VALIDATING_PARAMETERS:"rnw-widget-validating-parameters",VALIDATION_ERROR:"rnw-widget-validation-error",AFTER_VALIDATING_PARAMETERS:"rnw-widget-after-validating-parameters",PAYMENT_COMPLETE:"rnw-widget-payment-complete",PROCESS_FORM:"rnw-widget-process-form",BEFORE_SUBMIT:"rnw-widget-before-submit",SUBSCRIPTION_EDIT_COMPLETE:"rnw-widget-subscription-edit-complete",SUBSCRIPTION_CANCELED:"rnw-widget-subscription-canceled",ADDRESS_COUNTRY_CHANGED:"rnw-widget-address-country-changed",CREDITCARD_FORM_DATA_CHANGED:"rnw-widget-creditcard-form-data-changed",MULTIPLE_INTERNAL_RETURN_EXECUTIONS:"rnw-widget-multiple-internal-return-executions",CURRENCY_CHANGED:"rnw-widget-currency-changed",REFUND_SUCCESS:"rnw-widget-refund-success",REFUND_FAILED:"rnw-widget-refund-failed",},moduleEvents:{MODAL_OPEN:"rnw-widget-modal-open",MODAL_CLOSE:"rnw-widget-modal-close",ELEMENT_SELECTED:"rnw-widget-tab-selected",ELEMENT_ADDED:"rnw-widget-member-added",ELEMENT_REMOVED:"rnw-widget-member-removed",},steps:{CURRENCY:"currency",DONATION_TARGET:"donation-target",AMOUNT:"amount",COVER_TRANSACTION_FEE:"cover-transaction-fee",PAYMENT_METHOD:"payment-method",CUSTOMER_IDENTITY:"customer-identity",CUSTOMER_ADDRESS:"customer-address",RECIPIENT_INFORMATION:"recipient-information",MEMBERS:"members",CREATE_PAYMENT_SOURCE:"create-payment-source",},modes:{FORM:"form",SUBSCRIPTION:"subscription",RESPONSE:"response",REFUND:"refund",},paymentStatus:{SUCCESS:"success",ABORTED_BY_USER:"aborted_by_user",TIMEOUT:"timeout",ABORTED:"aborted",ERROR:"error",},};window.rnwWidget=a;if(g.validator!==undefined){g.validator.addMethod("msisdn",function(n,j){var m=a.utils.normalizeMSISDN(n);var l=new RegExp("^\\+417[56789][0-9]{7}$","g");var k=this.optional(j)||l.test(m);if(k&&n!==m){g(j).val(m)}return k},"Please enter a correct Swiss mobile number");g.validator.addMethod("rnwcreditcard",function(k,j,l){if(!l){return true}return a.utils.getCreditCardType(k,l)!=null},"Please enter a supported credit card");g.validator.addMethod("rnwmin",function(k,j,l){if(g("[name=predefined-amount]:checked").val()!==""&&!isNaN(k)){return true}else{if(isNaN(k)){return true}}return k>=l},"Please enter a value greater than or equal to {0}.");g.validator.addMethod("iban",function(k,j){return this.optional(j)||a.utils.isValidIban(k)},"Please enter a valid IBAN number");g.validator.addMethod("ibanCountry",function(k,j,m){var l=a.utils.normalizeIban(k);return m.indexOf(l.slice(0,2))>=0},"The IBAN number belongs to a country that is not supported");g.validator.addMethod("birthYear",function(m,l,k){m=parseInt(m,10);if(k===0){return true}else{if(isNaN(m)){return false}}m+=k;var j=new Date();return m<=j.getFullYear()},"Check Year field");g.validator.addMethod("rnwexpm",function(o,m,p){o=parseInt(o,10);var j=parseInt(g('[name="expy"]',this.currentForm).val(),10);var l=new Date(),n=l.getMonth()+1,k=parseInt(l.getFullYear().toString().substr(-2),10);if(j===k){if(o<n){return false}}return true},"Please check month expiration");g.validator.addMethod("rnwexpy",function(n,m,o){n=parseInt(n,10);var l=new Date(),k=parseInt(l.getFullYear().toString().substr(-2),10),j=g('[name="expm"]',this.currentForm);if(n<k){return false}setTimeout(function(p){p.element(j[0])},0,this);return true},"Please check year expiration")}})(jQueryFix);(function(b){var a=window.rnwWidget||{};a.utils=a.utils||{};b.extend(a.utils,{getFallbackKeyValue:function(n,l,j,g){var c,h,m,p,f,o,q=l,k="",d={};if(n.fallback_keys[j]){c=n.fallback_keys[j];keyHierarchy=c.base.split(".");o=new Array(keyHierarchy[keyHierarchy.length-1]);for(f=0;f<c.hierarchy.length;f++){h=c.hierarchy[f];o.push(g[h]?g[h]:"null")}for(f=0;f<keyHierarchy.length-1;f++){q=q[keyHierarchy[f]]?q[keyHierarchy[f]]:{}}while(o.length>0){m=o.join("_");if(q[m]){return q[m]}o=o.slice(0,-1)}}return undefined},})})(jQueryFix);(function(c){if(rnwWidget.widgets.BaseWidget!==undefined){return}function a(d,f){this.widget=d;this._setGlobalDefaults();this.extend(f.widgetParams);this.epikOptions=c.extend(true,{},f.epikOptions);this.epikOptions.iframe_container=d.getId("iframe_wrapper");this.epikOptions.http_base_url_endpoint=f.widgetParams.common.http_base_url_endpoint||undefined;this.translations=f.translations;this.jsonpTemplateUrl=f.jsonpTemplateUrl;this.widgetBaseUrl=f.widgetBaseUrl;this.widgetCdnUrl=f.widgetCdnUrl;this.widgetPreferredUrl=f.widgetPreferredUrl?f.widgetPreferredUrl:f.widgetBaseUrl;this.widgetDefaultUrl=f.widgetDefaultUrl;this.css=f.css;this.scripts=f.scripts;this.validationOptions=c.extend(true,d._validateOptions(this),this._getValidationTranslations());this._updateWidgetCss()}c.extend(a.prototype,{_setGlobalDefaults:function(){this.common={overlay_target:"body",field_class_prefix:"field-",overlay_heights:{pfc:545,pef:545,vis:400,twi:915,},};this.defaults={};this.extend(this.widget._defaultOptions())},_getValidationTranslations:function(){if(this.translations.validation===undefined||this.translations.validation.class_rules===undefined){return{}}return{classRules:this.translations.validation.class_rules}},_updateWidgetCss:function(){var d=this;d.css=c.map(d.css,function(f){return d.widgetPreferredUrl+f})},_finalize:function(){this.finalized=true;var f=this,h=window.rnwWidget.utils.getUrlParam(),g=/^(?:dds|rnw)-(.*)$/,d;c.each(h,function(i,j){d=i.match(g);if(d!==null){f.defaults[d[1]]=j}})},extend:function(d){c.extend(true,this,d)},getDefault:function(f,d){var g=this.defaults[f];if(d===undefined||d){delete this.defaults[f]}return g},});var b={_initialize:function(d,g,f){this.j=d;this.element=g;this.widgetName=f.widgetName;this.widgetUUID=f.widgetUUID;this.id=this.widgetUUID+"-"+(this.element.data("name")||"default");this.wclBase=[this.widgetName,"-"].join("");this.modules={};this.loaded=false;this._fieldHandlerCache={};this._eventBuffering=true;this._eventBuffer=[];this._computedFields=null;this.options=new a(this,f);this._configureWidget();this._injectCss();this._loadTemplate();this._initMessageHandler()},jGet:function(d){return this.j(d,this.element)},wcl:function(f,d){return(d===false?"":".")+this.wclBase+f},getId:function(d){return this.id+"-"+d},on:function(d,f){var g=this;this.element.on(d,function(h){f.call(g,h)});return this},showBlock:function(d){this.toggleBlock(d,true)},hideBlock:function(d){this.toggleBlock(d,false)},toggleBlock:function(f,d){var g=this.jGet('[data-block-id="'+f+'"]');this._toggleElement(g,d)},showStep:function(d){this.toggleStep(d,true)},hideStep:function(d){this.toggleStep(d,false)},toggleStep:function(g,d){var f=this.jGet(this.wcl("step-"+g));if(this._toggleElement(f,d)){this._reindexSteps()}},showPage:function(d){var f=this.currentPage||c();this.currentPage=this.jGet(this.wcl("page-"+d));this._toggleElement(f,false);this._toggleElement(this.currentPage,true);this._toggleElement(this.jGet(this.wcl("page-loading")),false);this._trigger(window.rnwWidget.constants.events.PAGE_LOADED,{oldPage:f},this.currentPage)},get:function(d){return this._getFieldHandler(d).get()},set:function(f,d){this._getFieldHandler(f).set(d)},intervalNameToExpression:function(d){if(this.options.intervals.mode){return rnwWidget.utils.cronHelper.intervalToExpression(d,this.options.intervals.mode)}return d},expressionToIntervalLabel:function(f,d){intervalName=rnwWidget.utils.cronHelper.expressionToInterval(f);interval=(d.recurring_intervals===undefined?undefined:d.recurring_intervals[intervalName]);if(interval===undefined){interval=d.intervals["interval_"+f.replace(/ /g,"_")]}return interval},_configureWidget:function(){if(typeof(window.rnwWidget.configureWidget)==="function"){window.rnwWidget.configureWidget(this.options)}else{if(typeof(window.rnwWidget.configureWidget)==="object"){for(config in window.rnwWidget.configureWidget){if(window.rnwWidget.configureWidget.hasOwnProperty(config)&&typeof(window.rnwWidget.configureWidget[config])==="function"){window.rnwWidget.configureWidget[config](this.options)}}}else{window.rnwWidget.utils.legacyConfiguration(this.options)}}this.options._finalize();if(this.options.epikOptions.api_key){this.options.epikOptions.apiendpoint=this.options.epikOptions.apiendpoint.replace(/\/[a-zA-Z0-9\-]*$/,"/"+this.options.epikOptions.api_key)}this.options.defaults.stored_rnw_widget_uuid=this.widgetUUID;this.options.defaults.stored_rnw_widget_instance_id=this.id;this.options.defaults.stored_rnw_source_url=window.location.href},_getTemplateVariables:function(){return{instanceName:this.id,}},_injectCss:function(){var g=this,f=g.j("head");function d(h){g.j("<link>",{rel:"stylesheet",type:"text/css",href:h}).appendTo(f)}g.j.each(g.options.css,function(h,i){if(typeof(i)==="string"){d(i)}else{if(window.rnwWidget.utils.evaluateCondition(i)){d(i.path)}}})},_loadTemplate:function(){var d=this;c.ajax({url:d.options.jsonpTemplateUrl,type:"GET",cache:false,dataType:"jsonp",jsonpCallback:"getWidgetTemplate",crossDomain:true,success:function(g){var f=d._getTemplateVariables();d.widgetMarkup=c(g.replace(/@\(([^)]+)\)/g,function(i,h){return f[h]}));d.widgetMarkup.appendTo(d.element);d._setModeAndForm()}})},_initializeForm:function(){var f=this;f._initializeValidation();rnwWidget.utils.applyModules(f,f.widgetMarkup);f.epik=new EPIK(f.form.attr("id"),f.options.epikOptions);f.epik.deleteData();f._injectCustomFields();f._setupBlockVisibility();f._registerActionHandlers();f.on(window.rnwWidget.constants.events.PROCESS_FORM,f._processFormPayerLines);f.on(window.rnwWidget.constants.events.PROCESS_FORM,f._processCountryCode);f.on(window.rnwWidget.constants.events.PROCESS_FORM,f._processPaymentMethodToSelectPaymentProvider);f._onTemplateLoaded();f._reindexSteps();f._setDefaults();f._releaseEventBuffer();f._preFillFormFields();f.loaded=true;f._trigger(window.rnwWidget.constants.events.WIDGET_LOADED);var d=f._getInitialPage();if(d!==null){f.showPage(d)}},_setupBlockVisibility:function(){var d=this,f=this.options.process;if(f===undefined||f.blocks===undefined){return}d.j.each(f.blocks.show,function(h,g){d.showBlock(g)});d.j.each(f.blocks.hide,function(h,g){d.hideBlock(g)})},_injectCustomFields:function(){var i=this;if(i.options.custom_fields===undefined){return}for(var j in i.options.custom_fields){var g=i.options.custom_fields[j],h=ich[i.getId("ich_field_"+g.type)],d=i.jGet('[data-block-id="'+g.reference+'"]'),f;if(h===undefined){throw'unknown field type "'+g.type+'"'}if(d.length===0){throw'unknown reference block ID "'+g.reference+'"'}f=h(c.extend({},g,{fieldName:j,fieldId:i.getId(j),blockId:"custom-"+j,}));if(typeof(g.location)==="function"){g.location(d,f)}else{if(typeof(g.location)==="string"&&typeof(d[g.location])==="function"){d[g.location](f)}else{throw'location "'+g.location+'" is not a function or the name of a function on the reference object'}}rnwWidget.utils.applyModules(i,f)}},_injectCustomAddressFields:function(n){if(n!==true){return false}function o(){m=h.jGet('div[class="address-form"]').find('[name^="stored_customer"]')}var h=this,d=h.options.common.country_address_mapping,j=h.get("stored_customer_country")?h.get("stored_customer_country"):"",l=d[j.toLowerCase()],p,m,k=(typeof k==="undefined")?[]:k;o();try{p=h.jGet(ich[h.id+"-customer-address-form-"+l]())}catch(f){p=h.jGet(ich[h.id+"-customer-address-form-dach-benelux"]())}for(var g=0;g<m.length;g++){k[m[g].getAttribute("name")]=m[g].value}h.jGet('div[class="address-form"]').remove();h.jGet('div[data-block-id="customer_country"]').before(p);o();for(var g=0;g<m.length;g++){m[g].value=k[m[g].getAttribute("name")]?k[m[g].getAttribute("name")]:""}h._setupBlockVisibility();rnwWidget.modules.classValidation.initialize(h,h.jGet(".lema-step-customer-address"))},_initMessageHandler:function(){var d=this;window.addEventListener("message",function(k){if(!k.data||typeof k.data!=="string"){return}var j,g,l,f;try{var i=JSON.parse(k.data);j=i.widgetId||null;g=i.topic||null;l=i.data||{}}catch(h){}if(g===undefined||g===null){return}if(window.rnwWidget===undefined||window.rnwWidget.widgets===undefined||window.rnwWidget.widgets.instances===undefined){alert("Missing rnwWidget.widgets.instances");return}if(j!==d.id){return}f=window.rnwWidget.widgets.instances[j];if(f===undefined){alert("Unknown widget instance with ID "+j);return}if(g==="rnw-widget-epik-response"){f._onEpikResponse(l)}})},_setDefaults:function(f,d){var i=this,g=/^stored_/,j=/\*$/,h;i.j.each(i.options.defaults,function(k,l){if(f!==undefined){if(j.test(k)){k=k.substring(0,k.length-1)+d.toString()}if(f.find('[name="'+k+'"]').length===0){return}}if(j.test(k)){return}h=i._getFieldHandler(k);if(g.test(k)&&!h.hasField()){i.j("<input/>").attr("type","hidden").attr("name",k).appendTo(i.form)}h.set(l)})},_setModeAndForm:function(){var j=this,h=window.rnwWidget.utils.getUrlParam("dds-subscription"),f=window.rnwWidget.utils.getUrlParam("subscription_token"),g=window.rnwWidget.utils.getUrlParam("epp_transaction_id"),d=window.rnwWidget.utils.getUrlParam("rnw-payment_source_token"),k=window.rnwWidget.utils.getUrlParam("rnw-refund_transaction_id");j.customerToken=window.rnwWidget.utils.getUrlParam("rnw-stored_customer_token");if(h&&f&&g){j.form=j.jGet(j.wcl("full-form"));j.mode=window.rnwWidget.constants.modes.SUBSCRIPTION;j.eppTransactionId=g;j.subscriptionToken=f;j._initializeForm()}else{if(h){j.form=j.jGet("#"+j.getId("form-renew-subscription"));j.mode=window.rnwWidget.constants.modes.SUBSCRIPTION;j.subscriptionToken=h;j._initializeForm()}else{if(g){j.form=j.jGet(j.wcl("full-form"));j.mode=window.rnwWidget.constants.modes.RESPONSE;j.eppTransactionId=g;j._initializeForm()}else{if(d&&j.customerToken){var i={amount:window.rnwWidget.utils.getUrlParam("amount"),currency:window.rnwWidget.utils.getUrlParam("currency"),paymentSourceToken:d,};j._performOneClickDonation(i)}else{if(k){j.form=j.jGet(j.wcl("full-form"));j.mode=window.rnwWidget.constants.modes.REFUND;j.refund_transaction_id=k;j._initializeForm()}else{j.form=j.jGet(j.wcl("full-form"));j.mode=window.rnwWidget.constants.modes.FORM;j._initializeForm()}}}}}},_getInitialPage:function(){if(this.mode===window.rnwWidget.constants.modes.SUBSCRIPTION&&this.eppTransactionId){this._loadTransactionInformation();return null}else{if(this.mode===window.rnwWidget.constants.modes.SUBSCRIPTION){this._loadSubscriptionInformation();return null}else{if(this.mode===window.rnwWidget.constants.modes.RESPONSE){this._loadTransactionInformation();return null}else{if(this.mode===window.rnwWidget.constants.modes.REFUND){this._loadRefundTransaction();return null}}}}return this.mode},_trigger:function(d,f,i){var h=this,g=h.j.Event(d);c.extend(g,f,{widget:h});if(h._eventBuffering){h._eventBuffer.push({target:i,event:g})}else{(i||h.element).trigger(g)}return g},_releaseEventBuffer:function(){var d=this;d._eventBuffering=false;d.j.each(d._eventBuffer,function(g,f){(f.target||d.element).trigger(f.event)});d._eventBuffer=[]},_toggleElement:function(f,d){var g=f.is(this.wcl("shown"))?true:(f.is(this.wcl("hidden"))?false:undefined);if((d===true&&g===undefined)||((d===true||d===undefined)&&!g)){f.removeClass(this.wcl("hidden",false)).addClass(this.wcl("shown",false));return true}else{if((d===false&&g===undefined)||((d===false||d===undefined)&&g)){f.removeClass(this.wcl("shown",false)).addClass(this.wcl("hidden",false));return true}}return false},_reindexSteps:function(){var d=this;d.jGet(d.wcl("step")+d.wcl("shown")+" "+d.wcl("step-number-text")).each(function(f){d.j(this).text(f+1)})},_loadSubscriptionInformation:function(){var d=this,g,f;g={"widget-uuid":d.widgetUUID,token:d.subscriptionToken,action:"info"};f=d.options.epikOptions.apiendpoint.replace(/(.*)\//g,"");if(d.options.epikOptions.api_key){g["merchant-config"]=d.options.epikOptions.api_key;f=d.options.epikOptions.api_key}if(d.options.common.http_base_url_endpoint){c.ajax({url:d.options.common.http_base_url_endpoint+"/organisations/"+f+"/subscriptions/"+d.subscriptionToken,cache:false,crossDomain:true,timeout:15000,dataType:"json",contentType:"application/json",success:function(h){if(h.error){d._onSubscriptionInfoError(h)}else{d._onSubscriptionInfoSuccess(h)}},})}else{c.ajax({url:d.options.widgetDefaultUrl+"subscription.php",cache:false,crossDomain:true,dataType:"jsonp",contentType:"application/json",data:g,success:function(h){var i=d.j.parseJSON(h);if(i.error){d._onSubscriptionInfoError(i)}else{d._onSubscriptionInfoSuccess(i)}},})}},_loadTransactionInformation:function(){var d=this,g,f;g={"widget-uuid":d.widgetUUID,"transaction-id":d.eppTransactionId};f=d.options.epikOptions.apiendpoint.replace(/(.*)\//g,"");if(d.options.epikOptions.api_key){g["merchant-config"]=d.options.epikOptions.api_key;f=d.options.epikOptions.api_key}if(d.options.common.http_base_url_endpoint){c.ajax({url:d.options.common.http_base_url_endpoint+"/organisations/"+f+"/transactions/"+d.eppTransactionId,cache:false,crossDomain:true,timeout:15000,dataType:"json",contentType:"application/json",error:function(h){d._onTransactionInfoError(h)},success:function(h){if(h.error){d._onTransactionInfoError(h)}else{if(h.created){d._onTransactionInfoSuccess(h)}else{if(h.timeout){d._onTransactionInfoTimeout(h)}}}},})}else{c.ajax({url:d.options.widgetDefaultUrl+"pollinfo.php",cache:false,crossDomain:true,timeout:15000,dataType:"jsonp",contentType:"application/json",data:g,error:function(h){d._onTransactionInfoError(h)},success:function(h){var i=d.j.parseJSON(h);if(i.error){d._onTransactionInfoError(i)}else{if(i.created){d._onTransactionInfoSuccess(i)}else{if(i.timeout){d._onTransactionInfoTimeout(i)}}}},})}},_initializeValidation:function(){var d=this,g={},f;if(d.j.validator===undefined){return}d._validationMessages={};c.each(d.options.validationOptions.classRules,function(i,h){f=c.extend({},h);d._validationMessages[d.options.common.field_class_prefix+i]=f.messages;delete f.messages;g[d.options.common.field_class_prefix+i]=f});d.j.validator.addClassRules(g);d.form.validate(d.options.validationOptions);d._validationInitialized=true},_getFieldHandler:function(f){var d=this;if(!(f in d._fieldHandlerCache)){c.each(d._fieldHandlers,function(h,g){if(g.isMatch(d,f)){d._fieldHandlerCache[f]=new g.handler(d,f);return false}})}if(!(f in d._fieldHandlerCache)){d._fieldHandlerCache[f]=window.rnwWidget.utils.defaultFieldHandler(d,f)}return d._fieldHandlerCache[f]},_processFormPayerLines:function(f){var d=f.widget,g=d.epik.CONSTANTS.FORM_FIELD.PAYER_LINE_PREFIX;if(d.paymentMethod==="ezs"||d.paymentMethod==="es"){f.computedFields[g+"1"]=d.get("stored_customer_firstname")+" "+d.get("stored_customer_lastname");f.computedFields[g+"2"]=d.get("stored_customer_street")+" "+d.get("stored_customer_street_number");f.computedFields[g+"3"]=d.get("stored_customer_zip_code")+" "+d.get("stored_customer_city");f.computedFields[g+"4"]=d.get("stored_customer_country")}},_processCountryCode:function(f){var d=f.widget;f.computedFields.country_code=d.get("stored_customer_country")},_processPaymentMethodToSelectPaymentProvider:function(f){var d=f.widget;if(f.widget.options.common.cc_payment_provider&&f.widget.metaMethod==="cc"){f.computedFields.payment_provider=f.widget.options.common.cc_payment_provider}},_registerActionHandlers:function(){var d=this;d.jGet("[data-action]").on("click",function(g){var f=d.j(this),h=f.data();g.preventDefault();if(h.action in d._actionHandlers){d._actionHandlers[h.action].call(d,f,h)}else{throw"Unknown action handler '"+h.action+"'"}})},_actionHandlers:{"clear-interval":function(d,f){this.epik.abortWaitForConfirmation()},},_prepareAndSubmitEpik:function(){var j=this,m={},g,k,p,i,o;j._trigger(window.rnwWidget.constants.events.PROCESS_FORM,{computedFields:m});j._trigger(window.rnwWidget.constants.events.BEFORE_SUBMIT,{computedFields:m});j._computedFields=m;for(g in j._computedFields){j.epik.createFormField(g,"hidden",m[g])}if(j.paymentMethod==="ezs"||j.paymentMethod==="es"){if(j.paymentMethod==="ezs"&&j.epik.options.crmc_url!==j.options.common.base_url){if(j.options.common.http_base_url_endpoint){const d=j.epik.options.widget_uuid;const l=j.get("stored_campaign_id");const h=j.get("stored_campaign_subid");const n=j.epik.options.merchant_id;const f=j.options.common.http_base_url_endpoint+"/organisations/"+d+"/payment-slips/"+l+"/"+h+"?merchant_id="+n;j.j.ajax({url:f,cache:false,crossDomain:true,dataType:"json",contentType:"application/json",success:function(q){j.epik.setRefNo(q.refno);j.epik.makeReadyToSubmit();j.epik.createAndSubmitIFrame()},error:function(r,q,s){}})}else{j.j.ajax({url:j.epik.options.crmc_url,cache:false,crossDomain:true,dataType:"jsonp",contentType:"application/json",data:{"widget-uuid":j.epik.options.widget_uuid,"campaign-id":j.get("stored_campaign_id")},success:function(q){j.epik.setRefNo(q);j.epik.makeReadyToSubmit();j.epik.createAndSubmitIFrame()},error:function(r,q,s){}})}return}else{j.epik.setRefNo(1)}}else{if(j.paymentMethod==="pp"&&j.get("recurring")=="true"){j.set("immediate_execution",false)}else{if(j.paymentMethod==="elv"){j._createIbanAndBicFields("elv_iban","elv_bic")}else{if(j.paymentMethod==="sod"){j._createIbanAndBicFields("sod_iban","sod_bic")}else{if(j.paymentMethod==="dd"&&j.options.translations.common.dd_forms){if(j.options.translations.common.dd_forms.pf&&j.get("bank_name")&&j.get("bank_name").toLowerCase().indexOf("post")!=-1){i=j.options.translations.common.dd_forms.pf}else{if(j.options.translations.common.dd_forms.bank){i=j.options.translations.common.dd_forms.bank}}if(i){if(typeof(j.get("form_template"))!=="undefined"){j.set("form_template",i)}else{j.epik.createFormField("form_template","hidden",i)}}}}}}}p=j.options.payment_methods[(j.metaMethod==="psl"?j.paymentMethod:j.metaMethod)];o=p.recurrence?p.redirect_in:p[j.paymentMethod]["redirect_in"];if(o==="self"){k=j.get("stored_rnw_source_url").replace(/epp_transaction_id=[a-z0-9]+&*/g,"");k=k.replace(/#.*$/g,"");j.epik.setSuccessUrl(k);j.epik.setCancelUrl(k);j.epik.setErrorUrl(k);j.set("return_parameters","false");j.epik.makeReadyToSubmit();j.form.get(0).submit()}else{p=j.options.payment_methods[(j.metaMethod==="psl"?j.paymentMethod:j.metaMethod)];o=p.recurrence?p.redirect_in:p[j.paymentMethod]["redirect_in"];if(o==="self"){k=j.get("stored_rnw_source_url").replace(/epp_transaction_id=[a-z0-9]+&*/g,"");k=k.replace(/#.*$/g,"");j.epik.setSuccessUrl(k);j.epik.setCancelUrl(k);j.epik.setErrorUrl(k);j.set("return_parameters","false");j.epik.makeReadyToSubmit();j.form.get(0).submit()}else{j.set("return_parameters","true");j.epik.makeReadyToSubmit();j.epik.createAndSubmitIFrame()}}},_createIbanAndBicFields:function(g,d){var f=this;if(f.get("bankiban")===undefined){f.epik.createFormField("bankiban","hidden",f.get(g))}else{f.set("bankiban",f.get(g))}if(f.get(d)!==undefined&&f.get(d)!==""){if(f.get("bankbic")===undefined){f.epik.createFormField("bankbic","hidden",f.get(d))}else{f.set("bankbic",f.get(d))}}},_onEpikResponse:function(g){var k=this,f=g.epayment_status,i,l,h;var d=g.stored_rnw_cover_fee_amount||0;var j=g.amount-d;k.set("amount",j);k._applyFeeToForm(j);k.epik.deleteData();for(i in k._computedFields){k.jGet('[name="'+i+'"]').remove()}k._onBeforeEpikResponseProcess(g);if(k.mode===window.rnwWidget.constants.modes.FORM||k.mode===window.rnwWidget.constants.modes.RESPONSE){if(f===window.rnwWidget.constants.paymentStatus.SUCCESS){h=k._epikResponseProcess(g);if(h!==false){l=k._trigger(window.rnwWidget.constants.events.PAYMENT_COMPLETE,{paymentStatus:f,payment:g});if(!l.isDefaultPrevented()){k._onEpikSuccess(g)}}}else{if(f===window.rnwWidget.constants.paymentStatus.ABORTED_BY_USER){l=k._trigger(window.rnwWidget.constants.events.PAYMENT_COMPLETE,{paymentStatus:f,payment:g});if(!l.isDefaultPrevented()){k.showPage(window.rnwWidget.constants.modes.FORM);k._onEpikCancel(g)}}else{l=k._trigger(window.rnwWidget.constants.events.PAYMENT_COMPLETE,{paymentStatus:f,payment:g});if(!l.isDefaultPrevented()){k.showPage(window.rnwWidget.constants.modes.FORM);k._onEpikError(g)}}}}else{if(k.mode===window.rnwWidget.constants.modes.SUBSCRIPTION){if(f===window.rnwWidget.constants.paymentStatus.SUCCESS){h=k._epikResponseProcess(g);if(h!==false){l=k._trigger(window.rnwWidget.constants.events.SUBSCRIPTION_EDIT_COMPLETE,{paymentStatus:f,payment:g});if(!l.isDefaultPrevented()){k._onEpikSubscriptionSuccess(g)}}}else{if(f===window.rnwWidget.constants.paymentStatus.ABORTED_BY_USER){l=k._trigger(window.rnwWidget.constants.events.SUBSCRIPTION_EDIT_COMPLETE,{paymentStatus:f,payment:g});if(!l.isDefaultPrevented()){k._onEpikCancel(g)}}else{l=k._trigger(window.rnwWidget.constants.events.SUBSCRIPTION_EDIT_COMPLETE,{paymentStatus:f,payment:g});if(!l.isDefaultPrevented()){k._onEpikError(g)}}}}}},_epikResponseProcess:function(d){var g=this._successHandlers[d.payment_method.toLowerCase()]||this._successHandlers.fallback,f=true;if(g!==undefined){f=g.call(this,d,this._successHandlers.fallback||this.j.noop)}return f},_successHandlers:{sms:function(f,g){var h=this;function d(i,j){var k;h.epik.abortWaitForConfirmation();h._hideSmsPoll(f);j.call(h,f,h.j.noop);k=h._trigger(window.rnwWidget.constants.events.PAYMENT_COMPLETE,{paymentStatus:i,payment:f});if(i===window.rnwWidget.constants.paymentStatus.SUCCESS&&!k.isDefaultPrevented()){h._onEpikSuccess(f)}}h._showSmsPoll(f);h.epik.waitForConfirmation({start_minutes:59,start_seconds:59,container_id:h.getId("timer_countdown"),epp_transaction_id:f.epp_transaction_id,interval:5,confirmed:function(){d(f.epayment_status,g)},timedout:function(){d(window.rnwWidget.constants.paymentStatus.TIMEOUT,h._onEpikCancel)},declined:function(){d(window.rnwWidget.constants.paymentStatus.ABORTED,h._onEpikCancel)},});return false},},_fieldHandlers:[rnwWidget.utils.fieldHandlerBySelector(".single-checkbox",{initialize:function(d,f){this.widget=d;this.fieldName=f;this.checkbox=this.widget.jGet('[name="'+this.fieldName+'"]')},internalSet:function(f){var d=(f===true?this.checkbox.val():(f===false?"":f));if(this.widget.j.type(f)==="string"&&f!==this.checkbox.val()){this.checkbox.val(f)}this.beforeUpdate(f);this.widget.epik.updateValueOfField(this.fieldName,d);this.afterUpdate(f)},}),],_preFillFormFields:function(){var d=this;if(d.customerToken){c.ajax({url:d.options.widgetDefaultUrl+"prefillform.php?widget-uuid="+d.widgetUUID+"&rnw-customer-token="+d.customerToken,cache:false,crossDomain:true,dataType:"jsonp",contentType:"application/json",data:{},success:function(f){var g;if(f!=""){g=d.j.parseJSON(f);d.j.each(g.customer,function(i,h){switch(i){case"email":i="stored_customer_email";g.customer[i]=h;break}if(d.modules.tripleDate[i]){d.modules.tripleDate[i].setDate(new Date(h))}else{d.set(i,h)}});d._trigger(window.rnwWidget.constants.events.CUSTOMER_FORM_PREFILLED,{value:g.customer})}}})}},_cancelSubscription:function(){var d=this,h,g;h={};g=d.options.epikOptions.apiendpoint.replace(/(.*)\//g,"");if(d.options.epikOptions.api_key){h["merchant-config"]=d.options.epikOptions.api_key;g=d.options.epikOptions.api_key}function f(i){if(!i){d._onSubscriptionCancelError(i)}else{e=d._trigger(window.rnwWidget.constants.events.SUBSCRIPTION_CANCELED,{subscriptionToken:d.subscriptionToken,infos:i});if(!e.isDefaultPrevented()){d._onSubscriptionCancelSuccess(i)}}}if(d.options.common.http_base_url_endpoint){c.ajax({url:d.options.common.http_base_url_endpoint+"/organisations/"+g+"/subscriptions/"+d.subscriptionToken+"/cancel",cache:false,crossDomain:true,timeout:15000,dataType:"json",type:"post",contentType:"application/json",success:function(i){f(i)},})}else{c.ajax({url:d.options.widgetDefaultUrl+"subscription.php?widget-uuid="+d.widgetUUID+"&token="+d.subscriptionToken+"&action=cancel",cache:false,crossDomain:true,dataType:"jsonp",contentType:"application/json",data:h,success:function(i){var j=d.j.parseJSON(i);f(j)}})}},_performOneClickDonation:function(g){var f=this,i;i=f.options.epikOptions.apiendpoint.replace(/(.*)\//g,"");if(f.options.epikOptions.api_key){i=f.options.epikOptions.api_key}f.form=f.jGet(f.wcl("full-form"));var g={"widget-uuid":f.widgetUUID,"rnw-customer-token":f.customerToken,"rnw-payment-source-token":g.paymentSourceToken,amount:parseInt(g.amount),currency:g.currency};function h(k){var j=(typeof k.status!==undefined)?k.status:false;if(j){f.mode=window.rnwWidget.constants.modes.RESPONSE}else{f.mode=window.rnwWidget.constants.modes.FORM}f.eppTransactionId=k.epp_transaction_id;f._initializeForm()}function d(j){f.mode=window.rnwWidget.constants.modes.FORM;f._initializeForm()}if(f.options.common.http_base_url_endpoint){c.ajax({url:f.options.common.http_base_url_endpoint+"/organisations/"+i+"/customers/"+f.customerToken+"/payment-sources/"+g.paymentSourceToken+"/charge",cache:false,crossDomain:true,timeout:15000,dataType:"json",type:"post",contentType:"application/json",data:g,success:function(j){h(j)},error:function(j){d(infos)}})}else{c.ajax({url:f.options.widgetDefaultUrl+"charge.php",cache:false,crossDomain:true,dataType:"jsonp",contentType:"application/json",data:g,success:function(j){var k=f.j.parseJSON(j);h(k)},error:function(j){var k=f.j.parseJSON(j);d(k)}})}},_loadRefundTransaction:function(g){var f=this,j,i;i=f.options.epikOptions.apiendpoint.replace(/(.*)\//g,"");j={"widget-uuid":f.widgetUUID,"transaction-id":f.refund_transaction_id};if(f.options.epikOptions.api_key){j["merchant-config"]=f.options.epikOptions.api_key;i=f.options.epikOptions.api_key}function h(l){var k=(typeof l.message!==undefined)?l.message:false;switch(k){case"success":f._onRefundSuccess(l);f.on(window.rnwWidget.constants.events.REFUND_SUCCESS,l);break;default:f._onRefundError(l);f.on(window.rnwWidget.constants.events.REFUND_FAILED,l);break}}function d(k){f._onRefundError(k);f.on(window.rnwWidget.constants.events.REFUND_FAILED,k)}if(f.options.common.http_base_url_endpoint){c.ajax({url:f.options.common.http_base_url_endpoint+"/organisations/"+i+"/transactions/"+f.refund_transaction_id+"/cancel",cache:false,crossDomain:true,timeout:15000,dataType:"json",type:"post",contentType:"application/json",data:g,success:function(k){h(k)},error:function(k){d(k)}})}else{c.ajax({url:f.options.widgetDefaultUrl+"cancel.php",cache:false,crossDomain:true,dataType:"jsonp",contentType:"application/json",data:j,success:function(k){var l=f.j.parseJSON(k);h(l)},error:function(k){var l=f.j.parseJSON(k);d(l)}})}},_onEpikSuccess:function(d){},_onEpikError:function(d){},_onEpikCancel:function(d){},_onBeforeEpikResponseProcess:function(d){},_showSmsPoll:function(d){},_hideSmsPoll:function(d){},_onTransactionInfoSuccess:function(d){},_onTransactionInfoError:function(d){},_onTransactionInfoTimeout:function(d){},_onSubscriptionInfoSuccess:function(d){},_onSubscriptionInfoError:function(d){},_onSubscriptionCancelSuccess:function(d){},_onSubscriptionCancelError:function(d){},_onRefundSuccess:function(d){},_onRefundError:function(d){},_onTemplateLoaded:function(){},_validateOptions:function(d){},_defaultOptions:function(){},};rnwWidget.widgets.BaseWidget=b}(jQueryFix));(function(d){rnwWidget.utils.registerModule("classValidation",{initialize:function(p,m){var n,o=p.form.data("validator").settings.messages,l=p._validationMessages;d("[name]",m).each(function(){var q=d(this),r=p.options.common.field_class_prefix+q.attr("name").replace(/_\d+$/,"");q.addClass(r);d.each(q.attr("class").split(" "),function(){if(this in l&&l[this]!==undefined){n=l[this];o[q.attr("name")]=(typeof(n)==="string"?n:d.extend({},n))}})})},});function i(m,n){this.widget=m;this.link=n;this.content=n.next(m.wcl("popup"));this.arrow=this.content.find(m.wcl("popup-edge"));this.closeLink=this.content.find(m.wcl("popup-close"));var l=this;l.link.click(function(o){o.preventDefault();if(l.content.is(".open")){l.close()}else{l.open()}});l.closeLink.click(function(o){o.preventDefault();l.close()})}d.extend(i.prototype,{open:function(){this.position();this.content.addClass("open");this.link.addClass("active")},close:function(){this.content.removeClass("open");this.link.removeClass("active")},position:function(){var o=this._getBounds(this.link),n=this._getBounds(this.content),p=this._getBounds(this.widget.element),m=this._getBounds(this.link.offsetParent()),l=o.center-n.width/2,q=0;if(l<p.left){q=l-p.left;l=p.left}else{if(l+n.width>p.right){q=l+n.width-p.right;l=p.right-n.width}}this.content.css({left:l-m.left,top:o.top-m.top-n.height-25});this.arrow.css({left:q})},_getBounds:function(l){bounds=l.offset();bounds.width=l.outerWidth();bounds.right=bounds.left+bounds.width;bounds.center=bounds.left+bounds.width/2;bounds.height=l.outerHeight();bounds.bottom=bounds.top+bounds.height;bounds.middle=bounds.top+bounds.height/2;return bounds}});rnwWidget.utils.registerModule("popup",{initialize:function(m,l){d(m.wcl("popup-open"),l).each(function(o,p){var q=d(p),n;if(q.data("widgetPopup")===undefined){n=new i(m,q);q.data("widgetPopup",n)}})}});function a(o,n){var m=function(){var p=d(o.options.common.overlay_target);return p.length>0?p:d("body")};this.widget=o;this.content=n;this.container=m();this.allowEscClose=o.options.common.overlay_esc_close===undefined?true:o.options.common.overlay_esc_close;this.height=this.content.data("overlay-height");this.background=d("<div></div>").addClass(o.wcl("overlay-bg",false));this.callbacks={};this.isOpen=false;var l=this;this.content.find("[data-overlay-close]").on("click",function(p){p.preventDefault();l.close(d(this).data("overlay-close"))})}d.extend(a.prototype,{open:function(l){var m=this;if(!l){l={}}if(a.activeOverlay!==null){a.activeOverlay.close()}if(m.widget.modules.templateInjector!==undefined){d("[data-template]",this.content).each(function(){var p=d(this).data("name"),o=m.widget.modules.templateInjector[p],n=(l===undefined||l.templateData===undefined||l.templateData===null?null:l.templateData[p]||null);if(o!==undefined){o.inject(n)}})}this.isOpen=true;this.update();this.content.css({"z-index":9999,height:l.height||this.height,});this.background.css({position:"absolute",width:"100%",height:this.container.outerHeight(true),top:this.container.position().top,"z-index":9998,});this.container.append(this.background);a.activeOverlay=this;this.background.show();this.content.fadeIn(function(){m.widget._trigger(window.rnwWidget.constants.moduleEvents.MODAL_OPEN,null,m.content)});this.callbacks={};return this},close:function(m){var l=this;if(!l.isOpen){return this}a.activeOverlay=null;l.isOpen=false;l.background.fadeOut();l.content.fadeOut(function(){l.background.remove();l._executeCallback(m);l.widget._trigger(window.rnwWidget.constants.moduleEvents.MODAL_CLOSE,{action:m||"close"},l.content);l.callbacks={}});return this},callback:function(l){this.callbacks=l},update:function(){var l=d(window).scrollTop()-this.widget.element.offset().top,m=l+d(window).height()/2-this.content.height()/2,o=0,n=this.widget.element.outerHeight(true)-this.content.height();this.content.css("top",Math.max(o,Math.min(n,m)));this.background.css("height",this.container.outerHeight(true))},_executeCallback:function(l){if(l in this.callbacks){this.callbacks[l].call(this,l)}else{if("default" in this.callbacks){this.callbacks["default"].call(this,l)}}},_onResize:function(l){this.update()},});rnwWidget.utils.registerModule("overlay",{initialize:function(m,l){if(a.initialized!==true){a.initialized=true;a.activeOverlay=null;d(window).resize(function(){if(a.activeOverlay!==undefined&&a.activeOverlay!==null){a.activeOverlay._onResize()}});d(window).keypress(function(n){if(a.activeOverlay!==undefined&&a.activeOverlay!==null){if(n.keyCode===27&&a.activeOverlay.allowEscClose){a.activeOverlay.close("escape")}}})}d(m.wcl("overlay"),l).each(function(){m.modules.overlay[d(this).data("overlay-name")]=new a(m,d(this))});d(m.wcl("overlay-trigger"),l).click(function(o){o.preventDefault();var n=d(this).attr("data-target");if(m.modules.overlay[n]!==undefined){m.modules.overlay[n].open()}})}});rnwWidget.utils.registerModule("ichTemplates",{initialize:function(m,l){ich.grabTemplates(l[0])}});function b(o,l,n){this.widget=o;this.tabContainer=l;this.handle=n;this.link=this.handle.find("a");this.content=d(this.link.data("target"),this.tabContainer.element);this.enabled=true;var m=this;this.handle.on("click",function(p){p.preventDefault();m.select()})}d.extend(b.prototype,{select:function(){var l=this;d(this.widget.wcl("tabs")+" li",this.tabContainer.element).removeClass("active");this.handle.addClass("active");d(this.widget.wcl("tab-content"),this.tabContainer.element).stop().hide();this.content.fadeIn({complete:function(){l.content[0].style.display="block"},});this.widget._trigger(window.rnwWidget.constants.moduleEvents.ELEMENT_SELECTED,{module:"tab",tabContainer:this.tabContainer,tabItem:this},this.content)},isActive:function(){return this.handle.is(".active")},show:function(){this.enabled=true;this.handle.show()},hide:function(l){var m;this.enabled=false;l=(l===undefined?true:l);if(l&&this.isActive()){m=this.tabContainer.getFirst(function(n){return n.enabled});if(m!==undefined){m.show()}}this.handle.hide()},});function f(n,l){this.widget=n;this.container=l;this.tabs=[];var m=this,o;d([n.wcl("tabs"),"li"].join(" "),l).each(function(){m.tabs.push(new b(n,m,d(this)))});o=m.getFirst(function(p){return p.isActive()});if(o!==undefined){o.select()}}d.extend(f.prototype,{getItems:function(){return this.tabs},get:function(l){return d.grep(this.tabs,l)},getFirst:function(l){return this.get(l).shift()},});rnwWidget.utils.registerModule("tab",{initialize:function(m,l){d(m.wcl("tab-container"),l).each(function(){var n=new f(m,d(this)),o=d(this).data("name");m.modules.tab[o]=n})},});function c(o,n,m){this.widget=o;this.accordionContainer=n;this.handle=m;this.link=this.handle.find(this.widget.wcl("accordion-header"));this.content=d(this.link.data("target"),this.accordionContainer.element);this.enabled=true;var l=this;this.link.on("click",function(p){p.preventDefault();l.select()})}d.extend(c.prototype,{select:function(){var l=this;if(!this.handle.is(".accordion-open")){d(this.widget.wcl("accordion-item"),this.accordionContainer.element).removeClass("accordion-open");this.handle.addClass("accordion-open");d(this.widget.wcl("accordion-content"),this.accordionContainer.element).stop().hide();this.content.fadeIn({complete:function(){l.content[0].style.display="block"},});this.widget._trigger(window.rnwWidget.constants.moduleEvents.ELEMENT_SELECTED,{module:"accordion",accordionContainer:this.accordionContainer,accordionItem:this},this.content)}},isActive:function(){return this.handle.is(".accordion-open")},show:function(){this.enabled=true;this.handle.show()},hide:function(l){var m;this.enabled=false;l=(l===undefined?true:l);if(l&&this.isActive()){m=this.accordionContainer.getFirst(function(n){return n.enabled});if(m!==undefined){m.show()}}this.handle.hide()},});function j(n,l){this.widget=n;this.container=l;this.element=l;this.accordionItems=[];var m=this,o;d(n.wcl("accordion-item"),l).each(function(){m.accordionItems.push(new c(n,m,d(this)))});o=m.getFirst(function(p){return p.isActive()});if(o!==undefined){o.select()}}d.extend(j.prototype,{getItems:function(){return this.accordionItems},get:function(l){return d.grep(this.accordionItems,l)},getFirst:function(l){return this.get(l).shift()},});rnwWidget.utils.registerModule("accordion",{initialize:function(m,l){d(m.wcl("accordion-container"),l).each(function(){var n=new j(m,d(this)),o=d(this).data("name");m.modules.accordion[o]=n})},});rnwWidget.utils.registerModule("select2",{initialize:function(m,l){d(m.wcl("select2-replace"),l).select2({minimumResultsForSearch:-1,width:"off",})},});rnwWidget.utils.registerModule("select2-search",{initialize:function(m,l){d(m.wcl("select2-replace-search"),l).select2({minimumResultsForSearch:0,width:"off",})},});rnwWidget.utils.registerModule("select2FlickerFix",{initialize:function(n,l){var m=d(n.jGet("select"),l);m.on("select2-opening",function(p){var o=d(p.target);if(o){m.not(o).select2("close")}})},});function k(o,l){this.container=l;this.widget=o;this.target=d(o.wcl("member-list-target"),l);this.index=0;this.count=0;this.config=o.options.members||{min:0,max:0,initial:0};this.addButton=d(o.wcl("member-add"),l);this.memberTemplate=ich[o.getId("ich_member_item")];var n=this,m;this.addButton.on("click",function(p){p.preventDefault();if(n.count<n.config.max){n.add()}});this.container.on("click",o.wcl("member-delete"),function(p){p.preventDefault();n.remove(d(this).parent(o.wcl("member-item")))});while(this.count<this.config.initial){this.add(null,this.count>=this.config.min)}}d.extend(k.prototype,{add:function(n,l){var m=this.index++,o;this.count++;l=(l===undefined?true:l);o=this.memberTemplate({memberIndex:m,memberId:this.widget.getId("member_"+m),removable:l});this.target.append(o);rnwWidget.utils.applyModules(this.widget,o);this.widget._trigger(window.rnwWidget.constants.moduleEvents.ELEMENT_ADDED,{module:"memberList",memberIndex:m},o);if(this.count===this.config.max){this.addButton.hide()}},remove:function(m){var n=this,l=d(this.widget.wcl("member-delete-overlay"),m);this.count--;d(this.widget.wcl("button-confirm"),l).one("click",function(o){o.preventDefault();l.hide();n.widget._trigger(window.rnwWidget.constants.moduleEvents.ELEMENT_REMOVED,{module:"memberList",memberIndex:m.data("index")},m);m.fadeOut(function(){m.remove();if(n.count<n.config.max){n.addButton.show()}})});d(this.widget.wcl("button-cancel"),l).one("click",function(o){o.preventDefault();l.hide()});l.show()},});rnwWidget.utils.registerModule("memberList",{initialize:function(m,l){d(m.wcl("member-list"),l).each(function(){var n=d(this).data("module-name")||"memberList";list=new k(m,d(this));m.modules.memberList[n]=list})},});function h(m,l){this.container=l;this.year=l.find(m.wcl("year"));this.month=l.find(m.wcl("month"));this.day=l.find(m.wcl("day"))}d.extend(h.prototype,{getDate:function(){var m=parseInt(this.year.val()),n=parseInt(this.month.val()),l=parseInt(this.day.val());if(this._isYear(m)&&this._isMonth(n)&&this._isDay(l)){return new Date(m,n-1,l)}else{return null}},setDate:function(l){if(l===undefined||l.constructor.name!=="Date"){console.warn("Date has to be a Date object",l);return}this.year.val(l.getFullYear());this.month.val(l.getMonth()+1);this.day.val(l.getDate())},isValid:function(){return this.getDate()!==null},_numRange:function(n,m,l){return !(isNaN(n)||n<m||n>l)},_isYear:function(l){return this._numRange(l,0,3000)},_isMonth:function(l){return this._numRange(l,1,12)},_isDay:function(l){return this._numRange(l,1,31)},});rnwWidget.utils.registerModule("tripleDate",{initialize:function(m,l){d("[data-field-type=tripledate]",l).each(function(){var n=d(this).data("name");if(m.modules.tripleDate[n]===undefined){m.modules.tripleDate[n]=new h(m,d(this));d(this).data("tripleDate",m.modules.tripleDate[n])}});if(d.validator!==undefined&&d.validator.methods.tripledate===undefined){d.validator.addMethod("tripledate",function(q,p){var n=d(p).parents("[data-field-type=tripledate]"),o=n.data("tripleDate");return this.optional(p)||o===undefined||o.isValid()},"Please enter a valid date")}},});function g(m,l){this.widget=m;this.container=l;this.template=ich[m.getId(this.container.data("template"))]}d.extend(g.prototype,{inject:function(l,m){var n=this;content=d();if(l!==undefined&&l!==null){if(d.isArray(l)){d.each(l,function(o,p){content=content.add(n.template(p))})}else{content=content.add(n.template(l))}}n.container.empty().append(content);if(m!==false){rnwWidget.utils.applyModules(n.widget,content)}},});rnwWidget.utils.registerModule("templateInjector",{initialize:function(m,l){d("[data-template]",l).each(function(){m.modules.templateInjector[d(this).data("name")]=new g(m,d(this))})},});rnwWidget.utils.registerModule("toggleTrigger",{initialize:function(m,l){d(m.wcl("toggle-trigger"),l).click(function(o){o.preventDefault();var n=d(this).attr("data-target");d("#"+m.getId(n)).toggle()})}})})(jQueryFix);if(String.prototype.decode==null){String.prototype.decode=function(){var c=this;var a=this.match(/_[0-9]+_/g);if(a){for(var b=0;b<a.length;b++){regexp=new RegExp(a[b],"g");c=c.replace(regexp,String.fromCharCode(a[b].replace(/_/g,"")))}}return c.toString()}}if(String.prototype.encode==null){String.prototype.encode=function(b){var c="";for(var a=0;a<this.length;a++){if(this.charAt(a).search(/[-A-Za-z0-9]/)==-1){c+="_"+this.charCodeAt(a)+"_"}else{c+=this.charAt(a)}}return c.toString()}}if(String.prototype.endsWith==null){String.prototype.endsWith=function(a){return(this.match(a+"$")==a)}}function EPIK(v,d){if(typeof(console)=="object"&&typeof(console.log)=="function"){this.log=function(x){console.log("EPIK: "+x)}}else{this.log=function(x){}}this.CONSTANTS=new Object();this.CONSTANTS.CONFIG=new Object();this.CONSTANTS.CONFIG.SECURE_COOKIE="secure_cookie";this.CONSTANTS.CONFIG.ENABLE_JQUERY="enable_jquery";this.CONSTANTS.CONFIG.IFRAME_CONTAINER="iframe_container";this.CONSTANTS.CONFIG.AUTO_SUBMIT="auto_submit";this.CONSTANTS.CONFIG.IFRAME_LOADING_PAGE="iframe_loading_page";this.CONSTANTS.CONFIG.TRIGGER_EVENT="trigger_event";this.CONSTANTS.PAYMENT_METHODS=new Object();this.CONSTANTS.PAYMENT_METHODS.SMS="sms";this.CONSTANTS.PAYMENT_METHODS.VISA="visa";this.CONSTANTS.PAYMENT_METHODS.ECA="eca";this.CONSTANTS.PAYMENT_METHODS.AMX="amx";this.CONSTANTS.PAYMENT_METHODS.PEX="pex";this.CONSTANTS.PAYMENT_METHODS.EZS="ezs";this.CONSTANTS.PAYMENT_METHODS.ES="es";this.CONSTANTS.PAYMENT_METHODS.POS="pos";this.CONSTANTS.PAYMENT_METHODS.PFC="pfc";this.CONSTANTS.PAYMENT_METHODS.PEF="pef";this.CONSTANTS.PAYMENT_METHODS.TWI="twi";this.CONSTANTS.FORM_FIELD=new Object();this.CONSTANTS.FORM_FIELD.AMOUNT="amount";this.CONSTANTS.FORM_FIELD.COVER_TRANSACTION_FEE="cover_transaction_fee";this.CONSTANTS.FORM_FIELD.CURRENCY="currency";this.CONSTANTS.FORM_FIELD.SUCCESS_URL="success_url";this.CONSTANTS.FORM_FIELD.ERROR_URL="error_url";this.CONSTANTS.FORM_FIELD.CANCEL_URL="cancel_url";this.CONSTANTS.FORM_FIELD.TEST_MODE="test_mode";this.CONSTANTS.FORM_FIELD.MOBILE_MODE="mobile_mode";this.CONSTANTS.FORM_FIELD.POLLSTATUS_URL="pollstatus_url";this.CONSTANTS.FORM_FIELD.PAYMENT_METHOD="payment_method";this.CONSTANTS.FORM_FIELD.LANGUAGE="language";this.CONSTANTS.FORM_FIELD.TRANSACTION_ID="transaction_id";this.CONSTANTS.FORM_FIELD.REFNO="refno";this.CONSTANTS.FORM_FIELD.MSISDN="msisdn";this.CONSTANTS.FORM_FIELD.SID="sid";this.CONSTANTS.FORM_FIELD.KEYWORD="keyword";this.CONSTANTS.FORM_FIELD.ES_MESSAGE="es_message";this.CONSTANTS.FORM_FIELD.POPUP="popup";this.CONSTANTS.FORM_FIELD.CARD_HOLDER_NAME="card_holder_name";this.CONSTANTS.FORM_FIELD.RECURRING="recurring";this.CONSTANTS.FORM_FIELD.RECURRING_INTERVAL="recurring_interval";this.CONSTANTS.FORM_FIELD.PAYER_LINE_PREFIX="payer_line";this.CONSTANTS.FORM_FIELD_SELECTOR=":input:not(:button):not(:submit):not(:radio):not(:checkbox):not(.rnw-ignore),:input:checkbox:checked:not(.rnw-ignore),:input:radio:checked:not(.rnw-ignore)";this.CONSTANTS.HTTP_METHOD=new Object();this.CONSTANTS.HTTP_METHOD.POST="POST";this.CONSTANTS.HTTP_METHOD.GET="GET";var j=new Object();j.currency={hidden:false,mandatory:true,sendToEpp:true};j.amount={hidden:false,mandatory:true,sendToEpp:true};j.error_url={hidden:true,mandatory:true,sendToEpp:true};j.cancel_url={hidden:true,mandatory:true,sendToEpp:true};j.success_url={hidden:true,mandatory:true,sendToEpp:true};j.payment_method={hidden:false,mandatory:true,sendToEpp:true};j.test_mode={hidden:true,mandatory:true,sendToEpp:true};j.pollstatus_url={hidden:true,mandatory:false,sendToEpp:false};j.mobile_mode={hidden:true,mandatory:true,sendToEpp:true};j.popup={hidden:true,mandatory:false,sendToEpp:true};j.language={hidden:false,mandatory:true,sendToEpp:true};j.transaction_id={hidden:true,mandatory:false,sendToEpp:true};j.msisdn={hidden:false,mandatory:false,sendToEpp:true};j.sid={hidden:true,mandatory:false,sendToEpp:true};j.keyword={hidden:false,mandatory:false,sendToEpp:true};j.es_message={hidden:false,mandatory:false,sendToEpp:true};j.recurring={hidden:false,mandatory:false,sendToEpp:true};j.recurring_interval={hidden:false,mandatory:false,sendToEpp:true};j.stored_customer_email={hidden:false,mandatory:false,sendToEpp:true};j.secure_cookie={hidden:true,mandatory:false,sendToEpp:false};j.method={hidden:true,mandatory:false,sendToEpp:false};j.addmerchantparameter_url={hidden:true,mandatory:false,sendToEpp:false};j.setfinalstatus_url={hidden:true,mandatory:false,sendToEpp:false};j.apiendpoint={hidden:true,mandatory:false,sendToEpp:false};j.enable_jquery={hidden:true,mandatory:false,sendToEpp:false};j.iframe_container={hidden:true,mandatory:false,sendToEpp:false};j.trigger_event={hidden:true,mandatory:false,sendToEpp:false};j.auto_submit={hidden:true,mandatory:false,sendToEpp:false};j.iframe_loading_page={hidden:true,mandatory:false,sendToEpp:false};this.log("Config parameters initialized");var n={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(A){for(var x=0;x<A.length;x++){var y=A[x].string;var z=A[x].prop;this.versionSearchString=A[x].versionSearch||A[x].identity;if(y){if(y.indexOf(A[x].subString)!=-1){return A[x].identity}}else{if(z){return A[x].identity}}}},searchVersion:function(y){var x=y.indexOf(this.versionSearchString);if(x==-1){return}return parseFloat(y.substring(x+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};n.init();this.log("Check Browser and Browser Version.");if((n.browser=="Firefox"&&n.version<3.4)||(n.browser=="Explorer"&&n.version<8)||(n.browser=="Chrome"&&n.version<6)||(n.browser=="Safari"&&n.version<4)||(n.browser=="Opera"&&n.version<8)){this.log("NotSupportedBrowser")}var k=this;this.options=new Object();var u=function(){};this.beforeSubmit=function(x){u=x;k.options.before_submit=x};this.setSubmitHandler=function(x){k.options.submit_handler=x};if(typeof jQueryFix=="undefined"&&typeof EPIK.jq=="undefined"){throw"NojQueryException"}else{if(typeof EPIK.jq=="undefined"){var s="true";if(typeof v=="string"&&typeof d=="object"){if(d.enable_jquery){s=d.enable_jquery}}else{if(typeof v=="object"&&!d){if(v.enable_jquery){s=v.enable_jquery}}}if(s=="false"){EPIK.jq=jQueryFix.noConflict(true)}else{EPIK.jq=jQueryFix}}}if(parseInt(EPIK.jq().jquery.replace(/[0-9]+\.([0-9]+).[0-9]+/,"$1"))<4){}var i=function(){var x=null;if(document.forms.length==1){x=EPIK.jq(document.forms[0])}else{if(document.forms.length>1){throw"MoreThanOneFormFoundException"}else{throw"FormNotFoundException"}}return x};var b=null;this.formKey="";if(!v){b=i()}else{if(typeof v=="string"){b=EPIK.jq("#"+v);this.formKey=v;if(d){this.options=d}}else{if(typeof v=="object"&&!d){b=i();this.options=v}}}if(this.options.iframe_container!=""){var a=EPIK.jq("#"+this.options.iframe_container);if(a.length==0){this.options.iframe_container=""}}if(this.options.before_submit){u=this.options.before_submit}this.updateValueOfField=function(z,B){var x=b.find(":input[name="+z+"]");var y="";if(x.attr("type")){y=x.attr("type").toLowerCase()}var A="click";if(k.options.trigger_event){A=k.options.trigger_event}if(y!="radio"&&y!="checkbox"){x.val(B);x.trigger(A,true)}else{x.each(function(){if(EPIK.jq(this).val()==B){EPIK.jq(this).trigger(A,true);EPIK.jq(this)[0].checked=true}else{EPIK.jq(this)[0].checked=false}})}};this.retrieveValueFromField=function(z){var x=b.find(":input[name="+z+"]");var y="";if(x.attr("type")){y=x.attr("type").toLowerCase()}if(y!="radio"&&y!="checkbox"&&y!="submit"&&y!="button"){return x.val()}else{return x.filter(":checked").val()?x.filter(":checked").val():""}};this.readCookie=function(A){var B="epik_"+A+"=";var z=document.cookie.split(";");for(var y=0;y<z.length;y++){var x=EPIK.jq.trim(z[y]);if(x.indexOf(B)==0){return x.substring(B.length,x.length)}}return null};this.readValueFromCookie=function(y,C){var B=this.readCookie(C);if(B!=null){var A=B.split("&");for(var z in A){if(A[z].indexOf(y.encode()+":")!=-1){var x=A[z].split(":");if(x.length==2){return x[1].decode()}}}}return null};this.removeFromCookieString=function(x,z){var y=k.readCookie(z);var A=x.encode();if(y!=null){var C=y.indexOf(A+":");if(C!=-1){var B=y.indexOf("&",C);if(B==-1){y=y.substring(0,C-1)}else{y=y.substring(0,C)+y.substring(B+1,y.length)}}}else{y=""}return y};this.removeFromCookie=function(x,y){document.cookie="epik_"+y+"="+this.removeFromCookieString(x,y)+"; ; path=/"};this.deleteCookie=function(y){var x=new Date();x.setTime(x.getTime()-(24*60*60*1000));var z="";if(k.options.secure_cookie&&k.options.secure_cookie=="true"){z="secure;"}document.cookie="epik_"+y+"=null; expires="+x.toGMTString()+"; path=/;"+z};this.updateCookie=function(x,B,A){var z=k.readCookie(A);var D=x.encode();var E=null;if(x!=="cardno"&&x!=="cvv"&&x!=="expy"&&x!=="expm"){if(typeof B=="number"||typeof B=="object"||typeof B=="undefined"){E=B+""}else{if(typeof B=="boolean"){E=B?"1":"0"}else{E=B.encode()}}var y=D+":"+E;if(z==null){z=""}if(z.indexOf(D+":")!=-1&&((z.indexOf(y)==-1&&E!="")||(E==""))){z=k.removeFromCookieString(x,A)}if(z.indexOf(D+":")==-1&&z.indexOf(y)==-1){if(z!=""){z+="&"}z+=y}var C="";if(k.options.secure_cookie&&k.options.secure_cookie=="true"){C="secure;"}document.cookie="epik_"+A+"="+z+"; ; path=/;"+C}};var m=this.readCookie(this.formKey)?this.readCookie(this.formKey).split("&"):new Array();for(var c in m){if(m.hasOwnProperty(c)){var g=m[c].split(":");if(g.length==2){var f=g[0].decode();var l=g[1].decode();if(!this.options[f]){this.options[f]=l}}}}var q=this.readCookie(this.formKey+"_merchantparameter")?this.readCookie(this.formKey+"_merchantparameter").split("&"):[];for(var c in q){if(q.hasOwnProperty(c)){var t=q[c].split(":");if(t.length==2){var w=t[0].decode();var p=t[1].decode();if(!this.options[w]){this.options[w]=p}}}}b.find(k.CONSTANTS.FORM_FIELD_SELECTOR).each(function(){var A=EPIK.jq(this);var z=A.attr("name");if(z){var y=k.retrieveValueFromField(z);if(y!=""){var x=k.formKey;if(!j[z]){x=x+"_merchantparameter"}if(z=="amount"){y=parseFloat(y)}if(!k.options[z]||k.options[z]==""){k.options[z]=y;k.updateCookie(z,y,x)}}}});b.find(":input:not(:button):not(:submit)").on("change",function(B,y){var C=EPIK.jq(this);var A=C.attr("name");if(A&&!y){var z=k.retrieveValueFromField(A);var x=k.formKey;if(!j[A]){x=x+"_merchantparameter"}if(A=="amount"){z=parseFloat(z)}k.options[A]=z;k.updateCookie(A,z,x)}});if(!this.options.method){this.options.method="POST";if(b.attr("method")==""){b.attr("method",this.options.method)}}if(!this.options.mobile_mode){this.options.mobile_mode=false}if(!this.options.delete_data_after_submit){this.options.delete_data_after_submit=false}var o=function(){var y=k;var x=j;try{b.find(y.CONSTANTS.FORM_FIELD_SELECTOR).each(function(){var E=EPIK.jq(this);var D=E.attr("name");if(D){var C=k.retrieveValueFromField(D);var B=y.formKey;if(!x[D]){B=B+"_merchantparameter"}if(D=="amount"){var A=k.retrieveValueFromField("stored_rnw_cover_fee_amount");var F=parseFloat(C)+(parseFloat(A)||0);y.updateValueOfField(D,F)}y.updateCookie(D,C,B)}})}catch(z){}};var r=function(){k.log("auto submit form called");o();var x=true;try{if(b.attr("action")==""){if(k.getApiEndpoint()&&k.getApiEndpoint()!=""){b.attr("action",k.getApiEndpoint())}else{throw"NotDefinedApiEndpointException"}}x=u();if(typeof x!="undefined"&&!x){return false}if(b.attr("action")==k.getApiEndpoint()){k.updateForm(true);k.validateForm();if(!k.options.submit_handler){if(k.options.iframe_container&&k.options.iframe_container!=""){k.createAndSubmitIFrame();x=false}else{x=true}if(typeof k.options.delete_data_after_submit!="undefined"&&k.options.delete_data_after_submit&&k.options.delete_data_after_submit!="false"){k.deleteData()}if(!x){return x}}else{k.log("submit handler called");k.options.submit_handler();return false}}else{if(typeof k.options.submit_handler=="function"){k.options.submit_handler();return false}}}catch(y){k.log(y);return false}return true};this.makeReadyToSubmit=function(){k.log("make ready to submit called");o();var x=true;try{if(b.attr("action")==""){b.attr("action",k.getApiEndpoint())}x=u();if(typeof x!="undefined"&&!x){return false}if(b.attr("action")==k.getApiEndpoint()){k.updateForm(true);k.validateForm();if(typeof k.options.submit_handler=="function"){k.options.submit_handler()}}else{if(typeof k.options.submit_handler=="function"){k.options.submit_handler()}}}catch(y){return false}return true};if(typeof this.options.auto_submit=="undefined"||this.options.auto_submit=="true"){b.submit(function(){return r()})}else{b.submit(function(){return false})}this.updateForm=function(x){k.log("update form called");this.createMandatoryAndNotHiddenFormFields(x);this.createHiddenFormFields();this.createMerchantParameterFields()};this.createMandatoryAndNotHiddenFormFields=function(C){if(!C){C=false}var B;var A;for(var z in j){if(!j[z].hidden&&j[z].mandatory){B=b.find(":input[name="+z+"]");if(B.length==0){var y=k.options[z];if(z=="amount"&&y){y=parseFloat(y)}var x="hidden";if(!C){A=EPIK.jq("<label/>").text(z);b.append(A);x="text"}k.createFormField(z,x,y)}}}};this.createHiddenFormFields=function(){for(var x in j){if(j[x].hidden&&j[x].sendToEpp){k.createFormField(x,"hidden",k.options[x])}}};this.createFormField=function(y,x,A){var z;var B;z=b.find(":input[name="+y+"]");if(typeof A!="function"){if(z.length==0){B=EPIK.jq("<input/>").attr({type:x,value:(A?A:""),name:y});b.append(B)}else{if(z.val()==""){z.val(A?A:"")}}}};this.createMerchantParameterFields=function(){var y;for(var x in k.options){y=b.find(":input[name="+x+"]");if(!j[x]&&y.length==0&&k.options[x]){k.createFormField(x,"hidden",k.options[x])}}};this.validateForm=function(){k.log("validate form called");var z;for(var y in j){if(j[y].mandatory){z=b.find(":input[name="+y+"]");if(z.length==0){throw"MandatoryFieldNotFoundException: Form field "+y+" is missing."}else{var x="";if(z.attr("type")){x=z.attr("type")}if(x!="radio"&&x!="checkbox"){if(!EPIK.jq.trim(z.val())){throw"MandatoryFieldNotFoundException: Form field "+y+" is missing."}}else{if(EPIK.jq(z.selector+":checked").length<1){throw"MandatoryFieldNotFoundException: Form field "+y+" is missing."}}}}}if(k.getRecurring()=="true"){if(!k.options.stored_customer_email){throw ("Parameter stored_customer_email not defined")}if(!k.options.recurring_interval){throw ("Parameter recurring_interval not defined")}}};this.deleteData=function(){k.deleteCookie(k.formKey);k.deleteCookie(k.formKey+"_merchantparameter")};this.fillOutForm=function(A){k.log("fill out form called");if(!A){A=false}var z;for(var y in k.options){z=b.find(":input[name="+y+"]");if(z.length!=0){var x=z.attr("type");if(!x){x=""}if(A||(z.val()==""||(z.is("select")||x=="radio"||x=="checkbox"))){if(y=="amount"){k.updateValueOfField(y,parseFloat(k.options[y]))}else{k.updateValueOfField(y,k.options[y])}}}}};this.addStoredMerchantParameterField=function(z){if(!z.name){throw"StoredMerchantFieldNameIsMissingException"}if(!z.label){z.label=z.name}if(!z.value){z.value=""}if(!z.parent_container){z.parent_container=b}var x="text";if(!z.hidden){z.hidden=false;x="hidden"}if(!z.classes){z.classes=""}var y="";if(!z.hidden){y="<label>"+z.label+"</label>"}z.parent_container.append(y+'<input name="stored_'+z.name+'" type="'+x+'" class="'+z.classes+'" value="'+z.value+'"/>');k.setStoredMerchantParameter(z.name,z.value)};this.addMerchantParameterField=function(z){if(!z.name){throw"MerchantFieldNameIsMissingException"}if(!z.label){z.label=z.name}if(!z.value){z.value=""}if(!z.parent_container){z.parent_container=b}var x="text";if(!z.hidden){z.hidden=false;x="hidden"}if(!z.classes){z.classes=""}var y="";if(!z.hidden){y="<label>"+z.label+"</label>"}z.parent_container.append(y+'<input name="'+z.name+'" type="'+x+'" class="'+z.classes+'" value="'+z.value+'"/>');k.setMerchantParameter(z.name,z.value)};this.setCurrency=function(x){x=x.toLowerCase();k.options.currency=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.CURRENCY,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.CURRENCY,x)};this.setAmount=function(y){var x=0;x=parseFloat(y);k.options.amount=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.AMOUNT,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.AMOUNT,x)};this.setErrorUrl=function(x){k.options.error_url=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.ERROR_URL,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.ERROR_URL,x)};this.setCancelUrl=function(x){k.options.cancel_url=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.CANCEL_URL,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.CANCEL_URL,x)};this.setSuccessUrl=function(x){k.options.success_url=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.SUCCESS_URL,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.SUCCESS_URL,x)};this.setApiEndpoint=function(x){k.options.apiendpoint=x;k.updateCookie("apiendpoint",x,k.formKey);b.attr("action",x)};this.setMethod=function(x){k.options.method=x;k.updateCookie("method",x,k.formKey);b.attr("method",x)};this.setPollStatusUrl=function(x){k.options.pollstatus_url=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.POLLSTATUS_URL,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.POLLSTATUS_URL,x)};this.setPaymentMethod=function(x){x=x.toLowerCase();k.options.payment_method=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.PAYMENT_METHOD,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.PAYMENT_METHOD,x)};this.setTestMode=function(x){x=x.toLowerCase();k.options.test_mode=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.TEST_MODE,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.TEST_MODE,x)};this.setMobileMode=function(x){x=x.toLowerCase();k.options.mobile_mode=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.MOBILE_MODE,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.MOBILE_MODE,x)};this.setLanguage=function(x){x=x.toLowerCase();k.options.language=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.LANGUAGE,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.LANGUAGE,x)};this.setStoredMerchantParameter=function(x,y){if(x.indexOf("stored_")!=0){throw"ParameterNameException : Parameter has to start with stored_"}k.options[x]=y;k.updateCookie(x,y,k.formKey+"_merchantparameter");k.updateValueOfField(x,y)};this.setMerchantParameter=function(x,y){if(x.indexOf("stored_")==0){throw"ParameterNameException : Parameter may not start with stored_"}k.options[x]=y;k.updateCookie(x,y,k.formKey+"_merchantparameter");k.updateValueOfField(x,y)};this.setTransactionId=function(x){k.options.transaction_id=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.TRANSACTION_ID,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.TRANSACTION_ID,x)};this.setRefNo=function(x){k.options.refno=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.REFNO,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.REFNO,x)};this.setESMessage=function(x){k.options.es_message=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.ES_MESSAGE,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.ES_MESSAGE,x)};this.setMSISDN=function(x){k.options.msisdn=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.MSISDN,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.MSISDN,x)};this.setSID=function(x){k.options.sid=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.SID,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.SID,x)};this.setKeyword=function(x){k.options.keyword=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.KEYWORD,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.KEYWORD,x)};this.setPayerLine=function(x,z){var y=k.CONSTANTS.FORM_FIELD.PAYER_LINE_PREFIX+x;this.createFormField(y,"hidden",z);k.options[y]=z;k.updateCookie(y,z,k.formKey);k.updateValueOfField(y,z)};this.setPopUp=function(x){k.options.popup=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.POPUP,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.POPUP,x)};this.setCardHolderName=function(x){k.options.card_holder_name=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.CARD_HOLDER_NAME,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.CARD_HOLDER_NAME,x)};this.setRecurring=function(x){k.options.recurring=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.RECURRING,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.RECURRING,x)};this.setRecurringInterval=function(x){k.options.recurring_interval=x;k.updateCookie(k.CONSTANTS.FORM_FIELD.RECURRING_INTERVAL,x,k.formKey);k.updateValueOfField(k.CONSTANTS.FORM_FIELD.RECURRING_INTERVAL,x)};this.setSecureCookie=function(x){k.options.secure_cookie=x;k.updateCookie(this.CONSTANTS.CONFIG.SECURE_COOKIE,x,k.formKey)};this.getCurrency=function(){return k.options.currency};this.getAmount=function(){return k.options.amount};this.getErrorUrl=function(){return k.options.error_url};this.getCancelUrl=function(){return k.options.cancel_url};this.getSuccessUrl=function(){return k.options.success_url};this.getApiEndpoint=function(){return k.options.apiendpoint};this.getMethod=function(){return k.options.method};this.getPollStatusUrl=function(){return k.options.pollstatus_url};this.getPaymentMethod=function(){return k.options.payment_method};this.getTestMode=function(){return k.options.test_mode};this.getMobileMode=function(){return k.options.mobile_mode};this.getLanguage=function(){return k.options.language};this.getMerchantParameter=function(x){if(x.indexOf("stored_")==0){throw"ParameterNameException : Parameter may not start with stored_"}return k.options[x]};this.getStoredMerchantParameter=function(x){if(x.indexOf("stored_")!=0){throw"ParameterNameException : Parameter has to start with stored_"}return k.options[x]};this.getTransactionId=function(){return k.options.transaction_id};this.getRefNo=function(){return k.options.refno};this.getESMessage=function(){return k.options.es_message};this.getPayerLine=function(x){return k.options[k.CONSTANTS.FORM_FIELD.PAYER_LINE_PREFIX+x]};this.getMSISDN=function(){return k.options.msisdn};this.getSID=function(){return k.options.sid};this.getKeyword=function(){return k.options.keyword};this.getPopUp=function(){return k.options.popup};this.getCardHolderName=function(){return k.options.card_holder_name};this.getRecurring=function(){return k.options.recurring};this.getRecurringInterval=function(){return k.options.recurring_interval};this.getSecureCookie=function(){return k.options.secure_cookie};this.createAndSubmitIFrame=function(){var A=k.options.iframe_container;var z=b;if(A){z=EPIK.jq("#"+A);if(z.length==0){throw"NoElementFoundException"}}var B="#";if(k.options.iframe_loading_page){B=k.options.iframe_loading_page}var x=EPIK.jq("<iframe/>").attr({width:"100%",height:"100%",name:"epp_iframe",frameborder:0,src:B});var y=EPIK.jq("<form/>").attr({action:k.getApiEndpoint(),method:k.getMethod(),"accept-charset":"UTF-8"});b.find(k.CONSTANTS.FORM_FIELD_SELECTOR).each(function(){var F=EPIK.jq(this);var E=F.attr("name");if(E){var D=k.retrieveValueFromField(E);if(E=="amount"&&D){D=parseFloat(D)}if(k.options.iframe_landing_url&&k.options.iframe_landing_url!=""){if((E=="success_url"||E=="cancel_url"||E=="error_url")&&D){D=k.options.iframe_landing_url}}var C=EPIK.jq("<input/>").attr({type:"hidden",name:E,value:D});y.append(C)}});z.find("iframe[name=epp_iframe]").remove();z.empty();z.append(x);k.waitUntilLoaded(x,y,B)};this.waitUntilLoaded=function(D,A,B){var x=D;var y=A;var z=B;var C=function(){if(!!z.match(/rnw-widget\.html/)){var E={topic:"rnw-form-submit",data:y[0].outerHTML};x[0].contentWindow.postMessage(JSON.stringify(E),"*")}else{x.contents().find("body").append(y);x.contents().find("body form").submit()}};if(x[0].readyState){x[0].onreadystatechange=function(){if(this.readyState==="complete"||this.readyState==="loaded"){this.onreadystatechange=null;C()}}}else{x[0].onload=function(){this.onload=null;C()}}};this.redirectToParent=function(){var z=k.getQueryParamValueFromUrl("epayment_status");var x=k.getQueryParamValueFromUrl("error-0");var y=self.location.search;k.addQueryParamsToEpikOptions();if(z=="success"){self.parent.location.href=k.getSuccessUrl()+y;return}else{if(z=="aborted_by_user"){self.parent.location.href=k.getCancelUrl()+y;return}}if(x&&x!=""){self.parent.location.href=k.getErrorUrl()+y}};this.waitForConfirmation=function(x){k.stopCounter=false;k.stopPolling=false;k.countTimer=null;k.pollTimer=null;k.countDown(x.start_minutes,x.start_seconds,x.container_id,x.timedout);k.pollStatus(x.merchant_transaction_id,x.epp_transaction_id,x.confirmed,x.declined,x.interval)};this.abortWaitForConfirmation=function(){if(k.countTimer!==null){clearTimeout(k.countTimer)}if(k.pollTimer!==null){clearTimeout(k.pollTimer)}k.stopCounter=true;k.stopPolling=true;k.countTimer=null;k.pollTimer=null};this.countDown=function(z,A,y,x){if(A==0){z=z-1;A=59}else{A=A-1}k.showSMSCounter(z,A,y);if(z>0||A>0){if(!k.stopCounter){k.countTimer=setTimeout(function(){k.countDown(z,A,y,x)},1000)}}else{if(!k.stopCounter){k.stopPolling=true;x()}}};this.showSMSCounter=function(y,z,x){if(y<10){y="0"+y}if(z<10){z="0"+z}EPIK.jq("#"+x).html(y+":"+z)};this.pollStatus=function(C,D,A,z,y){var B=k.options.apiendpoint.replace(/(.*)\//g,""),x;if(k.options.api_key){B=k.options.api_key}x=k.options.http_base_url_endpoint+"/organisations/"+B+"/transactions/"+D;EPIK.jq.ajax({url:x,cache:false,crossDomain:true,timeout:15000,dataType:"json",contentType:"application/json",success:function(H){var G={};var E=H;if(E.status==undefined){G.status="final_error"}else{for(var F in E.status){if(E.status[F].statusName=="final_success"){G.status="confirmed";break}if(E.status[F].statusName=="final_error"||E.status[F].statusName=="aborted_by_user"){G.status="declined";break}else{G.status="pending"}}}k.parseStatusResponse(G,C,D,A,z,y)},error:function(F,E,G){}})};this.parseStatusResponse=function(A,B,C,z,y,x){if(A.status=="pending"){if(!k.stopPolling){k.pollTimer=setTimeout(function(){k.pollStatus(B,C,z,y,x)},x*1000)}}else{if(A.status=="confirmed"){k.stopCounter=true;z()}else{k.stopCounter=true;y()}}};this.addQueryParamsToEpikOptions=function(){var y=k.getQueryParams();for(var x in y){if(k.options[x]){if(k.options[x]!=y[x]){}}else{k.options[x]=y[x];k.updateCookie(x,y[x],k.formKey)}}};this.getQueryParams=function(){var x=self.location.href;if(x.endsWith("#")){x=x.substring(0,x.length-1)}x.match(/\?(.+)$/);var B=RegExp.$1;B=B.split("&");var A={};for(var z=0;z<B.length;z++){var y=B[z].split("=");A[y[0]]=decodeURIComponent(y[1])}return A};this.getQueryParamValueFromUrl=function(x){return k.getQueryParams()[x]};var h=function(A){var z=Array(0,9,4,6,8,2,7,1,3,5);var y=0;for(var x=0;x<A.length;x++){y=z[(y+parseInt(A.substr(x,1)))%10]}return(10-y)%10};this.createCompleteRefNo=function(D,z){if(!D||(D+"").length!=6){throw"BankingCustomerIdentificationException"}if(!z){z=""}if(typeof z!="string"){throw"FormatException: Code must be a string"}var B=(D+"").length+(z+"").length;var y="000000000000000000000000000";if(B>27){throw"OutOfRangeException: Only 20 digits are allowed for the code"}else{if(B==27){var x=(D+"")+(z+"");if(h(x.substr(0,x.length-1))==x.substr(x.length-1)){throw"CheckDigitException"}else{y=x}}else{var C=27-B-1;var A="";if(C>0){A=(Math.pow(10,C)+"").substr(1)}y=(D+"")+A+(z+"");y=y+h(y)}}return y};this.getBaseUri=function(){var x=k.options.apiendpoint;if(x.indexOf("http")==0){x=x.substring(0,x.indexOf("/",8)+1)}else{x=""}return x};this.getMerchantConfigId=function(){var y=k.options.apiendpoint;var x="";var z=y.lastIndexOf("/");if(y.length-1>z){x=y.substr(z+1)}else{y=y.substring(0,z);x=y.substr(y.lastIndexOf("/")+1)}return x};this.sendMerchantParameter=function(E,y,A,D,C){var B=D;var z=C;var x=k.options.addmerchantparameter_url;if(x.length>0){EPIK.jq.ajax({url:x,type:"POST",data:"transaction-id="+E+"&parameter-name="+encodeURIComponent(y)+"&parameter-value="+encodeURIComponent(A),success:function(F){if(typeof B=="function"){B(F)}},error:function(G,F,H){if(typeof B=="function"){z(G,F,H)}}})}};this.sendFinalSuccessStatus=function(C,B,A){var z=B;var y=A;var x=k.options.setfinalstatus_url;if(x.length>0){EPIK.jq.ajax({url:x,type:"POST",data:"transaction-id="+C,success:function(D){if(typeof z=="function"){z(D)}},error:function(E,D,F){if(typeof z=="function"){y(E,D,F)}}})}}}(function(g,f){var c=window.rnwWidget.constants,b=[f,"-"].join(""),d={dd:["dd"],cc:["vis","eca","amx","din"],stp:["stp"],pex:["pex"],sms:["sms"],psl:["es","ezs"],twi:["twi"],pp:["pp"],mpw:["mpw"],elv:["elv"],sod:["sod"],pf:["pfc","pef"],kcp:["kcp"],payu:["payu"],};c.donationType={RECURRING:"recurring",SINGLE:"single",};c.ccFormEventPrefix="rnw-creditcardform.";function h(j,i){return(i===false?"":".")+b+j}function a(j,l,k){this.paymentMethod=null;this.metaMethod=null;this.doNotSubmit=false;var i=this;i._paymentOverlayCallbacks={"default":function(m){if(m!=="success"&&m!=="create-creditcard-token-error"){i._onEpikResponse({epayment_status:c.paymentStatus.ABORTED_BY_USER})}},};i._initialize(j,l,k)}g.extend(true,a.prototype,rnwWidget.widgets.BaseWidget,{_onTemplateLoaded:function(){var i=this;function j(k){return i.jGet("[name="+k+"]")}i.fields={donationReceipt:j("stored_customer_donation_receipt"),addressCompactMode:j("stored_rnw_hide_address_fields"),};g.validator.addMethod("donationReceipt",function(m,l,n){var k=[i.options.translations.field_values.donation_receipt_yes,i.options.translations.field_values.donation_receipt_no,];return k.indexOf(m)!==-1});i._initializeWidgetHooks();i._initializeDonationPurpose();i._initializeCurrency();i._initializeAmountControls();i._initializeCoverFeeControls();i._initializeSuccessPageControls();i._initializePaymentMethods();i._initializeMsisdnControl();i._initializeAddressLogic();i._initializeEditSubscriptionControls();i._initializeTlsCheck();i.j(window).on("message",function(k){i._receiveMessageFromCreditCardIframe(k)});i.jGet(h("button-donate")).on("click",function(k){k.preventDefault();if(!g(this).is(".disabled")){g(this).addClass("disabled");i.processPayment()}})},_validateOptions:function(j){var m=this,i=new Date(),k=[i.getFullYear()-j.common.maxAge,i.getFullYear()];var l=function(){var o={required:true,minlength:3,email:true,};var n=typeof j.common.email_remote_validation!="undefined"?true:false;var q=(n&&j.common.email_remote_validation);var p=function(r){return{type:"GET",url:"https://widget-api.rnw.io/organisations/"+m.widgetUUID+"/email-addresses/validate",contentType:"application/json; charset=utf-8",dataType:"json",data:{address:r.value},dataFilter:function(s){var t=JSON.parse(s);if(t.is_valid){return true}else{return false}}}};if(q){o.remote=p}return o};return{debug:true,errorClass:h("error",false),validClass:h("valid",false),focusInvalid:false,highlight:function(p,n,o){var q=m.j(p),r=q.parents(h("validation-group")).first();target=r.length>0?r:q.parents(h("step-row")).first();q.removeClass(o).addClass(n);target.removeClass(o).addClass(n)},unhighlight:function(p,n,o){var q=m.j(p),r=q.parents(h("validation-group")).first();target=r.length>0?r:q.parents(h("step-row")).first();q.removeClass(n).addClass(o);if(target.find("."+n+":not(label)").length===0){target.removeClass(n).addClass(o)}},errorPlacement:function(o,p){var q=m.j(p).parents(h("step-row")).first(),n=q.find(h("error-messages"));if(n.length===0){n=g("<div></div>").addClass(h("error-messages").substring(1));q.append(n)}n.append(o)},groups:{},rules:{},messages:{},classRules:{customamount:{required:{depends:function(n){return m.jGet("[name=predefined-amount]:checked").val()===""}},rnwmin:function(){var q=m.get("meta_recurring")==="true"?true:false,p,o,n={};n.min_amount=j.common.min_amount;if(typeof j.common.multiple_min_amount==="object"){n.min_amount=j.common.multiple_min_amount[m.get("currency")]}if(m.jGet("[name=predefined-amount]:checked").val()===""&&n.min_amount){if(!q){if(typeof(n.min_amount.single)==="number"){return n.min_amount.single}}else{if(n.min_amount.recurring){p=m.get("recurring_interval_name");switch(p){case"weekly":case"monthly":case"quarterly":case"semestral":case"yearly":o=n.min_amount.recurring[p];return(typeof(o)==="number")?o:false;break}}}}return 0},digits:{depends:function(n){return m.jGet("[name=predefined-amount]:checked").val()===""}}},cardno:{required:true,creditcard:true,rnwcreditcard:j.common.allowed_cc_types,},expm:{required:true,digits:true,range:[1,12],},expy:{required:true,digits:true,range:[0,99],},cvv:{required:true,digits:true,},msisdn:{required:true,msisdn:true,},postfinance_sub:{required:true,},iban:{required:true,ibanCountry:function(){return j.common.supported_iban_countries?j.common.supported_iban_countries:["CH","AT","DE"]},iban:true,},elv_iban:{required:true,ibanCountry:function(){return j.common.supported_iban_countries?j.common.supported_iban_countries:["CH","AT","DE"]},iban:true,},elv_bic:{required:true,},sod_iban:{required:true,ibanCountry:function(){return j.common.supported_iban_countries?j.common.supported_iban_countries:["CH","AT","DE"]},iban:true,},sod_bic:{required:true,},bank_name:{required:true,},stored_customer_salutation:{required:true,},stored_customer_firstname:{required:true,},stored_customer_lastname:{required:true,},stored_customer_email:l(),stored_customer_message:{maxlength:300},stored_customer_donation_receipt:{required:j.common.enable_birthdate_mandatoriness_for_donation_receipt===true,donationReceipt:j.common.enable_birthdate_mandatoriness_for_donation_receipt===true},customer_birthdate_day:{required:function(){var n=j.common.enable_birthdate_mandatoriness_for_donation_receipt?j.common.enable_birthdate_mandatoriness_for_donation_receipt:false;if(!n){return true}return(n&&m.get("stored_customer_donation_receipt")==m.options.translations.field_values.donation_receipt_yes)?true:false},digits:true,range:[1,31],},customer_birthdate_month:{required:function(){var n=j.common.enable_birthdate_mandatoriness_for_donation_receipt?j.common.enable_birthdate_mandatoriness_for_donation_receipt:false;if(!n){return true}return(n&&m.get("stored_customer_donation_receipt")==m.options.translations.field_values.donation_receipt_yes)?true:false},digits:true,range:[1,12],},customer_birthdate_year:{required:function(){var n=j.common.enable_birthdate_mandatoriness_for_donation_receipt?j.common.enable_birthdate_mandatoriness_for_donation_receipt:false;if(!n){return true}return(n&&m.get("stored_customer_donation_receipt")==m.options.translations.field_values.donation_receipt_yes)?true:false},digits:true,birthYear:j.common.min_age?j.common.min_age:0,minlength:4,range:k,},stored_customer_street:{required:true},stored_customer_zip_code:{required:true,minlength:4,digits:true,},stored_customer_province:{required:true},stored_customer_city:{required:true},stored_customer_country:{required:true},stored_recipient_salutation:{required:true,},stored_recipient_firstname:{required:true,},stored_recipient_lastname:{required:true,},recipient_birthdate_day:{required:true,digits:true,range:[1,31],},recipient_birthdate_month:{required:true,digits:true,range:[1,12],},recipient_birthdate_year:{required:true,digits:true,range:k,},stored_recipient_street:{required:true},stored_recipient_zip_code:{required:true,minlength:4,digits:true,},stored_recipient_city:{required:true},stored_recipient_country:{required:true},member_salutation:{required:true,},member_firstname:{required:true,},member_lastname:{required:true,},member_birthdate_day:{required:true,digits:true,range:[1,31],},member_birthdate_month:{required:true,digits:true,range:[1,12],},member_birthdate_year:{required:true,digits:true,range:k,},},}},_defaultOptions:function(){return{members:{min:1,max:5,initial:1,},defaults:{ui_recurring_interval_default:"monthly",},common:{maxAge:150,scrollTopMargin:50,},}},_getMetaMethod:function(i){var k=this,j;k.j.each(d,function(m,l){if(k.j.inArray(i,l)>=0){j=m;return false}});return j},_getPaymentMethods:function(i){return d[i]},_initializeWidgetHooks:function(){var i=this;i.on(c.events.CURRENCY_CHANGED,i._initializeAmountControls);i.on(c.events.PROCESS_FORM,i._processFormDateFields);i.on(c.events.PROCESS_FORM,i._processFormMembers);i.on(c.events.PAYMENT_METHOD_CHANGED,i._removeCardToken);i.on(c.events.PAYMENT_COMPLETE,i._removeCardToken);i.on(c.moduleEvents.ELEMENT_ADDED,function(j){i._setDefaults(i.j(j.target),j.memberIndex)})},_initializeDonationPurpose:function(){var k=this,i,m=this.options.getDefault("stored_campaign_id"),j=this.options.getDefault("stored_campaign_subid"),l=this.options.getDefault("stored_rnw_purpose_text"),n;k.jGet("[name=stored_purpose]").on("change",function(s){var r=k.j(s.currentTarget),q=r.data("campaign-id"),p=r.data("campaign-subid"),o=r.data("purpose-title");k.set("stored_campaign_id",q);k.set("stored_campaign_subid",p);k.set("stored_rnw_purpose_text",o);k.set("es_message",o);k._trigger(c.events.PURPOSE_CHANGED,{value:r.val(),campaignId:q,campaignSubId:p,purposeTitle:o})});i=k.options.getDefault("stored_purpose");if(i===undefined&&k.options.translations.step_donation_target!==undefined){i=k.options.translations.step_donation_target.purposes[0].id}if(i&&k.options.translations.step_donation_target!==undefined&&!m&&!j){n=k.jGet('[name=stored_purpose][value="'+i+'"]');if(n.length>0){m=n.data("campaign-id");j=n.data("campaign-subid");l=n.data("purpose-title")}}k.set("stored_purpose",i);k.set("stored_campaign_id",m);k.set("stored_campaign_subid",j);k.set("stored_rnw_purpose_text",l);k.set("es_message",l)},_initializeCurrency:function(){var j=this;if(j.options.process.steps.indexOf(c.steps.CURRENCY)!==-1){j.element.on("change","[name=currency-selector]",function(m){var l=j.get("currency");var k=m.target.value;j.set("currency",k);j._trigger(c.events.CURRENCY_CHANGED,{oldValue:l,newValue:k})});var i=j.get("currency");j.jGet("[name=currency-selector]").select2("val",i).trigger("change")}},_getStepAmountData:function(){var i=this;if(i.options.translations.step_amount!==undefined&&i.options.translations.step_amount.multiple_currencies!==undefined){return i.options.translations.step_amount.multiple_currencies[i.get("currency")]}return i.options.translations.step_amount},_initializeAmountControls:function(){var o=this,l,n=h("amount-box")+" [name=customamount]",k=o.options.getDefault("ui_recurring_interval_default"),j=o.options.getDefault("ui_recurring_amount_default"),i=o.options.getDefault("ui_onetime_amount_default");o.jGet("[name=interval-selector] option").each(function(){g(this).attr("value",o.intervalNameToExpression(g(this).attr("value")))});k=o.intervalNameToExpression(k);var m=o._getStepAmountData();if(j===undefined&&o.options.translations.step_amount!==undefined){j=m.recurring_amounts[0].value}if(i===undefined&&o.options.translations.step_amount!==undefined){i=m.onetime_amounts[0].value}o.set("recurring_interval",o.options.getDefault("recurring_interval"));l=o.get("recurring_interval");if(!l&&o.options.common.payment_type==="recurring"){o.set("recurring_interval",k);l=o.get("recurring_interval")}o._renderAmountStep(l);o.set("amount",o.options.getDefault("amount")||(l?j:i));o.element.on("change","[name=predefined-amount]",function(r){var q=o.j(this),p=q.val();if(p!==""){o.set("amount",p)}else{o.jGet(n).focus()}});o.element.on("click",h("amount-box"),function(p){if(!o.j(this).hasClass(h("amount-box-custom",false))){o.j(this).find("[name=predefined-amount]").trigger("change");o.jGet(n).valid()}else{o.set("amount","");o.jGet(n)[0].focus()}});o.element.on("change","[name=interval-selector]",function(t){var r=o.j(t.target).val()||k,s=o.jGet("[name=predefined-amount]").index(o.jGet("[name=predefined-amount]:checked"));o.jGet('[name=interval-selector] option[value=""]').attr("disabled","disabled");o.set("recurring_interval",r);var p=o.jGet('[name=predefined-amount][value="'+j+'"]').length>0;var q=o.jGet("[name=predefined-amount]").eq(s);o.set("amount",p?j:q.val())});o.element.on("change","[name=donation-type]",function(s){var r=o.j(s.target).val(),q=r==="recurring",p=o.get("interval-selector")||k;o.set("recurring_interval",q?p:null);o.set("amount",q?j:i);o.jGet("[name=interval-selector]").select2("val",(q?p:""))});o.element.on("focus",n,function(q){var p=o.j(q.target);o.jGet('[name=predefined-amount][value=""]').trigger("click");if(o.j(this).val()==="..."){o.j(this).val("")}});o.element.on("blur",n,function(q){var p=o.j(q.target);if(p.val()===""){p.val("...")}else{o.set("amount",parseInt(p.val(),10)*100)}});o.element.on("keyup",n,function(q){var p=o.j(q.target);p.val(p.val().replace(/[^0-9]/g,""));if(p.val().indexOf("0")===0||p.val().indexOf(" ")===0){p.val("")}if(p.val().length>5){p.val(p.val().substring(0,5))}})},_initializeCoverFeeControls:function(){var i=this;if(i.options.process.steps.indexOf("cover-transaction-fee")===-1){return}i.options.defaults.stored_rnw_cover_fee_fixed=0;i.options.defaults.stored_rnw_cover_fee_percentage=0;i.options.defaults.stored_rnw_cover_fee_amount=0;i.on(window.rnwWidget.constants.events.AMOUNT_CHANGED,function(k){var l=k.widget;var j=l.get("amount");if(j){l._changeFeeLabel(j);if(l._isCheckedCoverFee()){l._applyFeeToForm(j)}else{l._resetFeeInForm()}}});i.element.on("change","[name=stored_cover_transaction_fee]",function(){var j=i.get("amount");if(i._isVisibleCoverFeeStep()){if(i._isCheckedCoverFee()){i._applyFeeToForm(j)}else{i._resetFeeInForm()}}else{i._resetFeeInForm()}});i.element.on("input focus","[name='customamount']",function(k){if(k.target.value){try{var j=parseFloat(k.target.value)*100;i._changeFeeLabel(j);if(i._isCheckedCoverFee()){i._applyFeeToForm(j)}else{i._resetFeeInForm()}}catch(k){}}})},_initializeSuccessPageControls:function(){var i=this;i.element.on("click",h("button-new-donation"),function(j){j.preventDefault();i.showPage("form");return false})},_initializeEditSubscriptionControls:function(){var i=this;if(i.mode===window.rnwWidget.constants.modes.SUBSCRIPTION){i.jGet("#"+i.getId("subscription-back-button")).on("click",function(j){i.showPage("form");j.preventDefault()});i.jGet(i.wcl("page-edit-subscription")).on("click","#"+i.getId("show-update-subscription-form"),function(j){i.hideStep("subscription-info");i.showStep("update-subscription-form");j.preventDefault()});i.jGet(i.wcl("page-edit-subscription")).on("click","#"+i.getId("show-subscription-info"),function(j){i.showStep("subscription-info");i.hideStep("update-subscription-form");j.preventDefault()});i.jGet(i.wcl("page-cancel-subscription")).on("click","#"+i.getId("show-subscription-info-from-cancel"),function(j){i.showPage("edit-subscription");j.preventDefault()});i.jGet(i.wcl("page-edit-subscription")).on("click","#"+i.getId("cancel-subscription"),function(j){i.showPage("cancel-subscription");j.preventDefault()});i.jGet(i.wcl("page-edit-subscription")).on("click","#"+i.getId("renew-subscription"),function(j){i.processPayment();j.preventDefault()});i.jGet(i.wcl("page-cancel-subscription")).on("click","#"+i.getId("cancel-subscription-button"),function(j){g(this).hide();i._cancelSubscription();j.preventDefault()})}},_filterPaymentMethods:function(o){var m=this,l=m._getPaymentSelectionMode(),k=m.modules[l].payment_method,j=m.get("amount"),i=false,n;m.j.each(k.getItems(),function(p,s){var r=s.content.data("meta-method"),q=m._getPaymentMethods(r)||[r],t=false;m.j.each(q,function(y,v){var w=m._getPaymentMethodOptions(r,v),u=w.recurrence||"single",x=(u==="both"||(u==="single"&&!o)||(u==="recurring"&&o));if(v==="sms"){x=x&&(j<10000)}t=t||x;m.j('[data-payment-method="'+v+'"]',s.content).toggle(x)});if(t){s.show();i=i||s.isActive();n=n||s}else{s.hide(false)}});if(!i){n.select()}},_initializeMsisdnControl:function(){var i=this;i.jGet("[name=msisdn]").keyup(function(){var l=i.j(this),n=i.j.trim(l.val()),m=/^0/,j=/^7/,k=/[^0-9+ ]/;l.parent().removeClass("error");if(n.match(m)){n=n.replace(m,"+41");l.val(n)}else{if(n.match(j)){l.val("+41"+n)}else{if(n.match(k)){n=n.replace(k,"");l.val(n)}}}if(l.val().length>20){l.val(l.val().substring(0,20))}})},_extraIconsFilter:function(k){var l=this,i=l.options.common.allowed_cc_types,j=l.jGet(h("cc-icon"));if(k==="vis"&&i.indexOf("cb")>-1){j.filter("[data-card-type=cb]").removeClass("inactive")}},_initializePaymentMethods:function(){var o=this,n,l="",p="",k="",j=o.options.common.allowed_cc_types;function i(s){var r=s.data("meta-method"),q=r;o.hideStep("create-payment-source");if(r==="cc"){q=o.ccType||"";o.showStep("create-payment-source")}else{if(r==="pf"){q=o.jGet("[name=postfinance_sub]:checked").val()||""}}o.set("payment_method",q)}if(o.options.common.payment_method_selection_mode==="accordion"&&o.mode==="form"){o.j.each(o.options.css,function(q,r){if(typeof(r)==="string"){l="&css_url="+encodeURIComponent(r)+"%3Fuse_proxy%3Dfalse"}})}if(o.options.defaults.css_url){l="&css_url="+encodeURIComponent(o.options.defaults.css_url)+"%3Fuse_proxy%3Dfalse"}if(o.get("css_url")){l="&css_url="+encodeURIComponent(o.get("css_url"))+"%3Fuse_proxy%3Dfalse"}if(o.options.common.use_labels){p="&show_cc_label=true"}if(typeof o.options.common.pci_dss_compatibility!==undefined&&o.options.common.pci_dss_compatibility==="saq-a"){var m=(typeof o.options.translations.credit_card_iframe!==undefined)?o.options.translations.credit_card_iframe:null;if(m){Object.keys(m).map(function(r,q){if(m[r]!==""){k=k+"&translation_"+r+"="+encodeURIComponent(m[r])}})}}n=o.j("<iframe/>").attr({src:o.epik.options.apiendpoint.replace("/pay/","/select-card/")+"?submit_button_visibility=false&language="+o.get("language")+l+p+k,style:"width: 100%; min-height: 172px;"});o.ccFormContainerClass=o.wcl("step-payment-method");if(o.mode===rnwWidget.constants.modes.SUBSCRIPTION){o.ccFormContainerClass=o.wcl("page-edit-subscription")}o.j(o.ccFormContainerClass+" "+o.wcl("cc-iframe-container")).append(n);o.jGet(h("cc-icon")).each(function(){if(j===undefined||j.indexOf(g(this).data("card-type"))>=0){g(this).removeClass(h("hidden",false))}});o.on(c.moduleEvents.ELEMENT_SELECTED,function(r){var q=o._getPaymentSelectionMode();if(r.module===q&&r[q+"Container"].container.data("name")==="payment_method"){i(o.j(r.target))}});o.jGet("[name=postfinance_sub]").on("change",function(q){i(o.j(this).parents(h("payment-item")))});o.jGet("[name=cardno]").on("keyup",function(t){var s=o.j(this),r=rnwWidget.utils.getCreditCardType(s.val(),j),q=o.jGet(h("cc-icon"));q.removeClass("inactive");if(r!==null){q.filter("[data-card-type!="+r+"]").addClass("inactive");o._extraIconsFilter(r)}o.ccType=r;i(s.parents(h("payment-item")))});o.jGet("[name=iban]").on("change",function(u){var r=rnwWidget.utils.normalizeIban(g(this).val()),t=g.map(r.slice(4,9).split(""),function(w){return w>0?w:null}),q=t.length>0?parseInt(t[0],10):-1,s=o.options.translations.bank_names||{};if(r.slice(0,2)==="CH"&&s["bc_"+q]!==undefined){o.set("bank_name",s["bc_"+q])}});o.on(c.events.PROCESS_FORM,function(r){if(o.metaMethod==="cc"){if(o.get("stored_customer_firstname")||o.get("stored_customer_lastname")){r.computedFields.card_holder_name=o.get("stored_customer_firstname")+" "+o.get("stored_customer_lastname")}}else{if(o.paymentMethod==="dd"){}else{if(o.paymentMethod==="elv"){o._setIbanIntoIbanField("elv_iban")}else{if(o.paymentMethod==="sod"){o._setIbanIntoIbanField("sod_iban")}else{if(o.paymentMethod==="kcp"||o.paymentMethod==="payu"){var q=o.get(o.paymentMethod+"_brand_code")||undefined;if(q){o.epik.createFormField("brand_code","hidden",q)}}}}}}});o.on(c.events.PROCESS_FORM,function(r){var q=o.get("iban");if(o.metaMethod==="dd"&&q!==null&&q!==""){o.set("iban",rnwWidget.utils.normalizeIban(q))}});o.on(c.events.PROCESS_FORM,function(q){if(o.get("meta_recurring")==="true"){q.computedFields.stored_recurring_interval=o.get("recurring_interval")+" / "+(o.get("immediate_execution")==="true"?"immediate":"normal")}})},_receiveMessageFromCreditCardIframe:function(j){if(!j.originalEvent.data||typeof j.originalEvent.data!=="string"){return}var m=this,r=window.rnwWidget.constants,p={},n,l,i,q;try{p=JSON.parse(j.originalEvent.data);n=p.topic||"";l=p.data||{};i=p.dimensions||undefined}catch(k){}if(n===null){return}switch(n){case r.ccFormEventPrefix+"token-received":m.set("payment_method",l.paymentMethod);m._createCardToken(l.token);m._validateAndProcessPayment();break;case r.ccFormEventPrefix+"data-changed":m.metaMethod="cc";q=m.jGet(h("cc-icon"));q.removeClass("inactive");if(l.paymentMethod){q.filter("[data-card-type!="+l.paymentMethod+"]").addClass("inactive");m._extraIconsFilter(l.paymentMethod)}m._removeCardToken();o=m._trigger(window.rnwWidget.constants.events.CREDITCARD_FORM_DATA_CHANGED,{paymentMethod:l.paymentMethod});break;case r.ccFormEventPrefix+"form-not-valid":m.modules.overlay.loading.close("create-creditcard-token-error");m.jGet(h("button-donate")).removeClass("disabled");m.j(m.ccFormContainerClass+" "+m.wcl("cc-iframe-container"))[0].scrollIntoView(true);m._removeCardToken();m._validateAndProcessPayment();break;case r.ccFormEventPrefix+"create-token-error":m.modules.overlay.loading.close("create-creditcard-token-error");m.jGet(h("button-donate")).removeClass("disabled");m.j(m.ccFormContainerClass+" "+m.wcl("cc-iframe-container"))[0].scrollIntoView(true);m._removeCardToken();break;case r.ccFormEventPrefix+"form-valid":var o={data:{apiKey:m.epik.options.apiendpoint.split("/").pop(),},topic:r.ccFormEventPrefix+"create-token",};m.j(m.ccFormContainerClass+" iframe")[0].contentWindow.postMessage(JSON.stringify(o),"*");break;case r.ccFormEventPrefix+"window-resize":break}if(i){if(!m.theight||m.theight!=i.height){m.theight=i.height;m.jGet(m.ccFormContainerClass+" iframe").height(i.height)}}},_removeCardToken:function(){var i=this;i.jGet("input[name=card_token]").remove()},_createCardToken:function(j){var i=this;i._removeCardToken();i.j("<input/>").attr("type","hidden").attr("name","card_token").val(j).appendTo(i.form)},_validateCreditCardIframe:function(){var i=this;var j={data:{apiKey:i.epik.options.apiendpoint.split("/").pop(),},topic:c.ccFormEventPrefix+"validate-form",};i.j(i.ccFormContainerClass+" iframe")[0].contentWindow.postMessage(JSON.stringify(j),"*")},_setIbanIntoIbanField:function(k){var j=this,i;i=j.get(k);if(i!==null&&i!==""){j.set("iban",rnwWidget.utils.normalizeIban(i))}},_hideAddressCompactMode:function(){var i=this;if(i.jGet(i.wcl("step-customer-address-compact-mode")).length>0){i.showStep("customer-identity");i.hideStep("customer-address-compact-mode");i.set("stored_customer_address_changed","true");i.fields.addressCompactMode.val("false")}},_showAddressCompactMode:function(m){var k=this,n=[],i=[],l="",j;if(k.jGet(k.wcl("step-customer-address-compact-mode")).length>0){k.fields.addressCompactMode.val("true");k.j.each(m,function(p,o){switch(p){case"stored_customer_salutation":k.j.each(k.options.translations.field_values,function(q,r){if(r===o&&q.indexOf("stored_customer_salutation")===0){l=k.options.translations.step_customer_identity.labels[q.replace("stored_customer_","")]+"<br>"}});n[0]=l;break;case"stored_customer_firstname":n[1]=o+" ";break;case"stored_customer_lastname":n[2]=o;break;case"stored_customer_company":i[0]=o+"<br>";break;case"stored_customer_street":i[1]=o+" ";break;case"stored_customer_street_number":i[2]=o+"<br>";break;case"stored_customer_pobox":i[3]=o+"<br>";break;case"stored_customer_zip_code":i[4]=o+" ";break;case"stored_customer_city":i[5]=o+", ";break;case"stored_customer_country":i[6]=k.options.translations.countries[o.toUpperCase()];break}});if(!i[3]){i[3]="<br>"}if(!m.stored_customer_email){m.stored_customer_email="-"}if(m.stored_customer_birthdate){j=new Date(m.stored_customer_birthdate);m.stored_customer_birthdate=typeof(j.toLocaleDateString)==="function"?j.toLocaleDateString():m.stored_customer_birthdate}else{k.jGet("#"+k.id+"-compact-mode-customer-birthdate").parent().hide()}k.jGet("#"+k.id+"-compact-mode-customer-identity").html(n.join(""));k.jGet("#"+k.id+"-compact-mode-customer-email").html(m.stored_customer_email);k.jGet("#"+k.id+"-compact-mode-customer-birthdate").html(m.stored_customer_birthdate);k.jGet("#"+k.id+"-compact-mode-customer-address").html(i.join(""));k.hideStep("customer-identity");k.showStep("customer-address-compact-mode")}},_resetAllInputFields:function(i){var j=this;j.j(i).each(function(){switch(this.type){case"password":case"text":case"textarea":case"file":case"select-one":case"select-multiple":j.j(this).val("");break;case"checkbox":case"radio":this.checked=false}})},_initializeAddressLogic:function(){var n=this,r=false,p=false,o=n.fields.donationReceipt.parents(h("step-row")),m=(n.options.process.prevent_donation_receipt_toggle===true?false:true),i=n.j.inArray(c.steps.PAYMENT_METHOD,n.options.process.steps),j=n.j.inArray(c.steps.CUSTOMER_ADDRESS,n.options.process.steps),k=n._getPaymentSelectionMode(),l=n._isCustomAddressFieldOptionEnabled(),s;function q(){if(n.fields.addressCompactMode.val()!=="true"&&(r||n.fields.donationReceipt.is(":checked"))){n.showStep(c.steps.CUSTOMER_ADDRESS)}else{n.hideStep(c.steps.CUSTOMER_ADDRESS)}if(m){o.toggle(!r)}}n._injectCustomAddressFields(l);if(i>j){r=true;n.showStep(c.steps.CUSTOMER_ADDRESS);if(m){o.hide()}}else{s=n.modules[k].payment_method.getFirst(function(t){return t.isActive()});if(s){r=n._getPaymentMethodOptions(s.content.data("meta-method"),"");q()}n.fields.donationReceipt.on("change",function(t){q()});n.on(c.events.PAYMENT_METHOD_CHANGED,function(t){r=n._getPaymentMethodOptions(t.metaMethod,t.value).address_required||false;q()})}n.element.on("click",n.wcl("change-address-link"),function(t){n._hideAddressCompactMode();q();return false});n.element.on("click",n.wcl("not-me-link"),function(t){n._resetAllInputFields(n.wcl("step-customer-identity :input"));n._resetAllInputFields(n.wcl("step-customer-address :input"));n._hideAddressCompactMode();q();return false});n.jGet("[name=stored_customer_country]").on("change",function(t){n._trigger(c.events.ADDRESS_COUNTRY_CHANGED)});n.on(c.events.ADDRESS_COUNTRY_CHANGED,function(t){console.log(n.get("stored_customer_country"));n._injectCustomAddressFields(l)});n.on(c.events.CUSTOMER_FORM_PREFILLED,function(t){if(t.value.stored_customer_country){n.jGet("[name=stored_customer_country]").select2("val",(t.value.stored_customer_country).toUpperCase())}if(t.value.stored_customer_donation_receipt){n.jGet("[name=stored_customer_donation_receipt]").select2("val",t.value.stored_customer_donation_receipt)}n._showAddressCompactMode(t.value);n.epik.createFormField("stored_customer_address_changed","hidden","false");q()})},_initializeTlsCheck:function(){var i=this;if(i.options.common.check_tls_version&&i.options.common.check_tls_version===true){rnwWidget.utils.checkTlsVersion(this)}},_getPaymentMethodOptions:function(j,i){if(this.options.payment_methods[i]!==undefined){return this.options.payment_methods[i]}else{if(this.options.payment_methods[j]===undefined){return{}}else{var k=this.options.payment_methods[j];return(k[i]===undefined?k:k[i])}}},getDonationType:function(){throw"NYI"},_renderAmountStep:function(l){var m=this,k=[],o=m.options.translations.common.currency_iso,q="onetime_amounts",p="",i="",j=1;if(m.options.process.steps.indexOf(c.steps.CURRENCY)!==-1){o=m.options.translations.step_currency.currencies[m.get("currency")]}if(l){q="recurring_amounts";i=m.get("interval-selector");p=i;if(this.options.intervals.mode){p=m.jGet("[name=interval-selector] > option:selected").data("interval-name")}switch(p){case"monthly":j=1;break;case"quarterly":j=3;break;case"semestral":j=6;break;case"yearly":j=12;break;case"weekly":j=(1/4);break;default:j=1}}var n=m._getStepAmountData();if(m.options.translations.step_amount===undefined||typeof n[q]!=="object"){return}m.set("stored_translated_recurring_interval",m.options.translations.common[p]);m.jGet("[name=interval-selector]").select2("val",i);m.j.each(n[q],function(s,u){var t=parseFloat(u.text)*j,r=(t*100)%100===0?parseInt(u.text,10)*j:t.toFixed(2);k.push({blockId:"amount-"+s,fieldId:m.id+"-amount-"+s,amount:parseInt(u.value,10)*j,currencyIsoCode:o,text:r})});if(m.modules.templateInjector.amounts){m.modules.templateInjector.amounts.inject(k)}if(m.modules.templateInjector["custom-amount"]){m.modules.templateInjector["custom-amount"].inject({blockId:"custom-amount",currencyIsoCode:o})}},_processFormDateFields:function(m){var l=this,i,k,j;for(k in l.modules.tripleDate){i=l.modules.tripleDate[k];if(l.j.contains(l.form[0],i.container[0])){j=i.getDate();m.computedFields[k]=(j===null?"":j.toISO8601DateString())}}},_processFormMembers:function(j){var i=this;i.form.find(i.wcl("member-item")).each(function(l){var p=i.j(this),n=p.data("index"),m=[];function o(q){return"[name=member_"+q+"_"+n+"]"}function k(q,r){m.push('"'+q+'":"'+p.find(o(q)+(r||"")).val()+'"')}k("salutation",":checked");k("firstname");k("lastname");m.push('"birthdate":"'+j.computedFields["member_birthdate_"+n]+'"');delete j.computedFields["member_birthdate_"+n];j.computedFields["stored_member_"+l]="{"+m.join(",")+"}"})},_getPaymentSelectionMode:function(){return this.options.common.payment_method_selection_mode?this.options.common.payment_method_selection_mode:"tab"},_isCustomAddressFieldOptionEnabled:function(){return this.options.common.enable_custom_address_fields?this.options.common.enable_custom_address_fields:"false"},_isPaymentMethodPresent:function(){var i=this;if(i.metaMethod==="cc"&&i.options.common.pci_dss_compatibility==="saq-a"){var j=i.jGet("input[name=card_token]").val();return !!i.paymentMethod&&!!j}return !!i.paymentMethod},_validateAndProcessPayment:function(){var j=this,i;j._trigger(c.events.VALIDATING_PARAMETERS,null,j.form);j._trigger(c.events.AFTER_VALIDATING_PARAMETERS,{preventSubmit:function(){j.doNotSubmit=true}});if(!j.doNotSubmit&&j.form.valid()&&j._isPaymentMethodPresent()){if(j.metaMethod!=="cc"&&(j.paymentMethod===null||j.paymentMethod==="")){window.rnwWidget.utils.bugsnagNotify({name:"no-payment-method-error",message:"No payment method is defined"});throw"No payment method"}j.modules.overlay.loading.open({height:j.options.common.overlay_heights[j.paymentMethod]}).callback(j._paymentOverlayCallbacks);j._prepareAndSubmitEpik()}else{j.jGet(h("button-donate")).removeClass("disabled");j.doNotSubmit=false;i=j._trigger(c.events.VALIDATION_ERROR,{error:"jquery validate validation error",errorCode:1,errorList:j.form.validate().errorList},j.form);if(!i.isDefaultPrevented()){if(i.errorList.length>0){var k=g(i.errorList[0].element);j.j("html, body").animate({scrollTop:k.offset().top-j.options.common.scrollTopMargin,},500,function(){k.focus()})}}}},processPayment:function(){var i=this;if(i.metaMethod==="cc"&&i.options.common.pci_dss_compatibility==="saq-a"){i._validateCreditCardIframe()}else{i._validateAndProcessPayment()}},_onBeforeEpikResponseProcess:function(i){this.modules.overlay.loading.close("success");this.jGet(h("button-donate")).removeClass("disabled")},_onEpikSuccess:function(i){var k=this,n=window.rnwWidget.utils.getFallbackKeyValue(k.options,k.options.translations,"confirmation_text",i),j=i.amount,m="#",l;m=i.espayment_pdflink||m;m=i.ezspayment_pdflink||m;m=i.dd_pdflink||m;m=i.pdflink||m;k.jGet("#"+k.getId("success-content")).empty();k.jGet("#"+k.getId("success-content")).append(k.j(ich[k.getId("ich_custom_success_template")](n)));k.jGet(k.wcl("success-currency")).text(i.currency.toUpperCase());k.jGet(k.wcl("success-amount")).text(parseInt(i.amount,10)/100);k.jGet(k.wcl("success-pdflink")).attr("href",m);k.showPage("payment-success");if(this.options.common.enable_autoscroll_successpage&&this.options.common.enable_autoscroll_successpage===true){l=k.jGet(k.wcl("page-payment-success"));k.j("html, body").animate({scrollTop:l.offset().top-k.options.common.scrollTopMargin},500)}},_onEpikSubscriptionSuccess:function(j){var k=this,i=window.location.href.replace(/dds\-subscription=[a-z0-9]*/i,"dds-subscription="+j.subscription_token).replace(/epp_transaction_id=[a-z0-9]+&*/g,"");k.jGet("#"+k.getId("reload-subscription-info")).attr("href",i);k.showPage("subscription-renew-success")},_onEpikError:function(i){this.modules.overlay["payment-error"].open({templateData:{"error-details":i,},})},_onEpikCancel:function(i){this.modules.overlay["payment-cancel"].open()},_showSmsPoll:function(i){this.modules.overlay["sms-poll"].open().callback(this._paymentOverlayCallbacks)},_hideSmsPoll:function(i){this.modules.overlay["sms-poll"].close("success")},_successHandlers:{fallback:function(i){},},_onSubscriptionCancelError:function(i){this.modules.overlay["subscription-cancel-error"].open()},_onSubscriptionCancelSuccess:function(j){var i=this;this.modules.overlay["subscription-cancel-confirmation"].open().callback({"subscription-cancel-success":function(){window.location.reload()}})},_onSubscriptionInfoError:function(i){this.showPage("error-subscription")},_onTransactionInfoTimeout:function(i){this.showPage(window.rnwWidget.constants.modes.FORM)},_onTransactionInfoError:function(i){this.showPage(window.rnwWidget.constants.modes.FORM);this.modules.overlay["payment-info-error"].open()},_onTransactionInfoSuccess:function(o){var n=this,k=n._getPaymentSelectionMode(),j=n.modules[k].payment_method,i=o.payment_method.toLowerCase(),m,l=n._getMetaMethod(i);l=(i==="es"||i==="ezs")?i:l;if(o.recurring_interval){n.set("donation-type","recurring");if(this.options.intervals.mode){n.jGet("[name=interval-selector]").select2("val",o.recurring_interval)}else{n.jGet("[name=interval-selector]").select2("val",rnwWidget.utils.cronHelper.expressionToInterval(o.recurring_interval))}n.jGet("[name=interval-selector]").trigger("change")}n.j.each(o,function(s,r){if(s.indexOf("stored_")===0){if(n.modules.tripleDate[s]){n.modules.tripleDate[s].setDate(new Date(r))}else{n.set(s,r)}}else{if(s=="amount"){var p=o.stored_rnw_cover_fee_amount||0;var q=r-p;n.set(s,q)}}});n._resetFeeInForm();m=j.getFirst(function(p){if(p.content.is("[data-meta-method="+l+"]")){return true}});if(m){m.select()}n.set("payment_method",i);this._onEpikResponse(o)},_onSubscriptionInfoSuccess:function(j){var k=ich[this.getId("ich_subscription_info")],i;this.set("stored_customer_email",j.customer.stored_customer_email);this.set("amount",j.amount);this.set("language",j.language);this.set("currency",j.currency);this.set("recurring","true");this.set("subscription_token",this.subscriptionToken);this.set("recurring_interval",j.interval);this.set("meta_recurring","true");if(j.customer.stored_customer_country){this.epik.createFormField("stored_customer_country","hidden",j.customer.stored_customer_country)}this.set("stored_customer_firstname",j.customer.stored_customer_firstname);this.set("stored_customer_lastname",j.customer.stored_customer_lastname);this.set("stored_campaign_id",j.stored_campaign_id);this.set("stored_campaign_subid",j.stored_campaign_subid);this.set("stored_rnw_purpose_text",j.stored_rnw_purpose_text);this.set("stored_rnw_hide_address_fields",j.stored_rnw_hide_address_fields);this.set("stored_translated_recurring_interval",j.stored_translated_recurring_interval);i=j.status;j.expiry_date=(j.expm&&j.expy)?j.expm+"/"+j.expy:"-";j.status=this.options.translations.page_edit_subscription["status_"+j.status+"_text"];j.amount=j.currency.toUpperCase()+" "+parseInt(j.amount/100,10);j.interval=this.expressionToIntervalLabel(j.interval,this.options.translations.page_edit_subscription);j.payment_method=this.options.translations.common.payment_methods[j.payment_method.toLowerCase()];this.jGet(this.wcl("subscription-info-container")).empty().append(k(j));if(i==="inactive"){this.jGet("#"+this.getId("cancel-subscription")).hide()}this.showPage("edit-subscription")},_onRefundSuccess:function(){this.showPage("refund-success-transaction")},_onRefundError:function(){this.showPage("refund-error-transaction")},_fieldHandlers:window.rnwWidget.widgets.BaseWidget._fieldHandlers.concat([rnwWidget.utils.fieldHandlerByName("amount",{beforeUpdate:function(j){var i=this.widget.jGet('[name=predefined-amount][value="'+j+'"]');if(i.length===0){i=this.widget.jGet('[name=predefined-amount][value=""]');this.widget.jGet("[name=customamount]").val(parseInt(j/100,10))}i.prop("checked",true);this.widget.jGet(this.widget.wcl("amount-box")).removeClass(this.widget.wcl("active",false));i.parents(this.widget.wcl("amount-box")).addClass(this.widget.wcl("active",false))},afterUpdate:function(i){this.widget._filterPaymentMethods(this.widget.get("meta_recurring")==="true");if(this.oldValue!==i){this.widget._trigger(c.events.AMOUNT_CHANGED,{value:i})}},}),rnwWidget.utils.fieldHandlerByName("recurring_interval",{beforeUpdate:function(k){var i=!(k===undefined||k===null||k===""),j=i?"recurring":"onetime";this.widget.set("meta_recurring",i);this.widget.set("donation-type",j);this.widget.set("interval-selector",k);intervalName=this.widget.jGet("[name=interval-selector] :selected").data("intervalName");this.widget.set("recurring_interval_name",intervalName);if(this.widget.options.intervals[intervalName]){this.widget.set("immediate_execution",this.widget.options.intervals[intervalName].type==="immediate")}this.widget._renderAmountStep(i)},afterUpdate:function(i){if(this.oldValue!==i){this.widget._trigger(c.events.INTERVAL_CHANGED,{value:i,intervalName:this.widget.get("recurring_interval_name")})}},}),rnwWidget.utils.fieldHandlerByName("meta_recurring",{beforeUpdate:function(k){var j,i;this.widget._filterPaymentMethods(k);j=this.widget._getPaymentMethodOptions(this.widget.metaMethod,this.widget.paymentMethod);i=(k&&!(j.pseudo_recurring||false));this.widget.set("recurring",i)},afterUpdate:function(i){if(this.oldValue!==i.toString()){this.widget._trigger(c.events.DONATION_TYPE_CHANGED,{value:i})}},}),rnwWidget.utils.fieldHandlerByName("payment_method",{beforeUpdate:function(n){var o=this.widget._getMetaMethod(n),l=this.widget._getPaymentSelectionMode(),i=this.widget.modules[l].payment_method,j=this.widget._getPaymentMethodOptions(o,n),m=this.widget.get("meta_recurring")==="true",k;if(!o){k=i.getFirst(function(p){return p.isActive()});if(k!==undefined){o=k.content.data("meta-method")}}this.widget.paymentMethod=n;this.widget.metaMethod=o;this.widget.set("recurring",(m&&!(j.pseudo_recurring||false)));if(this.oldValue!==n){if(o==="pf"){this.widget.set("postfinance_sub",n)}k=i.getFirst(function(p){return p.enabled&&p.content.data("meta-method")===o});if(k!==undefined&&!k.isActive()){k.select()}}},afterUpdate:function(i){if(this.oldValue!==i){this.widget._trigger(c.events.PAYMENT_METHOD_CHANGED,{value:this.widget.paymentMethod,metaMethod:this.widget.metaMethod})}}}),rnwWidget.utils.fieldHandlerBySelector("[data-field-type=tripledate]",{initialize:function(i,j){this.widget=i;this.fieldName=j;this.tripleDate=i.modules.tripleDate[j]},internalSet:function(i){this.tripleDate.setDate(i)},get:function(){return this.tripleDate.getDate()},}),]),_calcFee:function(m){var j=this.options.common.cover_transaction_fee||{};var o=j.fixed||0;var q=j.percentage||0;var k=parseFloat(q);var l=parseFloat(o)*100||0;var i=k*m/100||0;var n=l+i;var p=Math.ceil(n*2)/2;return{feeTotal:p,feePercentage:k,feeFixed:l}},_changeFeeLabel:function(j){var m=this;try{var l=m._calcFee(j);var k=l.feeTotal;m.jGet('label[for$="stored_cover_transaction_fee"]').html(i(this.options.translations.step_cover_transaction_fee.label,{fee:k/100,currency:m.get("currency").toUpperCase(),}))}catch(n){console.error("cannot apply fee: ",n)}function i(p,o){p.match(/{{[\S]*}}/g).forEach(function(q){var r=new RegExp(q,"g");var s=o[q.replace(/{|}/g,"")];p=p.replace(r,s)});return p}},_applyFeeToForm:function(i){var k=this;if(k.options.process.steps.indexOf("cover-transaction-fee")===-1){return}var j=k._calcFee(i);k.set("stored_rnw_cover_fee_fixed",j.feeFixed);k.set("stored_rnw_cover_fee_percentage",j.feePercentage);k.set("stored_rnw_cover_fee_amount",j.feeTotal)},_resetFeeInForm:function(){var i=this;if(i.options.process.steps.indexOf("cover-transaction-fee")===-1){return}i.set("stored_rnw_cover_fee_fixed",0);i.set("stored_rnw_cover_fee_percentage",0);i.set("stored_rnw_cover_fee_amount",0)},_isCheckedCoverFee:function(){var j=this;if(j._isVisibleCoverFeeStep()){var i=j.jGet("input[name=stored_cover_transaction_fee]");if(i&&i.length!==0){return i.is(":checked")}}return false},_isVisibleCoverFeeStep:function(){var i=this;return i.jGet(".lema-step-cover-transaction-fee").hasClass("lema-shown")}});rnwWidget.utils.registerWidget(f,a)}(jQueryFix,rnwWidget.widgets.currentName));window.rnwWidget=window.rnwWidget||{};window.rnwWidget.configureWidget=window.rnwWidget.configureWidget||[];window.rnwWidget.configureWidget.push(function(a){a.extend({validationOptions:{classRules:{stored_customer_zip_code:{required:true,minlength:0,digits:false}}}})});